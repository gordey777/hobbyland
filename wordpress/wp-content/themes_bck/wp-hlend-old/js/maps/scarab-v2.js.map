{"version":3,"sources":["scarab-v2.js"],"names":["_scq","push","ScarabArrays","forEach","array","fn","scope","Array","prototype","i","len","length","call","this","map","projectionFunction","results","itemInArray","findIndex","predicateFunction","l","flatmap","concat","apply","filter","ScarabUtil","prettyPrice","nStr","x","split","x1","x2","rgx","test","replace","redirect","link","merchant","item","feature","cohort","encodeURIComponent","sc_params","appendParams","sc_feature","sc_cohort","addTrackingParams","SC","params","merge","recommender","f","uri","paramsArray","name","hasOwnProperty","n","v","paramsString","sort","a","b","localeCompare","p","join","fragmentIndex","indexOf","fragment","substring","sep","parseQuery","query","queryString","vars","pair","key","value","paramValue","decodeURIComponent","arr","err","parseQueryString","myWindow","window","location","search","parseHashString","hash","getCookie","getCookieWithoutCrazyness","JSON","parse","e","eval","hasCookie","nameEQ","ca","document","cookie","c","charAt","topDomainToCookie","domain","td","getTopDomain","ipPattern","dparts","partsToKeep","Math","min","slice","o","k","arguments","result","searchElement","fromIndex","TypeError","O","Object","abs","Infinity","max","isNaN","Number","indexOfItem","needle","id","equal","deepCopy","source","target","constructor","augment","cf","bind","context","trim","str","String","playQueue","publicAPI","queue","Queue","SyntaxError","commandArray","command","j","findLocalizedTopic","product","topic","language","category","indx","locCategories","locCategory","topicSpec","locCategoryLevels","isArray","obj","toString","CryptoJS","m","lib","Base","extend","mixIn","init","$super","create","clone","WordArray","words","sigBytes","h","stringify","q","d","clamp","ceil","random","enc","Hex","parseInt","substr","g","Latin1","fromCharCode","charCodeAt","r","Utf8","escape","Error","unescape","BufferedBlockAlgorithm","reset","_data","_nDataBytes","_append","_process","blockSize","_minBufferSize","_doProcessBlock","splice","Hasher","cfg","_doReset","update","finalize","_doFinalize","_createHelper","_createHmacHelper","s","HMAC","algo","SHA1","_hash","floor","HmacSHA1","sha1","staticResource","path","localResource","modules","inspector","devPath","discovery","assistant","durationSeconds","mobildisco","horus","hooked","loader","module","cb","hashConfig","getElementById","config","src","dev","devSsl","devPort","port","script","callback","cbTemp","scriptCb","js","createElement","charset","fs","getElementsByTagName","ieLoadBugFix","scriptElement","readyState","setTimeout","onload","parentNode","insertBefore","loadModules","actions","callGo","go","moduleName","undefined","val","console","error","later","Date","setSeconds","getSeconds","toUTCString","isMobile","w","innerWidth","innerHeight","navigator","matchMedia","matches","userAgent","redirectWithScParams","ScarabModule","win","STRINGS","VIEWCOOKIE","ADDCOOKIE","VISITORCOOKIE","PROFILECOOKIE","SERIALIZE","ai","co","vc","cp","lang","az","EVENT","pageview","addView","checkAddedItem","addAddedItem","addCartItem","setCart","addCheckoutItem","setPurchase","commit","FEATURETRIGGERS","RELATED","trigger","validate","tr","views","ALSO_BOUGHT","CART","cart","doNotInspect","doT","version","templateSettings","begin","end","varname","template","tmpl","conf","tb","te","Function","warn","sessionId","visitorId","customerId","profile","emailHash","trafficSource","emsUid","emsLid","emsLlid","fields","merchantId","testMode","debugMode","serverUrl","trackedFeature","trackedCohort","forcedCohort","transactions","transactionCounter","transactionListeners","products","features","beforeRendering","afterRendering","skipRendering","pageViewId","addEvent","ctx","evl","addEventListener","attachEvent","ISerializable","serialize","sp","serializableProperties","IComparable","other","compare","IMergable","prop","Item","t","otherItem","Feature","hasMore","merchants","containerId","parent","pages","currentPage","attachedListeners","transaction","pi","cust","requestSent","getProducts","page","purgePagesCache","findProductsMSIE","root","productIds","dataitem","getAttribute","childNodes","subresult","findProducts","el","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","currentNode","nextNode","setProducts","setPage","that","renderCallback","skipScarabRendering","render","getDataForRendering","successCallback","publicInterface","invokeRendering","attachListeners","addPage","previousPage","index","nextPage","setCohortId","sendRequest","topicLabel","topicLocalized","limit","container","getElementsByClassName","button","all","ret","className","disableButton","buttons","innerHTML","clearOldFeatureListeners","elistener","eventListener","cssClass","element","srcElement","classes","eventsHandlers","scarab-item","productId","itemClick","scarab-prev","scarab-next","trackObjectFunctions","Page","addProduct","removeProduct","OrderedItemEventQueue","isPlaying","tick","events","playcounter","add","event","compareEvent","hasNonTrivialEvents","forceSend","shouldSend","keywords","searchTerm","tags","errors","_play","clear","shift","eventHandlers","play","immediate","clearTimeout","setCookie","cookieValue","expires","serializeCookie","collection","serializedPairs","serializedObjects","findInCookie","cname","removeFromCookie","addCookie","Transaction","getTrnName","addedItems","checkouts","orderId","callbackName","exclude","compactProducts","availabilityZone","isNewPageView","viewedItem","generatePageViewId","setPageViewId","addedItem","cartItem","checkoutItem","items","getMerchantId","getPageViewId","listener","start","highlightFeatures","label","style","background","appendChild","border","setOrderId","addKeyword","keyword","addSearchTerm","addCategory","addTag","tagStr","addExcludeRule","setAvailabilityZone","setLanguage","time","getTime","disableMultiGoCheck","hasEventType","eventType","view","registerFeature","serializeList","list","serializeContext","slist","isNotNewPageView","unsentFeatures","ft","campaignId","getTestMode","referrer","errorParam","checkRequest","getHost","getServerUrl","proto","protocol","generateUrl","url","jsonpStem","Image","type","findFeature","data","trace","log","schema","newProd","currentFeature","newPage","trackingCode","expiration","setFullYear","getFullYear","vis","visitor","setVisitorId","prof","setProfile","addFeature","featureObject","pvId","pow","setMerchantId","mid","apiTag","setSessionId","sid","vid","setCustomerId","cid","setEmail","email","getCurrentTransaction","isValid","setEmailHash","toLowerCase","eh","setFields","setTestMode","tm","setServerUrl","setForcedCohort","cohortId","trn","feat","trkey","fkey","removeEventListener","detachEvent","delayed","ctr","Scarab","myFeature","featureName","elementId","ReferenceError","qs","sc_customer","sc_debug","sc_src","sc_eh","sc_uid","sc_llid","sc_lid","valueName","shouldBe","canBe","valueType","defaultTemplate","tag","itemId","quantity","price","addToCart","cartItems","checkOut","purchase","include","field","rule","negate","RULES","is","has","in","overlaps","is not","has not","not in","updateTemplate","newTemplate","recommend","baselineRecs","logic","templateStr","templateId","baseline","success","offset","beforeRenderingAsync","goAsync","addTransactionListener","removeTransactionListener","blockDiscovery","__discoveryBlocked","__discoveryModule","block","mobileEnabled","mobileDisabled","forceMobile","ScarabQueue","initScarab"],"mappings":"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","file":"scarab-v2.js","sourcesContent":["var _scq = _scq || [];\n_scq.push(['setMerchantId', '1B30B4D4E7D3F5C7']);\n/**package\n{\n  \"name\": \"scarab-util\",\n  \"version\": \"2.0.1\"\n}\n**/\n\n/*jshint camelcase: false */\n/* globals JSON */\n'use strict';\n\nvar ScarabArrays = function() {\n  var forEach = function(array, fn, scope) {\n    if (Array.prototype.forEach) {\n      return array.forEach(fn, scope);\n    }\n    for(var i = 0, len = array.length; i < len; ++i) {\n      fn.call(scope, array[i], i, this);\n    }\n  };\n\n  var map = function(array, projectionFunction) {\n    if (Array.prototype.map) {\n      return array.map(projectionFunction);\n    }\n    var results = [];\n    forEach(array, function(itemInArray, i) {\n        results.push(projectionFunction(itemInArray, i));\n    });\n    return results;\n  };\n\n  var findIndex = function(array, predicateFunction) {\n    if (Array.prototype.findIndex) {\n      return array.findIndex(predicateFunction);\n    }\n    for (var i = 0, l = array.length; i < l; i++) {\n      if (predicateFunction(array[i])) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\n  var flatmap = function(array, projectionFunction) {\n    return [].concat.apply([], map(array, projectionFunction));\n  };\n\n  var filter = function(array, predicateFunction) {\n    if (Array.prototype.filter) {\n      return array.filter(predicateFunction);\n    }\n    var results = [];\n    forEach(array, function(itemInArray) {\n      if (predicateFunction(itemInArray)) {\n        results.push(itemInArray);\n      }\n    });\n    return results;\n  };\n\n  return {\n    forEach: forEach,\n    map: map,\n    flatmap: flatmap,\n    filter: filter,\n    findIndex: findIndex\n  };\n}();\n\nvar ScarabUtil = function() {\n\n  var prettyPrice = function(nStr) {\n    nStr += '';\n    var x = nStr.split('.');\n    var x1 = x[0];\n    var x2 = x.length > 1 ? '.' + x[1] : '';\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(x1)) {\n      x1 = x1.replace(rgx, '$1' + ' ' + '$2');\n    }\n    return x1 + x2;\n  };\n\n  var redirect = function(link, merchant, item, feature, cohort) {\n    return 'http://recommender.scarabresearch.com/merchants/' + merchant + '/?v=' +\n                  encodeURIComponent('i:' + item + ',t:' + feature + ',c:' + cohort) +\n                  '&redirect_to=' + encodeURIComponent(link);\n  };\n\n  var sc_params = function(link, feature, cohort) {\n    return appendParams(link, {sc_feature: feature, sc_cohort: cohort});\n  };\n\n  var addTrackingParams = function(SC, params) {\n    return merge(params, {sc_feature: SC.recommender.f, sc_cohort: SC.cohort});\n  };\n\n  // Section 4 in RFC 2396 (http://www.ietf.org/rfc/rfc2396.txt) says that\n  // fragment ids should be the last part of urls\n  var appendParams = function(uri, params) {\n    var paramsArray = [];\n    for (var name in params) {\n      if (params.hasOwnProperty(name) && (typeof params[name] !== 'undefined')) {\n        paramsArray.push({n: name, v: params[name]});\n      }\n    }\n    if (paramsArray.length === 0) {\n      return uri;\n    }\n    var paramsString = ScarabArrays.map(\n      paramsArray.sort(function (a, b) {\n        return a.n.localeCompare(b.n);\n      }),\n      function(p) {\n        return p.n + '=' + encodeURIComponent(p.v);\n      }\n    ).join('&');\n    var fragmentIndex = uri.indexOf('#');\n    var fragment = '';\n    if (fragmentIndex >= 0) {\n      fragment = uri.substring(fragmentIndex);\n      uri = uri.substring(0, fragmentIndex);\n    }\n    var sep = uri.indexOf('?') >= 0 ? '&' : '?';\n    return uri + sep + paramsString + fragment;\n  };\n\n  var parseQuery = function(query) {\n    query = query.substring(1);\n    var queryString = {};\n    var vars = query.split('&');\n    for (var i=0;i<vars.length;i++) {\n      if (vars[i] === '') {\n        continue;\n      }\n      var pair = vars[i].split('=');\n      var key = pair[0];\n      var value = pair.length > 1 ? pair[1] : '';\n      try {\n        var paramValue = decodeURIComponent(value.replace(/\\+/g, '%20'));\n        // If first entry with this name\n        if (typeof queryString[key] === 'undefined') {\n          queryString[key] = paramValue;\n          // If second entry with this name\n        } else if (typeof queryString[key] === 'string') {\n          var arr = [ queryString[key], paramValue ];\n          queryString[key] = arr;\n          // If third or later entry with this name\n        } else {\n          queryString[key].push(paramValue);\n        }\n      } catch(err) {\n        //if (myWindow.console && myWindow.console.error) {\n        //  console.error(err);\n        //}\n      }\n    }\n    return queryString;\n  };\n\n  var parseQueryString = function(myWindow) {\n    myWindow = myWindow || window;\n    if (!myWindow || !myWindow.location || !myWindow.location.search ||\n        myWindow.location.search === '') {\n      return {};\n    }\n    return parseQuery(myWindow.location.search);\n  };\n\n  var parseHashString = function(myWindow) {\n    myWindow = myWindow || window;\n    if (!myWindow || !myWindow.location || !myWindow.location.hash ||\n        myWindow.location.hash === '') {\n      return {};\n    }\n    return parseQuery(myWindow.location.hash);\n  };\n\n  /**\n   * Gets a cookie, if it exists returns it's value or empty array otherwise\n   */\n  var getCookie = function(name) {\n    var value = getCookieWithoutCrazyness(name);\n    if (value === null) {\n      return [];\n    }\n    try {\n      return JSON.parse(value);\n    } catch(e) {\n      return eval(value);\n    }\n  };\n\n  var hasCookie = function(name) {\n    return getCookieWithoutCrazyness(name) !== null;\n  };\n\n  var getCookieWithoutCrazyness = function(name) {\n    var nameEQ = name + '=';\n    var ca = document.cookie.split(';');\n    for ( var i = 0; i < ca.length; i++) {\n      var c = ca[i];\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1, c.length);\n      }\n      if (c.indexOf(nameEQ) === 0) {\n        var value = decodeURIComponent(c.substring(nameEQ.length, c.length));\n        return value;\n      }\n    }\n    return null;\n  };\n\n  var topDomainToCookie = function(domain) {\n    if (domain === 'localhost') {\n      return '';\n    }\n    var td = getTopDomain(domain);\n    return 'domain=' + td;\n  };\n\n  var getTopDomain = function(domain) {\n    var ipPattern = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n    if (ipPattern.test(domain)) {\n        return domain;\n    }\n    var dparts = domain.split('.');\n    var l = dparts.length;\n    var partsToKeep = Math.min(l, 2);\n    // handle *.co.uk, *.co.jp, *.com.tk, etc domains\n    if (l > 2 && ('co' === dparts[l - 2] || 'com' === dparts[l - 2] ||\n      ('azurewebsites' === dparts[l - 2] && 'net' === dparts[l - 1])) ||\n      ('cloudfront' === dparts[l - 2] && 'net' === dparts[l - 1])) {\n        partsToKeep = 3;\n    }\n    return '.' + dparts.slice(l-partsToKeep).join('.');\n  };\n\n  /**\n   * merges two or more objects. the later one overwrites the previous object\n   *\n   * @return\n   */\n  var merge = function() {\n    var i, l = arguments.length, result = {}, o, k;\n    for (i = 0; i < l; i++) {\n      o = arguments[i];\n      if (o) {\n        for (k in o) {\n          if (o.hasOwnProperty(k)) {\n            result[k] = o[k];\n          }\n        }\n      }\n    }\n\n    return result;\n  };\n\n  // MDN polyfill\n  var indexOf = function(array, searchElement, fromIndex) {\n    if (Array.prototype.indexOf) {\n      return array.indexOf(searchElement, fromIndex);\n    }\n    var k;\n    if (array == null) {\n      throw new TypeError('\"this\" is null or not defined');\n    }\n    var O = Object(array);\n    var len = O.length >>> 0;\n    if (len === 0) {\n      return -1;\n    }\n    var n = +fromIndex || 0;\n    if (Math.abs(n) === Infinity) {\n      n = 0;\n    }\n    if (n >= len) {\n      return -1;\n    }\n    k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n    while (k < len) {\n      if (k in O && O[k] === searchElement) {\n        return k;\n      }\n      k++;\n    }\n    return -1;\n  };\n\n  // You-Dont-Know-JS polyfill\n  var isNaN;\n  if (!Number.isNaN) {\n    isNaN = function(n) {\n        return n !== n;\n    };\n  } else {\n    isNaN = Number.isNaN;\n  }\n\n\n  var indexOfItem = function(array, needle, id) {\n    var i, l;\n    if (!array || (array && !array.length)) {\n      return -1;\n    }\n    l = array.length;\n    for (i = 0; i < l; i++) {\n      if (typeof needle === \"string\") {\n        if (typeof array[i] !== 'undefined' && array[i][id] === needle) {\n          return i;\n        }\n      } else {\n        if (typeof array[i] !== 'undefined' && needle.equal(array[i])) {\n          return i;\n        }\n      }\n    }\n    return -1;\n  };\n\n  /**\n   * Returns the deep copy of the source object. Usage: var target =\n   * deepCopy(source);\n   *\n   * Code copied from\n   * http://javascript.about.com/od/objectorientedjavascript/a/oop17.htm\n   *\n   * Hey andras from the past, thanks for copy-pasting buggy code from\n   * the internet and making future andras's life a tiny bit harder.\n   * Also, technical dept is a bitch.\n   */\n  var deepCopy = function(source, target) {\n    target = target || {};\n    for (var i in source) {\n      if (!source.hasOwnProperty(i)) {\n        continue;\n      }\n      if (source[i] !== null && typeof source[i] === 'object') {\n        target[i] = (source[i].constructor === Array) ? [] : {};\n        deepCopy(source[i], target[i]);\n      } else {\n        target[i] = source[i];\n      }\n    }\n    return target;\n  };\n\n  /**\n   * augment a constructor functions prototype with other functions first\n   * param is the constructor function second and subsequent params are the\n   * interface functions\n   */\n  var augment = function() {\n    var i, l = arguments.length, f, cf = arguments[0];\n    for (i = 1; i < l; i++) {\n      f = arguments[i];\n      f.call(cf.prototype);\n    }\n  };\n\n  var bind = function(fn, context) {\n    return function() {\n      var f = fn, c = context;\n      f.apply(c, arguments);\n    };\n  };\n\n  var trim = function(str) {\n    // polyfill from\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim\n    return !!String.prototype.trim ? str.trim()\n      : str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n  };\n\n  var playQueue = function(publicAPI, queue) {\n    var Queue = function(queue) {\n      if (!(queue instanceof Array)) {\n        if (queue instanceof Queue) {\n          return;\n        }\n        throw new SyntaxError('Scarab Queue is not an array');\n      }\n      for (var i = 0; i < queue.length; ++i) {\n        this.push(queue[i]);\n      }\n    };\n    Queue.prototype.push = function() {\n      for (var i = 0; i < arguments.length; ++i) {\n        var commandArray = arguments[i];\n        if (!(commandArray instanceof Array) && commandArray.length > 0) {\n          throw new SyntaxError('command should be a non-empty array: ' + commandArray);\n        }\n        var command = commandArray[0];\n        var params = [];\n        for (var j = 1; j < commandArray.length; ++j) {\n          params.push(commandArray[j]);\n        }\n        if (publicAPI.hasOwnProperty(command)) {\n          publicAPI[command].apply(null, params);\n        } else {\n          throw new SyntaxError('unknown command: ' + command);\n        }\n      }\n    };\n    return new Queue(queue);\n  };\n\n  var findLocalizedTopic = function(product, topic, language) {\n    if (!language) {\n      return topic;\n    }\n    if (!product || !product.category || !topic || !product['c_category_' + language]) {\n      return '';\n    }\n    var indx = ScarabArrays.findIndex(product.category.split('|'), function(category) {\n      return category.indexOf(topic) === 0;\n    });\n    if (indx === -1) {\n      return '';\n    }\n    var locCategories = product['c_category_' + language].split('|');\n    var locCategory = locCategories[Math.min(indx, locCategories.length - 1)];\n    var topicSpec = topic.split('>').length;\n    var locCategoryLevels = locCategory.split('>');\n    return locCategoryLevels.length === topicSpec ? locCategory : locCategoryLevels.slice(0, topicSpec).join('>');\n  };\n\n  var isArray = Array.isArray || function(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n  };\n\n/* jshint ignore:start */\n/*\nCryptoJS v3.1.2\ncode.google.com/p/crypto-js\n(c) 2009-2013 by Jeff Mott. All rights reserved.\ncode.google.com/p/crypto-js/wiki/License\n*/\nvar CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty(\"init\")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty(\"toString\")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},\nn=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<\n32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join(\"\")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,\n2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join(\"\")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error(\"Malformed UTF-8 data\");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},\nk=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){\"string\"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);\na._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,\nf)).finalize(b)}}});var s=p.algo={};return p}(Math);\n(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^\nk)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();\n/* jshint ignore:end */\n\n  var sha1 = function(s) {\n    return CryptoJS.SHA1(s).toString(CryptoJS.enc.Hex);\n  };\n\n  var staticResource = function(path) {\n    return '//cdn.scarabresearch.com/static' + path;\n  };\n\n  var localResource = function(path) {\n    return 'http://local.scarabresearch.com:3000' + path;\n  };\n\n  var modules = {\n    inspector: {\n      path: staticResource('/inspector/scarab-inspector.min.js'),\n      devPath: localResource('/build/scarab-inspector.js')\n    },\n    discovery: {\n      path: staticResource('/discovery/scarab-discovery.js')\n    },\n    assistant: {\n      path: staticResource('/assistant/scarab-assistant.js'),\n      devPath: localResource('/build/scarab-assistant.js'),\n      durationSeconds: 24 * 60 * 60\n    },\n    mobildisco: {\n      path: staticResource('/mobildisco/build.js'),\n      devPath: localResource('/build/build.js'),\n      durationSeconds: 24 * 60 * 60\n    },\n    horus: {\n      path: staticResource('/horus/horus.js'),\n      devPath: localResource('/build/horus.js'),\n      durationSeconds: 7 * 24 * 60 * 60\n    },\n    hooked: {\n      path: staticResource('/hooked/scarab-hooked.js'),\n      devPath: localResource('/hooked/build/scarab-hooked.js')\n    }\n  };\n\n  var loader = function(module, cb, hashConfig) {\n    var id = 'scarab-' + module;\n    if (document.getElementById(id)) {\n      return;\n    }\n    hashConfig = modules[module].config || hashConfig;\n    var src = modules[module].path;\n    if (hashConfig && hashConfig.dev) {\n      src = modules[module].devPath;\n    }\n    if (hashConfig && hashConfig.devSsl) {\n      src = modules[module].devPath\n        .replace(/http:\\/\\/local.scarabresearch.com:3000/g, 'https://dafay6v9gkf6n.cloudfront.net');\n    }\n    if (hashConfig && hashConfig.devPort) {\n      var port = parseInt(hashConfig.devPort || '3000', 10);\n      if (port !== port || port < 0 || port > 65535) {\n        return;\n      }\n      src = modules[module].devPath\n        .replace(/local.scarabresearch.com:3000/g, 'build.dev.scarabresearch.com:' + port);\n    }\n\n    ScarabUtil.script = ScarabUtil.script || {};\n\n    var callback = function(module){\n      if (!cb || !module) {\n        return;\n      }\n      var cbTemp = cb;\n      cb = null;\n      cbTemp(module, hashConfig);\n    };\n    ScarabUtil.scriptCb = ScarabUtil.scriptCb || {};\n    ScarabUtil.scriptCb[id] = callback;\n\n    var js = document.createElement('script');\n    js.id = id;\n    js.src = src;\n    js.charset = 'utf-8';\n    var fs = document.getElementsByTagName('script')[0];\n\n    var ieLoadBugFix = function(scriptElement, callback) {\n      if (ScarabUtil.script[id]) {\n          return;\n      }\n      if (scriptElement.readyState === 'loaded' || scriptElement.readyState === 'completed') {\n          callback();\n      } else {\n          setTimeout(function() {\n              ieLoadBugFix(scriptElement, callback);\n          }, 100);\n      }\n    };\n    js.onload = function(){\n      callback(ScarabUtil.script[id]);\n    };\n    ieLoadBugFix(js, function(){\n      callback(ScarabUtil.script[id]);\n    });\n\n    fs.parentNode.insertBefore(js, fs);\n  };\n\n  var loadModules = function(actions, myWindow) {\n    myWindow = myWindow || window;\n    var hash = parseHashString(myWindow);\n    if (!window.JSON) {\n      return;\n    }\n    var callGo = function(m) {\n      m.go();\n    };\n\n    for (var m in modules) {\n      if (modules.hasOwnProperty(m)) {\n        var moduleName = 'sc_' + m;\n        if (hash[moduleName] !== undefined) {\n          var val = hash[moduleName] || '{}';\n          try {\n            JSON.parse(val);\n          } catch (e) {\n\n            if (myWindow.console && myWindow.console.error) {\n              console.error('Hash config for', moduleName, 'is not a valid JSON: ', e);\n            }\n            continue;\n          }\n          var later = new Date();\n          later.setSeconds(later.getSeconds() + (modules[m].durationSeconds || 30 * 60));\n          document.cookie = moduleName + '=' + encodeURIComponent(val) + ';expires=' + later.toUTCString() + ';path=/';\n        }\n        var hashConfig = getCookieWithoutCrazyness(moduleName);\n        if (hashConfig !== null) {\n\n          try {\n            hashConfig = JSON.parse(hashConfig);\n            modules[m].config = hashConfig;\n          } catch(e) {\n            if (myWindow.console && myWindow.console.error) {\n              console.error('Bad hash config found in cookie', moduleName, ':', e);\n            }\n            continue;\n          }\n          if (actions[m]) {\n            actions[m](hashConfig);\n          } else {\n            loader(m, callGo, hashConfig);\n          }\n        }\n      }\n    }\n  };\n\n  var isMobile = function isMobile(myWindow) {\n    // recommended way of user agent sniffing (don't do it:)\n    // https://developer.mozilla.org/en-US/docs/Browser_detection_using_the_user_agent#Mobile.2C_Tablet_or_Desktop\n\n    myWindow = myWindow || window;\n    var w = myWindow.innerWidth,\n        h = myWindow.innerHeight,\n        n = myWindow.navigator;\n\n    return myWindow.matchMedia ?\n        myWindow.matchMedia('only screen and (max-device-width : 480px)').matches && n.userAgent && n.userAgent.search('Mobi') > -1 :\n        w && h && n && n.userAgent &&\n        Math.min(w, h) <= 480 &&\n        n.userAgent.search('Mobi') > -1;\n  };\n\n  return {\n    prettyPrice: prettyPrice,\n    redirect: redirect,\n    sc_params: sc_params,\n    addTrackingParams: addTrackingParams,\n    appendParams: appendParams,\n    getCookie: getCookie,\n    hasCookie: hasCookie,\n    topDomainToCookie: topDomainToCookie,\n    getTopDomain: getTopDomain,\n    redirectWithScParams: function(link, merchant, item, feature, cohort) {\n      return redirect(sc_params(link, feature, cohort), merchant, item, feature, cohort);\n    },\n    parseQueryString: parseQueryString,\n    parseHashString: parseHashString,\n    merge: merge,\n    isNaN: isNaN,\n    indexOf: indexOf,\n    indexOfItem: indexOfItem,\n    deepCopy: deepCopy,\n    augment: augment,\n    bind: bind,\n    sha1: sha1,\n    trim: trim,\n    isArray: isArray,\n    findLocalizedTopic: findLocalizedTopic,\n    playQueue: playQueue,\n    script: {},\n    modules: modules,\n    loader: loader,\n    loadModules: loadModules,\n    isMobile: isMobile\n  };\n}();\nif (typeof window !== 'undefined') {\n  window.ScarabArrays = ScarabArrays;\n}\n\nif (typeof window !== 'undefined') {\n  window.ScarabUtil = ScarabUtil;\n}\n\n/**package\n{\n  \"name\": \"scarab-v2\",\n  \"version\": \"2.0.1\"\n}\n**/\n/* globals JSON, doT */\n'use strict';\n\nvar ScarabModule = function(win, config) {\n    config = config || {};\n    var STRINGS = {\n        VIEWCOOKIE : 'scarab.mayViewed',\n        ADDCOOKIE : 'scarab.mayAdd',\n        VISITORCOOKIE : 'scarab.visitor',\n        PROFILECOOKIE : 'scarab.profile'\n    }, SERIALIZE = {\n        // These are properties of Transaction objects.\n        // Make sure these are arrays.\n        'v' : 'views',\n        'ai' : 'addedItems',\n        'ca' : 'cart',\n        'co' : 'checkouts',\n        'k' : 'keywords',\n        'q' : 'searchTerm',\n        'vc' : 'category',\n        'cp' : 'compactProducts',\n        'lang': 'language',\n        'az': 'availabilityZone'\n    }, EVENT = {\n        'pageview': 1,\n        'addView' : 2,\n        'checkAddedItem' : 3,\n        'addAddedItem' : 4,\n        'addCartItem' : 5,\n        'setCart' : 6,\n        'addCheckoutItem' : 7,\n        'setPurchase': 8,\n        'commit' : 9\n    }, FEATURETRIGGERS = {\n        'RELATED': {\n            trigger: 'view',\n            validate: function(tr){ return tr.views && tr.views.length > 0;}\n        },\n        'ALSO_BOUGHT': {\n            trigger: 'view',\n            validate: function(tr){ return tr.views && tr.views.length > 0;}\n        },\n        'CART': {\n            trigger: 'cart',\n            validate: function(tr){ return tr.cart && tr.cart.length > 0 || tr.cart && tr.cart.v > 0;}\n        }\n    };\n\n    if (ScarabUtil.inspector && !config.doNotInspect) {\n        ScarabUtil.inspector.FEATURETRIGGERS = FEATURETRIGGERS;\n    }\n\n    /* jshint ignore:start */\n    // doT.js\n    // (c) 2011, Laura Doktorova\n    // https://github.com/olado/doT\n    //\n    // doT is an extraction and slight modification of an excellent\n    // templating function from jQote2.js (jQuery plugin) by aefxx\n    // (http://aefxx.com/jquery-plugins/jqote2/).\n    //\n    // Modifications:\n    // 1. nodejs support\n    // 2. allow for custom template markers\n    // 3. only allow direct invocation of the compiled function\n    //\n    // Licensed under the MIT license.\n\n    var doT = (function() {\n\n        var doT = {\n            version : '0.1.0'\n        };\n\n        doT.templateSettings = {\n            begin : '{{',\n            end : '}}',\n            varname : 'it'\n        };\n\n        doT.template = function(tmpl, conf) {\n            conf = conf || doT.templateSettings;\n            var str = '', tb = conf.begin, te = conf.end, m, l, arr = tmpl\n                    .replace(\n                            /\\s*<!\\[CDATA\\[\\s*|\\s*\\]\\]>\\s*|[\\r\\n\\t]|(\\/\\*[\\s\\S]*?\\*\\/)/g,\n                            '').split(tb).join(te + '\\x1b').split(te);\n\n            l = arr.length;\n            for (m = 0; m < l; m++) {\n                str += arr[m].charAt(0) !== '\\x1b' ? \"out+='\"\n                        + arr[m].replace(/(\\\\|[\"'])/g, '\\\\$1') + \"'\"\n                        : (arr[m].charAt(1) === '=' ? ';out+=('\n                                + arr[m].substr(2) + ');'\n                                : (arr[m].charAt(1) === '!' ? ';out+=('\n                                        + arr[m].substr(2)\n                                        + \").toString().replace(/&(?!\\\\w+;)/g, '&#38;').split('<').join('&#60;').split('>').join('&#62;').split('\"\n                                        + '\"' + \"').join('&#34;').split(\" + '\"'\n                                        + \"'\" + '\"' + \").join('&#39;');\"\n                                        : ';' + arr[m].substr(1)));\n            }\n\n            str = 'try{'\n                    + ('var out=\"\";' + str + ';return out;').split(\"out+='';\")\n                            .join('').split('var out=\"\";out+=')\n                            .join('var out=')\n                    + '} catch(e){e.type=\"TemplateExecutionError\";e.args=arguments;e.template=arguments.callee.toString();'\n                    + 'throw new SyntaxError(\"Error in Scarab template.\");}';\n\n            try {\n                return new Function(conf.varname, str);\n            } catch (e) {\n                if (window.console && console.warn) {\n                    console.warn('Could not create a template function: ' + str, e);\n                }\n                throw new SyntaxError('Error in Scarab template.');\n            }\n        };\n\n        return doT;\n\n    }());\n    doT.templateSettings = {\n        begin : '{{',\n        end : '}}',\n        varname : 'SC'\n    };\n    /* jshint ignore:end */\n\n    var w = win || window,\n        sessionId,\n        visitorId,\n        customerId,\n        profile,\n        emailHash,\n        trafficSource,\n        emsUid,\n        emsLid,\n        emsLlid,\n        fields,\n        merchantId,\n        testMode,\n        debugMode,\n        serverUrl,\n        trackedFeature,\n        trackedCohort,\n        forcedCohort,\n        transactions = {},\n        transactionCounter = 0,\n        transactionListeners = [],\n        products = {},\n        features = [],\n        beforeRendering = null,\n        afterRendering = null,\n        skipRendering = false,\n        pageViewId = 0;\n\n    var addEvent = function(o, name, fn, ctx) {\n        if (!o) {\n            return;\n        }\n        var evl;\n        if (o.addEventListener) {\n            evl = ScarabUtil.bind(fn, ctx);\n            o.addEventListener(name, evl, false);\n        } else if (o.attachEvent) {\n            evl = ScarabUtil.bind(fn, ctx);\n            o.attachEvent('on' + name, evl);\n        }\n        return evl;\n    };\n\n    var ISerializable = (function() {\n        var serialize = function() {\n            var s = [], i, sp = this.serializableProperties, l = sp.length, cp;\n\n            for (i = 0; i < l; i++) {\n                cp = sp[i];\n                if (this.hasOwnProperty(cp) && (this[cp] || this[cp] === 0)) {\n                    s.push(cp + ':' + this[cp]);\n                }\n            }\n            return s.join(',');\n        };\n\n        return function() {\n            this.serialize = serialize;\n        };\n    }());\n\n    var IComparable = (function() {\n        var equal = function(other) {\n            return this.compare(other);\n        };\n\n        return function() {\n            this.equal = equal;\n        };\n    }());\n\n    var IMergable = (function() {\n\n        var merge = function() {\n            var i, l = arguments.length, co, prop;\n\n            for (i = 0; i < l; i++) {\n                co = arguments[i];\n                for (prop in co) {\n                    if (co.hasOwnProperty(prop)) {\n                        this[prop] = co[prop];\n                    }\n                }\n            }\n        };\n\n        return function() {\n            this.merge = merge;\n        };\n    }());\n\n    var Item = function(config) {\n        // IMPORTANT!\n        // this URL encoding is just a way of escaping special characters in the\n        // item ID (comma, pipe, colon)\n        // recserver will url-decode this part of the string\n        this.i = encodeURIComponent(config.i + '') || null; // itemId\n        this.t = config.t || null; // tracking code (feature id)\n        this.p = config.p === 0 ? 0 : (config.p || null); // price\n        this.q = config.q || null; // quantity\n        this.c = config.c || null; // cohort\n    };\n    ScarabUtil.augment(Item, ISerializable, IComparable, IMergable);\n    Item.prototype.serializableProperties = [ 'i', 't', 'p', 'q', 'c' ];\n    Item.prototype.compare = function(otherItem) {\n        return this.i === otherItem.i;\n    };\n\n    var Feature = function(config) {\n        this.f = config.f || null; // feature\n        this.l = config.l || null; // limit\n        this.o = (typeof config.o === 'undefined') ? null : config.o; // offset\n        // allow special characters in trigger\n        this.t = config.t ? encodeURIComponent(config.t) : null;\n        this.hasMore = false; // true if there are more items form this feature\n        this.cohort = '';\n        this.merchants = [];\n        this.containerId = config.containerId || null;\n        this.parent = this.containerId ? document.getElementById(this.containerId) : null;\n        this.template = config.template || null; // template\n        this.pages = config.pages || []; // loaded pages\n        this.currentPage = null; // current page\n        this.attachedListeners = config.attachedListeners || false;\n        this.transaction = null;\n        this.pi = null;\n        this.cust = config.cust || null;\n        this.requestSent = false;\n    };\n    ScarabUtil.augment(Feature, ISerializable, IComparable);\n    Feature.prototype.serializableProperties = [ 'f', 'l', 'o', 't', 'cust' ];\n    Feature.prototype.compare = function(otherItem) {\n        return this.f === otherItem.f;\n    };\n    Feature.prototype.getProducts = function() {\n        var i, l = this.pages.length, result = [], page;\n        for (i = 0; i < l; i++) {\n            page = this.pages[i];\n            result = result.concat(page.products);\n        }\n\n        return result;\n    };\n    Feature.prototype.purgePagesCache = function() {\n        this.pages = [];\n        this.currentPage = null;\n    };\n    var findProductsMSIE = function(root) {\n        var productIds = [];\n        if (typeof (root.getAttribute) !== 'undefined') {\n            var dataitem = root.getAttribute('data-scarabitem');\n            if (dataitem) {\n                productIds.push(dataitem);\n            }\n        }\n        if (root.childNodes.length === 0) {\n            return productIds;\n        }\n        for ( var i = 0; i < root.childNodes.length; ++i) {\n            var subresult = findProductsMSIE(root.childNodes[i]);\n            productIds = productIds.concat(subresult);\n        }\n        return productIds;\n    };\n    Feature.prototype.findProducts = function() {\n        if (typeof (NodeFilter) === 'undefined') {\n            return findProductsMSIE(this.parent);\n        }\n        var walker = document.createTreeWalker(this.parent,\n                NodeFilter.SHOW_ELEMENT, null, false), productIds = [], el, dataitem;\n        do {\n            el = walker.currentNode;\n            dataitem = el.getAttribute('data-scarabitem');\n            if (dataitem) {\n                productIds.push(dataitem);\n            }\n        } while (walker.nextNode());\n        return productIds;\n    };\n    Feature.prototype.setProducts = function(pi) {\n        this.pi = pi;\n    };\n    Feature.prototype.setPage = function(page) {\n        var that = this;\n        this.parent = document.getElementById(this.containerId);\n\n        if (!this.parent && window.console && console.error) {\n            console.error('container not found: \"' + this.containerId + '\"');\n        }\n\n        var renderCallback = function(SC, skipScarabRendering) {\n            return that.render(SC, skipScarabRendering);\n        };\n        var SC;\n        this.currentPage = page;\n        SC = this.getDataForRendering();\n        if (beforeRendering) {\n            beforeRendering(SC);\n        }\n        if (this.successCallback) {\n            try {\n                this.successCallback(SC, renderCallback);\n            } catch (e) {\n                if (window.console && console.warn) {\n                    console.warn('Error in successCallback.', e);\n                }\n            }\n        } else if (!skipRendering) {\n            publicInterface.invokeRendering(SC, renderCallback);\n        }\n        this.attachListeners();\n        if (afterRendering) {\n            afterRendering(SC);\n        }\n    };\n    Feature.prototype.addPage = function(page) {\n        this.pages.push(page);\n        this.setPage(page);\n    };\n    Feature.prototype.previousPage = function() {\n        var index = ScarabUtil.indexOfItem(this.pages, this.currentPage);\n        if (index > 0) {\n            this.setPage(this.pages[index - 1]);\n        }\n    };\n    Feature.prototype.nextPage = function() {\n        var index = ScarabUtil.indexOfItem(this.pages, this.currentPage);\n        if (index !== -1) {\n            if (index < this.pages.length - 1) {\n                this.setPage(this.pages[index + 1]);\n            } else if (this.hasMore) {\n                this.o += this.l;\n                publicInterface.setCohortId(this.cohort);\n                this.requestSent = false;\n                this.transaction.sendRequest();\n            }\n        }\n    };\n    Feature.prototype.getDataForRendering = function() {\n        var SC = {};\n        SC.page = ScarabUtil.deepCopy(this.currentPage);\n        SC.topic = this.topicLabel;\n        SC.topicLocalized = this.transaction.language && this.transaction.language[0] ?\n            ScarabUtil.findLocalizedTopic(SC.page.products[0], this.topicLabel, this.transaction.language[0])\n            : this.topicLabel;\n        SC.recommender = {};\n        SC.recommender.f = this.f;\n        SC.recommender.limit = this.l;\n        SC.recommender.container = this.parent;\n        SC.cohort = this.cohort;\n        SC.merchants = this.merchants;\n        return SC;\n    };\n    var getElementsByClassName = function(container, button) {\n        if (container.getElementsByClassName) {\n            return container.getElementsByClassName(button);\n        }\n        var all = container.getElementsByTagName('*');\n        var ret = [];\n        for (var i = 0; i < all.length; i++) {\n            if (all[i].className === button) {\n                ret.push(all[i]);\n            }\n        }\n        return ret;\n    };\n    var disableButton = function(container, button) {\n        var buttons = getElementsByClassName(container, button);\n        for ( var i = 0; i < buttons.length; ++i) {\n            var className = buttons[i].className;\n            buttons[i].className = className + ' scarab-disabled-button';\n        }\n    };\n    Feature.prototype.render = function(SC, skipScarabRendering) {\n        var el = this.parent;\n        if (typeof (this.template) === 'function' && !skipScarabRendering) {\n            if (!el) {\n                throw 'DOM element \"' + this.containerId + '\" not found \"';\n            }\n            if (el !== document.getElementById(el.id)) {\n                // Oooops, probably they threw out 'el', and replaced it with a\n                // new element with the same id!\n                el = document.getElementById(el.id);\n                this.parent = el;\n                this.attachedListeners = false;\n            }\n            el.innerHTML = this.template(SC);\n            var index = ScarabUtil.indexOfItem(this.pages, this.currentPage);\n            if (index === 0) {\n                disableButton(el, 'scarab-prev');\n            }\n            if (index === this.pages.length - 1 && !this.hasMore) {\n                disableButton(el, 'scarab-next');\n            }\n        }\n    };\n    Feature.prototype.attachListeners = function() {\n        if (this.attachedListeners) {\n            return;\n        }\n        this.attachedListeners = true;\n        clearOldFeatureListeners(this);\n        var el = this.parent;\n        this.elistener = addEvent(el, 'click', this.eventListener, this);\n    };\n\n    Feature.prototype.eventListener = function(e) {\n        var element = e.srcElement || e.target, cssClass, classes = [], i, l, dataitem;\n        do {\n            dataitem = element.getAttribute ? element.getAttribute('data-scarabitem') : null;\n            if (dataitem) {\n                return Feature.eventsHandlers['scarab-item'].call(this,\n                        dataitem, this.f, this.cohort);\n            }\n            cssClass = element.className || '';\n            classes = cssClass.split(' ');\n            l = classes.length;\n            for (i = 0; i < l; i++) {\n                if (classes[i] in Feature.eventsHandlers) {\n                    return Feature.eventsHandlers[classes[i]].call(this, element);\n                }\n            }\n            element = element.parentNode;\n        } while (element && element !== this.parent);\n        return true;\n    };\n    Feature.eventsHandlers = {\n        'scarab-item' : function(productId, feature, cohort) {\n            publicInterface.itemClick(productId, feature, cohort);\n        },\n        'scarab-prev' : function() {\n            this.previousPage();\n        },\n        'scarab-next' : function() {\n            this.nextPage();\n        }\n    };\n\n    if (ScarabUtil.inspector && !config.doNotInspect) {\n        ScarabUtil.inspector.trackObjectFunctions('Feature', Feature.prototype);\n    }\n\n    var Page = function() {\n        this.products = [];\n    };\n    ScarabUtil.augment(Page, IComparable);\n    Page.prototype.compare = function(otherItem) {\n        return otherItem === this;\n    };\n    Page.prototype.addProduct = function(product) {\n        this.products.push(product);\n    };\n    Page.prototype.removeProduct = function() {\n    };\n\n    var OrderedItemEventQueue = function(transaction) {\n        this.isPlaying = false;\n        this.tick = null;\n        this.events = [];\n        this.transaction = transaction;\n        this.playcounter = 0;\n    };\n    OrderedItemEventQueue.prototype.add = function(event) {\n        this.events.push(event);\n        this.events.sort(this.compareEvent);\n    };\n    OrderedItemEventQueue.prototype.compareEvent = function(a, b) {\n        if (a.item && b.item && a.item.i && b.item.i && a.item.i !== b.item.i) {\n            return a.item.i < b.item.i ? -1 : 1;\n        } else {\n            if (EVENT[a.event] === EVENT[b.event]) {\n                return 0;\n            }\n            return (EVENT[a.event] < EVENT[b.event]) ? -1 : 1;\n        }\n    };\n    OrderedItemEventQueue.prototype.hasNonTrivialEvents = function() {\n        for (var i = 0; i < this.events.length; i++) {\n            if (this.events[i].event !== 'commit' || this.events[i].forceSend) {\n                return true;\n            }\n        }\n        return false;\n    };\n    OrderedItemEventQueue.prototype.shouldSend = function() {\n        return (this.hasNonTrivialEvents()\n                || customerId\n                || emailHash\n                || trafficSource\n                || emsLid\n                || emsLlid\n                || emsUid\n                || this.transaction.features.length > 0\n                || this.transaction.keywords && this.transaction.keywords.length > 0\n                || (this.transaction.searchTerm && this.transaction.searchTerm.length > 0)\n                || (this.transaction.category && this.transaction.category.length > 0)\n                || (this.transaction.tags && this.transaction.tags.length > 0)\n                || (this.transaction.errors && this.transaction.errors.length > 0));\n    };\n    OrderedItemEventQueue.prototype._play = function() {\n        var transaction = this.transaction, e;\n        this.isPlaying = true;\n\n        if (!this.shouldSend()) {\n            this.clear();\n        }\n        while (this.events.length) {\n            e = this.events.shift();\n            transaction.eventHandlers[e.event].call(transaction, e.item);\n        }\n        this.isPlaying = false;\n    };\n\n    OrderedItemEventQueue.prototype.play = function(immediate) {\n        if (this.isPlaying) {\n            return true;\n        }\n\n        if (this.tick) {\n            w.clearTimeout(this.tick);\n        }\n\n        if (immediate) {\n            this._play();\n        } else {\n            this.tick = w.setTimeout(ScarabUtil.bind(this._play, this), 100);\n        }\n\n    };\n    OrderedItemEventQueue.prototype.clear = function() {\n        this.events = [];\n    };\n\n    var setCookie = function(name, cookieValue, expires) {\n        if (document.domain.indexOf('mvideo.ru') >= 0) {\n          document.cookie = name + '=; path=/;' + ScarabUtil.topDomainToCookie(document.domain)\n              + '; expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n          document.cookie = name + '=' + encodeURIComponent(cookieValue)\n              + '; path=/; domain=' + document.domain\n              + (expires ? ' ; expires=' + expires + ';' : '');\n        } else {\n          document.cookie = name + '=' + encodeURIComponent(cookieValue)\n              + '; path=/;' + ScarabUtil.topDomainToCookie(document.domain)\n              + (expires ? ' ; expires=' + expires + ';' : '');\n        }\n    };\n\n    /**\n     * Serialize a list of tracking codes into a cookie\n     */\n    var serializeCookie = function(name, collection) {\n        var key, serializedPairs, serializedObjects, i, cookieValue = '[';\n\n        /*\n         * Serialize tracking code list: Array of itemId - tracking code pairs,\n         * eg: [{itemId: \"i1\", featureId: \"RELATED\"}, {..}, ...]\n         */\n        serializedObjects = [];\n\n        for (i = 0; i < collection.length; i++) {\n            serializedPairs = [];\n            for (key in collection[i]) {\n                if (collection[i].hasOwnProperty(key)\n                        && (collection[i][key] || collection[i][key] === 0)) {\n                    serializedPairs.push('\"' + key + '\":\"' + collection[i][key] + '\"');\n                }\n            }\n            if (serializedPairs.length) {\n                serializedObjects.push('{' + serializedPairs.join(',') + '}');\n            }\n        }\n        if (serializedObjects.length) {\n            cookieValue += serializedObjects.join(',');\n        }\n        cookieValue += ']';\n\n        /*\n         * Save the serialized list into a cookie named 'name' The created\n         * cookie expires, when the browser closed\n         */\n         setCookie(name, cookieValue);\n    };\n\n    var findInCookie = function(cname, item) {\n        var c = ScarabUtil.getCookie(cname), i, l = c.length;\n\n        for (i = 0; i < l; i++) {\n            if (i in c && item.equal(c[i])) {\n                return c[i];\n            }\n        }\n        return null;\n    };\n\n    var removeFromCookie = function(cname, item) {\n        var c = ScarabUtil.getCookie(cname), i = ScarabUtil.indexOfItem(c, item);\n        if (i > -1) {\n            c.splice(i, 1);\n        }\n        serializeCookie(cname, c);\n    };\n\n    var addCookie = function(cname, item) {\n        var c = ScarabUtil.getCookie(cname), i = ScarabUtil.indexOfItem(c, item);\n        if (c.length > 9) {\n            c.shift();\n        }\n        if (i === -1) {\n            c.push(item);\n            serializeCookie(cname, c);\n        }\n    };\n\n    var Transaction = function(id) {\n        this.name = getTrnName(id);\n        this.views = null;\n        this.addedItems = null;\n        this.cart = null;\n        this.features = [];\n        this.productIds = [];\n        this.checkouts = null;\n        this.orderId = '';\n        this.callbackName = '';\n        this.events = new OrderedItemEventQueue(this);\n        this.keywords = null;\n        this.searchTerm = null;\n        this.category = null;\n        this.tags = null;\n        this.exclude = [];\n        this.compactProducts = ['1'];\n        this.id = id;\n        this.errors = null;\n        this.language = null;\n        this.availabilityZone = null;\n        this.isNewPageView = false;\n    };\n\n    Transaction.prototype = {\n        eventHandlers : {\n            addView : function(viewedItem) {\n                this.views = this.views || [];\n\n                if ( this.views && this.views.length > 0) {\n                    this.error({t: 'MULTIPLE_CALL', c: 'view', m: 'Multiple calls of view command'});\n                }\n\n                var v = findInCookie(STRINGS.VIEWCOOKIE, viewedItem);\n                if (v) {\n                    viewedItem.merge(v);\n                    removeFromCookie(STRINGS.VIEWCOOKIE, viewedItem);\n                }\n                if (trackedFeature) {\n                    viewedItem.t = trackedFeature;\n                }\n                if (trackedCohort) {\n                    viewedItem.c = trackedCohort;\n                }\n                this.views.push(viewedItem);\n                addCookie(STRINGS.ADDCOOKIE, viewedItem);\n            },\n            pageview: function(pageViewId) {\n                if (pageViewId === undefined || pageViewId === null) {\n                    this.isNewPageView = true;\n                    pageViewId = generatePageViewId();\n                } else {\n                    // in case multiple pageview events are in the transaction\n                    this.isNewPageView = false;\n                }\n                setPageViewId(pageViewId);\n            },\n            checkAddedItem : function(addedItem) {\n                var v = findInCookie(STRINGS.VIEWCOOKIE, addedItem);\n                if (v) {\n                    this.addView(addedItem);\n                }\n            },\n            addAddedItem : function(addedItem) {\n                this.addedItems = this.addedItems || [];\n                var a = findInCookie(STRINGS.ADDCOOKIE, addedItem);\n                if (a) {\n                    addedItem.merge(a);\n                    removeFromCookie(STRINGS.ADDCOOKIE, addedItem);\n                }\n                this.addedItems.push(addedItem);\n            },\n            addCartItem : function(cartItem) {\n                this.cart = this.cart || [];\n                if (this.cart.v > 0) {\n                    if (window.console && console.warn) {\n                        console.warn('Do not mix the deprecated \"cartItem\" and the prefered \"cart\" calls.');\n                    }\n                    return;\n                }\n                this.cart.push(cartItem);\n            },\n            setCart : function(cart){\n                if (this.cart) {\n                    this.error({t: 'MULTIPLE_CALL', c: 'cart', m: 'Multiple calls of cart command'});\n                }\n                this.cart = cart;\n                this.cart.v = 1;\n            },\n            addCheckoutItem : function(checkoutItem) {\n                this.checkouts = this.checkouts || [];\n                this.checkouts.push(checkoutItem);\n            },\n            setPurchase: function(conf){\n                if (this.checkouts) {\n                    this.error({t: 'MULTIPLE_CALL', c: 'purchase', m: 'Multiple calls of purchase command'});\n                }\n                this.checkouts = conf.items;\n                if (conf.orderId){\n                    this.orderId = conf.orderId;\n                }\n            },\n            commit : function() {\n                var that = this;\n                that.merchantId = getMerchantId();\n                that.pageViewId = getPageViewId();\n                that.emailHash = emailHash;\n                ScarabArrays.forEach(transactionListeners, function(listener) {\n                    try {\n                        listener(that);\n                    } catch (e) {\n                        that.error({t: 'INVALID_ARG', c: 'addTransactionListener', m: 'transaction listener threw an exception: ' + e});\n                    }\n                });\n                this.sendRequest();\n                start();\n            }\n        },\n        highlightFeatures : function() {\n            if (!debugMode) {\n                return;\n            }\n            for (var i = 0; i < features.length; ++i) {\n                var label = document.createElement('span');\n                label.innerHTML = features[i].f;\n                label.style.background = 'red';\n                features[i].parent.appendChild(label);\n                features[i].parent.style.border = '5px solid red';\n            }\n\n        },\n        setOrderId : function(orderId) {\n            this.orderId = orderId;\n        },\n        addView : function(viewedItem) {\n            this.events.add({\n                item : viewedItem,\n                event : 'addView'\n            });\n        },\n        pageview: function(pageViewId) {\n            this.events.add({\n                item: pageViewId,\n                event : 'pageview'\n            });\n        },\n        addAddedItem : function(addedItem) {\n            this.events.add({\n                item : addedItem,\n                event : 'checkAddedItem'\n            });\n            this.events.add({\n                item : addedItem,\n                event : 'addAddedItem'\n            });\n        },\n        addCartItem : function(cartItem) {\n            this.events.add({\n                item : cartItem,\n                event : 'addCartItem'\n            });\n        },\n        setCart : function(cart){\n            for (var i = 0, l = cart.length; i < l; i++){\n                this.events.add({\n                    item : cart[i],\n                    event : 'checkAddedItem'\n                });\n            }\n            this.events.add({\n                item: cart,\n                event: 'setCart'\n            });\n        },\n        addCheckoutItem : function(checkoutItem) {\n            this.events.add({\n                item : checkoutItem,\n                event : 'addCheckoutItem'\n            });\n        },\n        setPurchase: function(conf){\n            this.events.add({\n                item: conf,\n                event: 'setPurchase'\n            });\n        },\n        addKeyword : function(keyword) {\n            this.keywords = this.keywords || [];\n            this.keywords.push(keyword);\n        },\n        addSearchTerm : function(searchTerm) {\n            this.searchTerm = this.searchTerm || [];\n            this.searchTerm.push(searchTerm);\n        },\n        addCategory : function(category) {\n            this.category = this.category || [];\n            this.category.push(category);\n        },\n        addTag : function(tagStr) {\n            this.tags = this.tags || [];\n            this.tags.push(tagStr);\n        },\n        addExcludeRule : function(e) {\n            this.exclude.push(e);\n        },\n        setAvailabilityZone: function(az) {\n            this.availabilityZone = [az];\n        },\n        setLanguage: function(lang) {\n            this.language = [lang];\n        },\n        error : function(err) {\n            this.errors = this.errors || [];\n            this.errors.push(err);\n            if (window.console && console.error) {\n                console.error(err);\n            }\n        },\n        go : function(immediate, forceSend) {\n            this.time = new Date().getTime();\n            if (!testMode && !config.disableMultiGoCheck && this.id > 1 && Math.abs(transactions[getTrnName(this.id)].time - transactions[getTrnName(this.id-1)].time) < 500) {\n                this.error({t: 'MULTIPLE_CALL', c: 'go', m: 'Multiple calls of go command'});\n            }\n\n            var hasEventType = function(eventType, events) {\n                for (var i = 0; i < events.length; ++i) {\n                    if (events[i].event === eventType) {\n                        return true;\n                    }\n                }\n                return false;\n            };\n            if (trackedFeature && trackedCohort && !hasEventType('addView', this.events.events)) {\n                publicInterface.view('scarab/click',0,0,trackedFeature,trackedCohort);\n            }\n            if (this.id === 1 && !hasEventType('pageview', this.events.events)) {\n                this.events.add({\n                    item : null,\n                    event : 'pageview'\n                });\n            }\n            this.events.add({\n                item : null,\n                event : 'commit',\n                forceSend : forceSend\n            });\n            this.events.play(immediate);\n        },\n        registerFeature : function(feature) {\n            feature.transaction = this;\n            this.features.push(feature);\n        },\n        serializeList : function(list) {\n            var i, l = list.length, o = [];\n            for (i = 0; i < l; i++) {\n                if (list[i].serialize) {\n                    o.push(list[i].serialize());\n                } else {\n                    o.push(list[i]);\n                }\n            }\n            return o.join('|');\n        },\n        serializeContext : function() {\n            var i, list, slist = [];\n\n            slist.push('pv=' + getPageViewId());\n\n            if (!config.isNotNewPageView && this.isNewPageView) {\n                slist.push('xp=1');\n            }\n\n            var unsentFeatures = ScarabArrays.filter(this.features, function(feature) { return !feature.requestSent; });\n            if (unsentFeatures.length > 0) {\n                slist.push('f=' + encodeURIComponent(this.serializeList(unsentFeatures)));\n            }\n\n            var tr = this;\n            ScarabArrays.forEach(unsentFeatures, function(feature) {\n                feature.requestSent = true;\n                for (var key in FEATURETRIGGERS){\n                    if (!feature.t && feature.f && feature.f.indexOf(key) === 0){\n                        var ft = FEATURETRIGGERS[key];\n                        if (ft && typeof ft.validate === 'function' && !ft.validate(tr)) {\n                            //tr.error('no \"' + ft.trigger + '\" trigger for \"' + feature.f + '\" feature.');\n                        }\n                    }\n                }\n            });\n\n            for (i in SERIALIZE) {\n                if (SERIALIZE.hasOwnProperty(i)) {\n                    list = this[SERIALIZE[i]];\n                    if (SERIALIZE[i] === 'cart' && list && list.v && list.v > 0) {\n                        slist.push('cv=' + list.v);\n                    }\n                    if (list === null){\n                        // do nothing\n                    } else if (list.length === 0) {\n                        slist.push(i + '=');\n                    } else if (list.length > 0) {\n                        slist.push(i + '=' +\n                                encodeURIComponent(this.serializeList(list)));\n                    }\n                }\n            }\n\n            for (i = 0; i < this.features.length; i++) {\n                if (this.features[i].pi && this.features[i].pi.length > 0) {\n                    list = Array.prototype.concat([ this.features[i].f ],\n                            this.features[i].pi);\n                    slist.push('pi=' +\n                            encodeURIComponent(this.serializeList(list)));\n                }\n            }\n\n            if (sessionId) {\n                slist.push('s=' + encodeURIComponent(sessionId));\n            }\n            if (visitorId) {\n                slist.push('vi=' + encodeURIComponent(visitorId));\n            }\n            if (profile) {\n                slist.push('p=' + encodeURIComponent(profile));\n            }\n            if (customerId) {\n                slist.push('ci=' + encodeURIComponent(customerId));\n            }\n            if (emailHash) {\n                slist.push('eh=' + encodeURIComponent(emailHash));\n            }\n\n            if (trafficSource && /^email_/.test(trafficSource)) {\n                var campaignId = trafficSource.replace(/^email_/, '');\n                if (campaignId) {\n                    if(!isNaN(campaignId)) {\n                        slist.push('ecid=' + encodeURIComponent(campaignId));\n                    } else {\n                        this.error({t: 'INVALID_ARG', c: 'sc_src', m: 'Invalid argument in email campaign id'});\n                    }\n                }\n            }\n            if (emsLid) {\n                if (!isNaN(emsLid)) {\n                    slist.push('elid=' + encodeURIComponent(emsLid));\n                } else {\n                    this.error({t: 'INVALID_ARG', c: 'sc_lid', m: 'Invalid argument in sc_lid'});\n                }\n            }\n            if (emsLlid) {\n                if (!isNaN(emsLlid)) {\n                  slist.push('ellid=' + encodeURIComponent(emsLlid));\n                } else {\n                    this.error({t: 'INVALID_ARG', c: 'sc_llid', m: 'Invalid argument in sc_llid'});\n                }\n\n            }\n            if (emsUid) {\n                slist.push('euid=' + encodeURIComponent(emsUid));\n            }\n            if (fields) {\n                slist.push('fields=' + encodeURIComponent(this.serializeList(fields)));\n            }\n\n            if (this.exclude.length > 0) {\n                try {\n                    slist.push('ex=' + encodeURIComponent(JSON.stringify(this.exclude)));\n                } catch (e) {\n                }\n            }\n\n            if (tr.tags) {\n                ScarabArrays.forEach(tr.tags, function(t) {\n                    slist.push('t=' + encodeURIComponent(t));\n                });\n            }\n\n            if (forcedCohort) {\n                slist.push('fc=' + encodeURIComponent(forcedCohort));\n            }\n            if (this.orderId) {\n                slist.push('oi=' + encodeURIComponent(this.orderId));\n            }\n\n            if (getTestMode()) {\n                slist.push('test=true');\n            }\n            if (debugMode) {\n                slist.push('debug=' + debugMode);\n            }\n            if (document.referrer) {\n                slist.push('prev_url=' + encodeURIComponent(document.referrer));\n            }\n            if (this.errors) {\n                var errorParam = '';\n                try {\n                    errorParam = JSON.stringify(this.errors);\n                } catch (e) {\n                    var a = [];\n                    for (var i = 0, l = this.errors.length; i < l; i++) {\n                        a.push('{\"t\":\"' + this.errors[i].t + '\",\"c\":\"' + this.errors[i].c + '\",\"m\":\"' + this.errors[i].m + '\"}');\n                    }\n                    errorParam = '[' + a.join(',') + ']';\n                }\n                slist.push('error=' + encodeURIComponent(errorParam));\n            }\n\n            return slist.join('&');\n        },\n        checkRequest : function() {\n            return true;\n        },\n        getHost : function() {\n            if (getServerUrl()) {\n                return getServerUrl() + '/merchants/';\n            }\n            var proto = document.location.protocol;\n            if (proto === 'file:') {\n                proto = 'http:';\n            }\n            return proto + '//recommender.scarabresearch.com/merchants/';\n        },\n        generateUrl : function() {\n\n            if (!this.checkRequest()) {\n                return false;\n            }\n\n            var context = this.serializeContext();\n            if (context.length) {\n                context += '&';\n            }\n            var url = this.getHost() + getMerchantId() + '/?' +\n                context + 'callback=' +\n                this.callbackName;\n\n            return url;\n        },\n        sendRequest : function() {\n            var url = this.generateUrl();\n            var jsonpStem = config.jsonpStem || 'scarab-jsonp';\n            if (this.callbackName === '') {\n                var i = new Image();\n                i.src = url;\n            } else {\n                var s = document.createElement('script');\n                s.src = url;\n                s.id = jsonpStem + '-' + this.callbackName;\n                s.type = 'text/javascript';\n                s.charset = 'UTF-8';\n                document.getElementsByTagName('head')[0].appendChild(s);\n            }\n        },\n\n        findFeature : function(feature) {\n            if (!this.features || this.features.length === 0) {\n                return null;\n            }\n\n            for (var i = 0, l = this.features.length; i < l; i++) {\n                if (this.features[i].f === feature) {\n                    return this.features[i];\n                }\n            }\n            return null;\n        },\n\n\n        callback : function(data) {\n            if (data.trace) {\n                if (window.console && console.log) {\n                    console.log('SCARAB SERVER: ' + data.trace);\n                }\n            }\n            if (data.schema && data.products) {\n                for (var productId in data.products) {\n                    var newProd = {};\n                    for (var j = 0; j < data.schema.length; j++) {\n                        newProd[data.schema[j]] = data.products[productId][j];\n                    }\n                    data.products[productId] = newProd;\n                }\n            }\n            if (data.products) {\n                products = ScarabUtil.merge(products, data.products);\n            }\n            if (data.features) {\n                for (var feature in data.features) {\n                    if (data.features.hasOwnProperty(feature)) {\n                        var currentFeature = this.findFeature(feature);\n                        if (currentFeature) {\n                            var items = data.features[feature].items;\n                            var newPage = new Page();\n                            for (var i = 0; i < items.length; i++) {\n                                var product = ScarabUtil.merge(items[i], products[items[i].id]);\n                                product.trackingCode = feature;\n                                newPage.addProduct(product);\n                            }\n\n                            currentFeature.hasMore = data.features[feature].hasMore;\n                            currentFeature.topicLabel = data.features[feature].topicLabel;\n                            currentFeature.cohort = data.cohort;\n                            currentFeature.merchants = data.features[feature].merchants;\n                            currentFeature.addPage(newPage);\n                        }\n                    }\n                }\n            }\n            this.highlightFeatures();\n\n            var expiration = new Date();\n            expiration.setFullYear(expiration.getFullYear() + 1);\n\n            var vis = data.visitor;\n            if (vis) {\n                setVisitorId(vis);\n                setCookie(STRINGS.VISITORCOOKIE, '\"' + vis + '\"', expiration.toUTCString());\n            }\n\n            var prof = data.profile;\n            if (prof) {\n                setProfile(prof);\n                setCookie(STRINGS.PROFILECOOKIE, '\"' + prof + '\"', expiration.toUTCString());\n            }\n        }\n    };\n\n    if (ScarabUtil.inspector && !config.doNotInspect) {\n        ScarabUtil.inspector.trackObjectFunctions('Transaction', Transaction.prototype);\n        ScarabUtil.inspector.trackObjectFunctions('EventHandlers', Transaction.prototype.eventHandlers);\n    }\n\n    /*var prevErrorHandler = window.onerror;\n    window.onerror = function myErrorHandler(eMsg, url, lineNumber, column, eObject) {\n        if (eObject && eObject.stack && eObject.stack.indexOf('scarab-v2.js') > -1) {\n            console.error(eMsg + ' @' + url + ', in line ' + lineNumber + (typeof column !== 'undefined' ? ', in column: ' + column : '') + (eObject && eObject.stack ? ', stack: ' + eObject.stack : '') );\n        }\n\n    if (prevErrorHandler) {\n      return prevErrorHandler(errorMsg, url, lineNumber, column, errorObject);\n    }\n    return false;\n    }*/\n\n\n    var addFeature = function(featureObject) {\n        features.push(featureObject);\n        return featureObject;\n    };\n\n    var getTrnName = function(id) {\n        return 'tx' + (typeof id === 'undefined' ? transactionCounter : id);\n    };\n\n    /*\n     * Setters and Getters\n     */\n\n    var getPageViewId = function() {\n        return pageViewId;\n    };\n\n    var setPageViewId = function(pvId) {\n        pageViewId = pvId;\n        return pvId;\n    };\n\n    var generatePageViewId = function() {\n        return Math.floor(Math.random() * Math.pow(2, 31));\n    };\n\n    var setMerchantId = function(mid) {\n        merchantId = mid;\n    };\n\n    var getMerchantId = function() {\n        if (merchantId) {\n            return merchantId;\n        }\n        var apiTag = document.getElementById('scarab-js-api');\n        if (apiTag && apiTag.src) {\n            merchantId = apiTag.src.substring(apiTag.src.indexOf('/js/') +\n                    '/js/'.length);\n            if (merchantId.indexOf('/') !== -1) {\n                merchantId = merchantId.substr(0, merchantId.indexOf('/'));\n            }\n        }\n        return merchantId;\n    };\n\n    var setSessionId = function(sid) {\n        sessionId = sid;\n    };\n\n    var setVisitorId = function(vid) {\n        visitorId = vid;\n    };\n\n    var setCustomerId = function(cid) {\n        if (!cid) {\n            return;\n        }\n        customerId = cid;\n    };\n\n    var setProfile = function(prof) {\n        profile = prof;\n    };\n\n    var setEmail = function(email) {\n        var tr = getCurrentTransaction();\n        if (!isValid(tr, 'setEmail', email, 'email', 'string')) {\n            return;\n        }\n        setEmailHash(ScarabUtil.sha1(ScarabUtil.trim(email).toLowerCase()).substring(0,16) + '1');\n    };\n\n    var setEmailHash = function(eh) {\n        emailHash = eh;\n    };\n\n    var setFields = function(fs) {\n        fields = fs;\n    };\n\n    var setTestMode = function(tm) {\n        testMode = tm;\n    };\n\n    var getTestMode = function() {\n        return testMode;\n    };\n\n    var setServerUrl = function(url) {\n        serverUrl = url;\n    };\n\n    var getServerUrl = function() {\n        return serverUrl;\n    };\n\n    var setForcedCohort = function(cohortId) {\n        forcedCohort = cohortId;\n    };\n\n    var getCurrentTransaction = function() {\n        var trn = getTrnName();\n        if (trn in transactions) {\n            return transactions[trn];\n        }\n        return null;\n    };\n\n    var clearOldFeatureListeners = function(feat) {\n        for(var trkey in transactions) {\n            var tr= transactions[trkey];\n            for (var fkey in tr.features) {\n                var f = tr.features[fkey];\n                if (f !== feat && f.attachedListeners && f.containerId === feat.containerId){\n                    if (f.parent && f.parent.addEventListener && f.elistener) {\n                        f.parent.removeEventListener('click', f.elistener);\n                        f.elistener = null;\n                    } else if (f.parent && f.parent.attachEvent && f.elistener) {\n                        f.parent.detachEvent('click', f.elistener);\n                        f.elistener = null;\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * begin\n     */\n    var start = function() {\n        transactionCounter++;\n        transactions[getTrnName()] = new Transaction(transactionCounter);\n    };\n\n    /**\n     * commit\n     */\n    var go = function(delayed, forceSend) {\n        var trn = getTrnName(),\n            ctr = transactions[trn],\n            callbackName = 'cb_' + (config.jsonpStem || '') + trn;\n        Scarab[callbackName] = function(data) {\n            transactions[trn].callback(data);\n        };\n        ctr.callbackName = 'Scarab.' + callbackName;\n        ctr.go(!delayed, forceSend);\n        return ctr;\n    };\n\n    var myFeature = function(featureName, elementId) {\n        if (!document.getElementById(elementId)) {\n            throw new ReferenceError('Error in Scarab.myFeature() call: element \"' + elementId + '\" does not exist.');\n        }\n        var tr = getCurrentTransaction(), feature = addFeature(new Feature({\n            f : featureName,\n            containerId : elementId,\n            attachedListeners : true,\n            cust : 1\n        }));\n        feature.attachListeners();\n        feature.setProducts(feature.findProducts());\n        tr.registerFeature(feature);\n    };\n\n    var init = function() {\n        var qs = ScarabUtil.parseQueryString(w);\n        /*jshint camelcase: false */\n        trackedFeature = qs.sc_feature;\n        trackedCohort = qs.sc_cohort;\n        customerId = qs.sc_customer;\n        debugMode = qs.sc_debug;\n        trafficSource = qs.sc_src;\n        emailHash = qs.sc_eh;\n        emsUid = qs.sc_uid;\n        emsLlid = qs.sc_llid;\n        emsLid = qs.sc_lid;\n        /*jshint camelcase: true */\n\n        var vis = ScarabUtil.getCookie(STRINGS.VISITORCOOKIE);\n        if (vis && vis.length > 0) {\n            setVisitorId(vis);\n        }\n        var prof = ScarabUtil.getCookie(STRINGS.PROFILECOOKIE);\n        if (prof && prof.length > 0) {\n            setProfile(prof);\n        }\n    };\n\n    init();\n\n    start();\n\n    var isValid = function(transaction, command, value, valueName, shouldBe, canBe) {\n        var valueType = ScarabUtil.isArray(value) ? 'array' : (value === null ? 'null' : typeof value);\n        valueName = valueName || '';\n        if (typeof shouldBe === 'string') {\n            shouldBe = [shouldBe];\n        } else {\n            shouldBe = shouldBe || [];\n        }\n        if (typeof canBe === 'string') {\n            canBe = [canBe];\n        } else {\n            canBe = canBe || [];\n        }\n        if (ScarabUtil.indexOf(shouldBe, valueType) !== -1) {\n            if (valueType === 'string' && ScarabUtil.trim(value) === '') {\n                if (transaction) {\n                    transaction.error({t: 'INVALID_ARG', c: command, m: 'Invalid argument in ' + command + ': ' + valueName + ' should not be an empty string'});\n                }\n                return false;\n            }\n            if (valueType === 'number' && ScarabUtil.isNaN(value)) {\n                if (transaction) {\n                    transaction.error({t: 'INVALID_ARG', c: command, m: 'Invalid argument in ' + command + ': ' + valueName + ' should not be a NaN'});\n                }\n                return false;\n            }\n            return true;\n        }\n        if (ScarabUtil.indexOf(canBe, valueType) !== -1) {\n            if (transaction) {\n                transaction.error({t: 'INVALID_ARG', c: command, m: 'Invalid argument in ' + command + ': ' + valueName + ' should be a ' + shouldBe.join(' or ') + ', not a ' + valueType});\n            }\n            return true;\n        }\n        if (valueType === 'undefined') {\n            if (transaction) {\n                transaction.error({t: 'MISSING_ARG', c: command, m: 'Missing argument in ' + command + ': ' + valueName});\n            }\n        } else {\n            if (transaction) {\n                transaction.error({t: 'INVALID_ARG', c: command, m: 'Invalid argument in ' + command + ': ' + valueName + ' should be a ' + shouldBe.join(' or ')});\n            }\n        }\n        return false;\n    };\n\n    var publicInterface = {\n        defaultTemplate : '<![CDATA[ {{ if(SC.page.products.length) { }}<div class=\"scarab-itemlist\"><div class=\"scarab-prev\">◀</div>{{ for(var i=0;i<SC.page.products.length;i++) { }}<span data-scarabitem=\"{{= SC.page.products[i].id }}\" class=\"scarab-item\"><a href=\"{{= SC.page.products[i].link }}\"><img src=\"{{= SC.page.products[i].image }}\">{{= SC.page.products[i].title }}</a></span>{{ } }}<div class=\"scarab-next\">▶</div></div>{{ } }} ]]>',\n        testMode : function() {\n            setTestMode(true);\n        },\n        setMerchantId : setMerchantId,\n        // TODO: remove this from public API\n        setSessionId : setSessionId,\n        // TODO: remove this from public API\n        setVisitorId : setVisitorId,\n        setCustomerId : setCustomerId,\n        setEmail : setEmail,\n        email : setEmail,\n        setFields : setFields,\n        setCohortId : setForcedCohort,\n        availabilityZone : function(az) {\n            var tr = getCurrentTransaction();\n            tr.setAvailabilityZone(az);\n        },\n        language : function(lang) {\n            var tr = getCurrentTransaction();\n            tr.setLanguage(lang);\n        },\n        setOrderId : function(orderId) {\n            var tr = getCurrentTransaction();\n            tr.setOrderId(orderId);\n        },\n        addKeyword : function(keyword) {\n            var tr = getCurrentTransaction();\n            tr.addKeyword(keyword);\n        },\n        searchTerm : function(searchTerm) {\n            var tr = getCurrentTransaction();\n            tr.addSearchTerm(searchTerm);\n        },\n        category : function(category) {\n            var tr = getCurrentTransaction();\n            tr.addCategory(category);\n        },\n        tag : function(tagStr) {\n            var tr = getCurrentTransaction();\n            tr.addTag(tagStr);\n        },\n        pageview: function(pageViewId) {\n            var tr = getCurrentTransaction();\n            tr.pageview(pageViewId);\n        },\n        view : function(itemId, quantity, price, feature, cohort) {\n            var tr = getCurrentTransaction();\n            if (isValid(tr, 'view', itemId, 'itemId', ['string', 'number'])) {\n                tr.addView(new Item({\n                      i : itemId,\n                      p : price,\n                      q : quantity,\n                      t : feature,\n                      c : cohort\n                }));\n            }\n        },\n        /* deprecated */\n        addToCart : function(itemId, quantity, price) {\n            var tr = getCurrentTransaction();\n            tr.addAddedItem(new Item({\n                i : itemId,\n                p : price,\n                q : quantity\n            }));\n        },\n        /* deprecated */\n        cartItem : function(itemId, quantity, price) {\n            var tr = getCurrentTransaction();\n            tr.addCartItem(new Item({\n                i : itemId,\n                p : price,\n                q : quantity\n            }));\n        },\n        cart : function(cartItems) {\n            var tr = getCurrentTransaction();\n            if (!isValid(tr, 'cart', cartItems, 'cartItems', 'array')) {\n                return;\n            }\n            var c = [];\n            for (var i = 0, l = cartItems.length; i < l; i++) {\n                if (!isValid(tr, 'cart', cartItems[i].item, 'item', ['string', 'number'])) {\n                    return;\n                }\n                isValid(tr, 'cart', cartItems[i].price, 'price', 'number', 'string');\n                isValid(tr, 'cart', cartItems[i].quantity, 'quantity', 'number', 'string');\n                c.push(new Item({\n                    i: cartItems[i].item,\n                    p: cartItems[i].price,\n                    q: cartItems[i].quantity\n                }));\n            }\n            tr.setCart(c);\n        },\n        checkOut : function(itemId, quantity, price) {\n            var tr = getCurrentTransaction();\n            tr.addCheckoutItem(new Item({\n                i : itemId,\n                p : price,\n                q : quantity\n            }));\n        },\n        purchase: function(conf){\n            var tr = getCurrentTransaction();\n            if (!isValid(tr, 'purchase', conf, 'config', 'object') ||\n                !isValid(tr, 'purchase', conf.items, 'items', 'array')) {\n                return;\n            }\n            var config = {};\n            for (var key in conf){\n                if (key === 'orderId') {\n                    if (isValid(tr, 'purchase', conf.orderId, 'orderId', ['string', 'number'])){\n                        config.orderId = conf.orderId;\n                    }\n                } else if (key === 'items') {\n                    if (conf.items.length === 0) {\n                        tr.error({t: 'MISSING_ARG', c: 'purchase', m: 'Missing argument in purchase: items is an empty array'});\n                        return;\n                    }\n                    config.items = [];\n                    for (var i = 0, l = conf.items.length; i < l; i++) {\n                        if (!isValid(tr, 'purchase', conf.items[i].item, 'item', ['string', 'number']) ||\n                            !isValid(tr, 'purchase', conf.items[i].price, 'price', 'number', ['string', 'undefined', 'null']) ||\n                            !isValid(tr, 'purchase', conf.items[i].quantity, 'quantity', 'number', ['string', 'undefined','null'])) {\n                            return;\n                        }\n                        config.items.push(new Item({\n                            i: conf.items[i].item,\n                            p: conf.items[i].price,\n                            q: conf.items[i].quantity\n                        }));\n                    }\n                } else {\n                    if (window.console && console.warn) {\n                        console.warn('unknown property in purchase', key);\n                    }\n                }\n            }\n            tr.setPurchase(config);\n        },\n        include: function(field, rule, value) {\n            publicInterface.exclude(field, rule, value, true);\n        },\n        exclude : function(field, rule, value, negate) {\n            if (typeof value === 'undefined') {\n                value = rule;\n                rule = 'is';\n            }\n\n            var RULES = {\n              'is': 'IS',\n              'has': 'HAS',\n              'in': 'IN',\n              'overlaps': 'OVERLAPS',\n              'is not': 'IS',\n              'has not': 'HAS',\n              'not in': 'IN'\n            };\n\n            if (typeof RULES[rule] === 'undefined') {\n                throw new Error('unknown exclude rule: ' + rule);\n            }\n\n            if (rule.indexOf('not') !== -1) {\n                negate = true;\n            }\n\n            if (typeof value !== 'string') {\n                value = value.join('|');\n            }\n\n            var tr = getCurrentTransaction();\n            negate = negate || false;\n            tr.addExcludeRule({f:field, r: RULES[rule], v: value, n: negate});\n        },\n        updateTemplate : function(feature, newTemplate) {\n            var tr = getCurrentTransaction();\n            var f = tr.findFeature(feature);\n            if (f) {\n                f.template = doT.template(newTemplate);\n            }\n        },\n        recommend : function(conf, element, limit, template, baselineRecs, successCallback, trigger) {\n            var feature = conf;\n            if (typeof conf === 'object' && conf !== null) {\n                feature = conf.logic;\n                element = conf.containerId;\n                limit = conf.limit;\n                if (conf.templateStr) {\n                    template = conf.templateStr;\n                } else if (conf.templateId){\n                    var te = document.getElementById(conf.templateId);\n                    if (te === null) {\n                        throw new ReferenceError('Template element does not exist: ' + conf.templateId);\n                    }\n                    template = te.innerHTML;\n                } else {\n                    template = publicInterface.defaultTemplate;\n                }\n                baselineRecs = conf.baseline;\n                successCallback = conf.success;\n                trigger = conf.trigger;\n            }\n            var tr = getCurrentTransaction();\n            if (!isValid(tr, 'recommend', feature, 'logic', 'string')) {\n                return;\n            }\n            isValid(tr, 'recommend', element, 'containerId', 'string');\n            var f = tr.findFeature(feature);\n            if (!f) {\n                f = new Feature(\n                        {\n                            f : feature,\n                            o : conf.offset || 0,\n                            l : parseInt(limit, 10) || 5,\n                            t : trigger,\n                            containerId : element,\n                            template : doT.template(template || publicInterface.defaultTemplate),\n                            pages : []\n                        });\n                if (baselineRecs) {\n                    f.setProducts(baselineRecs);\n                }\n                addFeature(f);\n                f.successCallback = successCallback;\n            }\n            f.requestSent = false;\n            f.purgePagesCache();\n            tr.registerFeature(f);\n            return f;\n        },\n        // Deprecated - use recommend successCallback\n        invokeRendering : function(SC, renderCallback) {\n            renderCallback(SC);\n        },\n        // Deprecated - use recommend successCallback\n        beforeRenderingAsync: function(callback) {\n            publicInterface.invokeRendering = callback;\n        },\n        // Deprecated - use recommend successCallback\n        beforeRendering: function(callback) {\n            if (callback && typeof(callback) === 'function') {\n                beforeRendering = callback;\n            }\n        },\n        // Deprecated - use recommend successCallback\n        afterRendering: function(callback) {\n            if (callback && typeof(callback) === 'function') {\n                afterRendering = callback;\n            }\n        },\n        // Deprecated - use recommend successCallback\n        skipRendering: function() {\n            skipRendering = true;\n        },\n        itemClick : function(itemId, feature, cohort) {\n            addCookie(STRINGS.VIEWCOOKIE, new Item({\n                i : itemId,\n                t : feature,\n                c : cohort\n            }));\n        },\n        myFeature : myFeature,\n        go : function(forceSend) {\n            go(false, forceSend);\n        },\n        goAsync : function(forceSend) {\n            go(true, forceSend);\n        },\n        setServerUrl : function(serverUrl) {\n            setServerUrl(serverUrl);\n        },\n        addTransactionListener : function(callback) {\n            if (callback && typeof(callback) === 'function') {\n                transactionListeners.push(callback);\n                for (var i = 1; i < transactionCounter; i++) {\n                    try {\n                        callback(transactions[getTrnName(i)]);\n                    } catch (e) {\n                        getCurrentTransaction().error({t: 'INVALID_ARG', c: 'addTransactionListener', m: 'transaction listener threw an exception: ' + e});\n                    }\n                }\n            }\n        },\n        removeTransactionListener : function(callback) {\n            if (callback && typeof(callback) === 'function') {\n                var index = ScarabUtil.indexOf(transactionListeners, callback);\n                if (index > -1) {\n                    transactionListeners.splice(index, 1);\n                }\n            }\n        },\n        discovery : function(config) {\n            ScarabUtil.loader('discovery', function(discovery){\n                discovery.go(config);\n            });\n        },\n        blockDiscovery: function() {\n            // this is shady, but works without a transaction\n            publicInterface.__discoveryBlocked = true;\n            if (publicInterface.__discoveryModule) {\n                publicInterface.__discoveryModule.block();\n            }\n        },\n        assistant : function(config) {\n            config.merchantId = getMerchantId();\n            var mobileEnabled = !config.mobileDisabled\n                || ScarabUtil.hasCookie('sc_assistant');\n            if (config.forceMobile\n                || ScarabUtil.isMobile() && mobileEnabled) {\n                ScarabUtil.loader('mobildisco', function(mobildisco, conf) {\n                    mobildisco.go(conf || config);\n                }, config);\n            } else {\n                ScarabUtil.loader('assistant', function(assistant) {\n                    assistant.go(config);\n                    publicInterface.__discoveryModule = assistant;\n                }, config);\n            }\n        }\n    };\n    if (ScarabUtil.inspector && !config.doNotInspect){\n        ScarabUtil.inspector.trackObjectFunctions('ScarabModule',publicInterface);\n    }\n    return publicInterface;\n};\n\nvar _scq = _scq || [];\nvar ScarabQueue = ScarabQueue || [];\nvar Scarab = Scarab || null;\n\n(function() {\n\n    var initScarab = function() {\n        Scarab = Scarab || ScarabModule(window);\n        if (typeof window !== 'undefined') {\n            window.Scarab = Scarab;\n        }\n        _scq = ScarabUtil.playQueue(Scarab, _scq);\n        ScarabQueue = ScarabUtil.playQueue(Scarab, ScarabQueue);\n    };\n\n    try {\n        ScarabUtil.loadModules({\n            assistant: function(config) {\n                // setTimeout needed because merchant id is not set yet\n                setTimeout(function() {\n                  ScarabQueue.push(['assistant', config]);\n                }, 100);\n            },\n            mobildisco: function(config) {\n                config.forceMobile = true;\n                // setTimeout needed because merchant id is not set yet\n                setTimeout(function() {\n                  ScarabQueue.push(['assistant', config]);\n                }, 100);\n            },\n            inspector: function(config) {\n                ScarabUtil.loader('inspector', function() {\n                    initScarab();\n                }, config);\n            }\n        });\n        if (!ScarabUtil.hasCookie('sc_inspector')) {\n            initScarab();\n        }\n    } catch(e) {\n        if (window.console && console.error) {\n            console.error('error during scarab initialization: ', e);\n        }\n        initScarab();\n    }\n})();\n"],"sourceRoot":"/source/"}