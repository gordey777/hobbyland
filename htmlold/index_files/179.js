(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={init:function(config){var html=config.get("html"),htmlWrapper=document.createElement("div");htmlWrapper.innerHTML=html,document.body.appendChild(htmlWrapper);for(var scripts=htmlWrapper.getElementsByTagName("script"),n=0;n<scripts.length;n++)eval(scripts[n].innerHTML)}};

},{}],2:[function(require,module,exports){
function pluginUrl(e){switch(e.get("environment")){case"production":return"//static.personali.com";default:return"//static-int1.personali.io"}}function initProductPagePlugin(e){window.netotiateInitScript=function(){Netotiate.Plugin.init({affiliateId:e.get("affiliate_id"),authenticationKey:e.get("authentication_key"),debug:"integration"==e.get("environment")?"true":"false"})};var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=pluginUrl(e)+"/scripts/plugin/plugin.library.min.js.jgz";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}function initReadyStateHandler(hooks){var js=hooks;js&&""!=js&&(window.onNetotiateReadyState=function(){try{eval(js)}catch(e){}})}function initProductCheckoutPlugin(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=pluginUrl(e)+"/scripts/plugin/checkout.library.min.js.jgz";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}function initPixelCode(e){var t=e.get("confirmation_page_make_an_offer->items"),a=e.get("confirmation_page_make_an_offer->order_id");window.onNetotiatePluginCheckoutReadyState=function(){for(index in t)if(t.hasOwnProperty(index)){var r=t[index];r.personaliOfferId?Netotiate.Plugin.Api.Pixel.addNetotiate(r.personaliOfferId,r.sku,r.category,r.price,r.quantity,a):Netotiate.Plugin.Api.Pixel.addOrganic(r.sku,r.category,r.price,r.quantity,a)}Netotiate.Plugin.Api.Pixel.report(e.get("affiliate_id"),e.get("authentication_key"))}}function replaceQuoteWithGraveAccent(e){for(var t in e)e[t]=e[t].replace("'","`");return e}function injectMultiProductPageDraw(e){for(var t=e.get("multi_products_page_make_an_offer->products_array"),a=findAllElements(e.get("multi_products_page_make_an_offer->selector-type"),e.get("multi_products_page_make_an_offer->selector-path")),r=0;r<a.length;r++){var n=a[r];if(t.hasOwnProperty(r)){var i=t[r];if(i){var o={sku:i.sku,categoryId:i.categoryId,productPrice:i.productPrice,productTax:i.productTax,productImgUrl:i.productImgUrl,productTitle:i.productTitle,productDesc:i.productDesc,productAmp:i.productAmp,productBrand:i.productBrand,email:i.email,flex1:i.flex1,flex2:i.flex2,flex3:i.flex3,flex4:i.flex4,cartUrl:i.cartUrl,externalId:r+1};o=replaceQuoteWithGraveAccent(o);var c=document.createElement("span");c.setAttribute("onclick","Netotiate.Plugin.draw("+JSON.stringify(o)+");");var _=e.get("multi_products_page_make_an_offer->append_type");appendElement(_,c,n)}}}}function injectDraw(e){var t={sku:e.get("single_product_page_make_an_offer->sku"),categoryId:e.get("single_product_page_make_an_offer->category"),productPrice:e.get("single_product_page_make_an_offer->product_price"),productImgUrl:e.get("single_product_page_make_an_offer->product_image_url"),productTitle:e.get("single_product_page_make_an_offer->product_title"),productAmp:e.get("single_product_page_make_an_offer->product_amp"),productBrand:e.get("single_product_page_make_an_offer->product_brand"),email:e.get("single_product_page_make_an_offer->email"),flex1:e.get("single_product_page_make_an_offer->flex1"),flex2:e.get("single_product_page_make_an_offer->flex2"),flex3:e.get("single_product_page_make_an_offer->flex3"),flex4:e.get("single_product_page_make_an_offer->flex4"),cartUrl:e.get("single_product_page_make_an_offer->cart_url"),waitFor:e.get("single_product_page_make_an_offer->wait_for")instanceof Array?JSON.stringify(e.get("single_product_page_make_an_offer->wait_for")):"[]"};t=replaceQuoteWithGraveAccent(t);var a=document.createElement("span");a.setAttribute("onclick","Netotiate.Plugin.draw("+JSON.stringify(t)+");");var r=findElement(e.get("single_product_page_make_an_offer->selector-type"),e.get("single_product_page_make_an_offer->selector-path")),n=e.get("single_product_page_make_an_offer->append_type");appendElement(n,a,r)}var findAllElements=function(e,t){var a;switch(e){case"_class":a=document.querySelectorAll("."+t);break;case"_path":a=document.querySelectorAll(t)}return a},findElement=function(e,t){var a;switch(e){case"_id":a=document.querySelector("#"+t);break;case"_class":a=document.querySelector("."+t);break;case"_path":a=document.querySelector(t)}return a},appendElement=function(e,t,a){if(a)switch(e){case"insert_after":a.parentNode.insertBefore(t,a.nextSibling);break;case"insert_before":a.parentNode.insertBefore(t,a);break;case"append":a.appendChild(t)}};module.exports={init:function(e){switch(e.get("page_type")){case"single_product_page_make_an_offer":injectDraw(e),initReadyStateHandler(e.get("single_product_page_make_an_offer->event_hooks")),initProductPagePlugin(e);break;case"multi_products_page_make_an_offer":injectMultiProductPageDraw(e),initReadyStateHandler(e.get("multi_products_page_make_an_offer->event_hooks")),initProductPagePlugin(e);break;case"confirmation_page_make_an_offer":initPixelCode(e),initProductCheckoutPlugin(e)}}};

},{}],3:[function(require,module,exports){
(function (global){
function pluginUrl(e){return"//static.personali.com/scripts/sitemap/sitemap.js"}function initSiteMapPlugin(e){!function(t,a,n,l,i,r,c,m,o){t.psm=function(){(t.psm.q=t.psm.q||[]).push(arguments)},n=a.createElement("script"),n.type="text/javascript",n.async=!0,n.src=pluginUrl(e),l=a.getElementsByTagName("script")[0],l.parentNode.insertBefore(n,l)}(global,document,179),global.psm("init",{trackingId:e.get("tracking_id"),injectAnalytics:e.get("inject_analytics")})}function trackElement1(e){var t=findElement(e.get("element-1-selector-type"),e.get("element-1-selector-path"));t&&global.psm("trackElement",{element:t,name:e.get("element-1-name")})}function trackElement2(e){var t=findElement(e.get("element-2-selector-type"),e.get("element-2-selector-path"));t&&global.psm("trackElement",{element:t,name:e.get("element-2-name")})}function trackElement3(e){var t=findElement(e.get("element-3-selector-type"),e.get("element-3-selector-path"));t&&global.psm("trackElement",{element:t,name:e.get("element-3-name")})}function setVariable1(e){global.psm("setVariable",{name:e.get("variable-1-name"),value:e.get("variable-1-value")})}function setVariable2(e){global.psm("setVariable",{name:e.get("variable-2-name"),value:e.get("variable-2-value")})}function setVariable3(e){global.psm("setVariable",{name:e.get("variable-3-name"),value:e.get("variable-3-value")})}function reportPageView(e){e.get("report_page_view")&&global.psm("trackPage",{name:e.get("context")})}function executeCustomCode(config){var code=config.get("sitemap-custom-code");try{eval(code)}catch(e){}}var findElement=function(e,t){var a;switch(e){case"_id":a=document.querySelector("#"+t);break;case"_class":a=document.querySelector("."+t);break;case"_path":a=document.querySelector(t)}return a};module.exports={init:function(e){initSiteMapPlugin(e),setVariable1(e),setVariable2(e),setVariable3(e),reportPageView(e),trackElement1(e),trackElement2(e),trackElement3(e),executeCustomCode(e)}};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],4:[function(require,module,exports){
var variables=require("./lib/variables")([{type:"constant",name:"affiliate_id",_id:"56fcea97cb40a49c0b52236b",config:[{name:"value",value:"179"}]},{type:"data-layer",name:"product_id",_id:"56fd039ecb40a49c0b52236e",config:[{value:"productId",name:"var-name"}]},{type:"data-layer",name:"price",_id:"56fd0423cb40a49c0b52236f",config:[{value:"productPriceLocal",name:"var-name"}]},{type:"data-layer",name:"title",_id:"56fd0440cb40a49c0b522371",config:[{value:"productName",name:"var-name"}]},{type:"js-function",name:"cartUrl",_id:"570cc864cb40a49c0b52237e",config:[{value:"@product_id",name:"parameter"},{value:'function(parameter) {\r\nvar cartUrl = "http://www.atguat7.mvideo.ru/cart?personali_offer_id=TOKEN&productId="+ parameter +"&skuId=" + parameter +"&_DARGS=/sitebuilder/components/product/add-to-basket.jsp." + parameter;\r\nreturn cartUrl;\r\n}',name:"function"}]},{type:"dom-element",name:"is_coupon_id_exists",_id:"570e49d2cb40a49c0b522382",config:[{value:"_id",name:"selector-type"},{value:"promo-code",name:"selector-path"},{value:"id",name:"attribute"}]},{type:"global-js",name:"global_checkout_var",_id:"571c7130cb40a49c0b522389",config:[{value:"dataLayer",name:"var-name"}]},{type:"global-js",name:"order_id",_id:"571c76adcb40a49c0b52238d",config:[{value:"dataLayer[0]['transactions'][0].transactionId",name:"var-name"}]},{type:"data-layer",name:"category_id",_id:"56fd0432cb40a49c0b522370",config:[{name:"var-name",value:"productCategoryName"}]},{type:"dom-element",name:"prodcut_image",_id:"5721fa90cb40a49c0b522391",config:[{name:"selector-type",value:"_class"},{name:"selector-path",value:"product-image"},{name:"attribute",value:"src"}]},{type:"data-layer",name:"product_status",_id:"57224d5bcb40a49c0b522392",config:[{name:"var-name",value:"productAvailability"}]},{type:"data-layer",name:"brand",_id:"5723026acb40a49c0b522393",config:[{value:"productVendorName",name:"var-name"}]},{type:"js-function",name:"pixel_data",_id:"571c75fccb40a49c0b52238a",config:[{name:"parameter",value:"@global_checkout_var"},{name:"function",value:"function(parameter) {\r\n  function getPersonaliCookie(cname) {\r\n    var name = cname + \"=\";\r\n    var ca = document.cookie.split(';');\r\n    for(var i = 0; i <ca.length; i++) {\r\n        var c = ca[i];\r\n        while (c.charAt(0)==' ') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length,c.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n  \r\n  var basket = [];\r\n  //var products = parameter[0]['transactions'][0].transactionProducts;\r\n  var transactions = dataLayer[0].transactions;\r\n  for(index in transactions) {\r\n  	if(transactions.hasOwnProperty(index)) {\r\n  		  var transactionProducts = transactions[index].transactionProducts;\r\n		  for(index in transactionProducts) {\r\n		  	if(transactionProducts.hasOwnProperty(index)) {\r\n		       var item = transactionProducts[index];\r\n		      	var newItem = {};\r\n		      	var offerId = getPersonaliCookie('p_id');\r\n		      	if(offerId) {\r\n		        	document.cookie = 'p_id=;expires=Thu, 01 Jan 1970 00:00:01 GMT;Domain=.mvideo.ru;path=/';\r\n		        }\r\n		       	 newItem.personaliOfferId = (offerId ? offerId : null),\r\n		         //newItem.sku = item.sku,\r\n		         newItem.sku = item.id,\r\n		       	 newItem.category = item.category,\r\n		         newItem.price = (item.price * 100),\r\n		         newItem.quantity = item.quantity\r\n		         basket.push(newItem);\r\n		      }\r\n		  }\r\n  	}\r\n  }\r\n\r\n\r\n\r\n  \r\n  document.cookie = 'p_item=;expires=Thu, 01 Jan 1970 00:00:01 GMT;Domain=.mvideo.ru;path=/';\r\n  return basket;\r\n}"}]},{type:"js-function",name:"user_email",_id:"5726f43fcb40a49c0b522397",config:[{name:"parameter",value:""},{name:"function",value:"function(){\r\n	var item = dataLayer[0];\r\n  	return (item.userEmail ? item.userEmail : '');\r\n}"}]},{type:"constant",name:"auth_key",_id:"56fceaafcb40a49c0b52236c",config:[{name:"value",value:"24806715c602fb99347ed36f385cdac68638586f"}]}]),values=require("./lib/values")(variables),triggers=require("./lib/triggers")(values)([{type:"page-view",name:"All Pages",_id:"56fcea7fcb40a49c0b52236a",config:[{value:"url-match",name:"fires-on"},{value:"contains",name:"url-match->condition"},{value:"products",name:"url-match->expected"},{value:"default",name:"variable->condition"},{value:"",name:"variable->variable"},{value:"",name:"variable->expected"}]},{type:"page-view",name:"checkout_message",_id:"570cd614cb40a49c0b52237f",config:[{name:"fires-on",value:"url-match"},{name:"url-match->condition",value:"contains"},{name:"url-match->expected",value:"cart"},{name:"variable->condition",value:"default"},{name:"variable->variable",value:""},{name:"variable->expected",value:""}]},{type:"page-view",name:"Apply Coupon",_id:"570e4a50cb40a49c0b522384",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@is_coupon_id_exists"},{name:"variable->expected",value:"promo-code"}]},{type:"page-view",name:"Confirmation Page",_id:"571c764acb40a49c0b52238c",config:[{name:"fires-on",value:"url-match"},{name:"url-match->condition",value:"contains"},{name:"url-match->expected",value:"confirmation"},{name:"variable->condition",value:"default"},{name:"variable->variable",value:""},{name:"variable->expected",value:""}]},{type:"page-view",name:"Apply Coupon - AjaxComplete",_id:"571f25eacb40a49c0b522390",config:[{name:"fires-on",value:"url-match"},{name:"url-match->condition",value:"contains"},{name:"url-match->expected",value:"purchase"},{name:"variable->condition",value:"default"},{name:"variable->variable",value:""},{name:"variable->expected",value:""}]}]);triggers([{name:"Confirmation Page"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{value:"@affiliate_id",name:"affiliate_id"},{value:"@auth_key",name:"authentication_key"},{value:"production",name:"environment"},{value:"confirmation_page_make_an_offer",name:"page_type"},{value:"",name:"multi_products_page_make_an_offer->products_array"},{value:"",name:"multi_products_page_make_an_offer->event_hooks"},{value:"default",name:"multi_products_page_make_an_offer->selector-type"},{value:"",name:"multi_products_page_make_an_offer->selector-path"},{value:"default",name:"multi_products_page_make_an_offer->append_type"},{value:"",name:"single_product_page_make_an_offer->sku"},{value:"",name:"single_product_page_make_an_offer->category"},{value:"",name:"single_product_page_make_an_offer->product_brand"},{value:"",name:"single_product_page_make_an_offer->product_price"},{value:"",name:"single_product_page_make_an_offer->product_amp"},{value:"",name:"single_product_page_make_an_offer->email"},{value:"",name:"single_product_page_make_an_offer->flex1"},{value:"",name:"single_product_page_make_an_offer->flex2"},{value:"",name:"single_product_page_make_an_offer->flex3"},{value:"",name:"single_product_page_make_an_offer->flex4"},{value:"",name:"single_product_page_make_an_offer->product_image_url"},{value:"",name:"single_product_page_make_an_offer->product_title"},{value:"",name:"single_product_page_make_an_offer->cart_url"},{value:"",name:"single_product_page_make_an_offer->event_hooks"},{value:"default",name:"single_product_page_make_an_offer->selector-type"},{value:"",name:"single_product_page_make_an_offer->selector-path"},{value:"default",name:"single_product_page_make_an_offer->append_type"},{value:"@order_id",name:"confirmation_page_make_an_offer->order_id"},{value:"@pixel_data",name:"confirmation_page_make_an_offer->items"}]))}),triggers([{name:"All Pages"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"production"},{name:"page_type",value:"single_product_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"multi_products_page_make_an_offer->selector-type",value:"default"},{name:"multi_products_page_make_an_offer->selector-path",value:""},{name:"multi_products_page_make_an_offer->append_type",value:"default"},{name:"single_product_page_make_an_offer->sku",value:"@product_id"},{name:"single_product_page_make_an_offer->category",value:"@category_id"},{name:"single_product_page_make_an_offer->product_brand",value:"@brand"},{name:"single_product_page_make_an_offer->product_price",value:"@price"},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:"@user_email"},{name:"single_product_page_make_an_offer->flex1",value:""},{name:"single_product_page_make_an_offer->flex2",value:"@product_status"},{name:"single_product_page_make_an_offer->flex3",value:""},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->product_image_url",value:"@prodcut_image"},{name:"single_product_page_make_an_offer->product_title",value:"@title"},{name:"single_product_page_make_an_offer->cart_url",value:"@cartUrl"},{name:"single_product_page_make_an_offer->event_hooks",value:"Netotiate.Events.subscribe('netotiate.plugin.initiator.show', function(e,data){ \r\n	\r\n});\r\n\r\n\r\nNetotiate.Events.subscribe(\"netotiate.plugin.initiator.onclick\", function(e, data) { \r\n	dataLayer.push({\r\n		'event': 'OWOX',\r\n		'eventCategory': 'Interactions',\r\n		'eventAction': 'click',\r\n		'eventContext': 'personali',\r\n		'eventLabel': 'buyBetter'\r\n	});\r\n});\r\n\r\n\r\nNetotiate.Events.subscribe(\"netotiate.events.arena.offer_accepted\", function(e, data) { \r\n  var user_request_percent = (1 - (data.response.user_offer_price/data.product.original_price)) * 100;\r\n  user_request_percent  = user_request_percent.toFixed(2);\r\n	dataLayer.push({\r\n		'event': 'OWOX',\r\n		'eventCategory': 'Interactions',\r\n		'eventAction': 'click',\r\n		'eventContext': 'personali',\r\n		'eventLabel': 'accepted',\r\n      	'eventValue': user_request_percent\r\n	});\r\n});\r\n\r\n\r\nNetotiate.Events.subscribe(\"netotiate.events.arena.offer_countered\", function(e, data) { \r\n  var user_request_percent = (1 - (data.response.user_offer_price/data.product.original_price)) * 100;\r\n  user_request_percent  = user_request_percent.toFixed(2);\r\n	dataLayer.push({\r\n		'event': 'OWOX',\r\n		'eventCategory': 'Interactions',\r\n		'eventAction': 'click',\r\n		'eventContext': 'personali',\r\n		'eventLabel': 'notaccepted',\r\n      	'eventValue': user_request_percent\r\n	})\r\n});\r\n\r\n\r\nNetotiate.Events.subscribe(\"netotiate.events.arena.checkout_completed\", function(e,data) {\r\n	dataLayer.push({\r\n		'event': 'OWOX',\r\n		'eventCategory': 'Interactions',\r\n		'eventAction': 'click',\r\n		'eventContext': 'personali',\r\n		'eventLabel': 'goBasket'\r\n	});\r\n});\r\n"},{name:"single_product_page_make_an_offer->selector-type",value:"_path"},{name:"single_product_page_make_an_offer->selector-path",value:".product-details-summary-main form[action='/?_DARGS=/sitebuilder/components/product/wishlist/addToWishList.jsp']"},{name:"single_product_page_make_an_offer->append_type",value:"append"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""}]))}),triggers([{name:"checkout_message"}]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{value:"<script>\r\n  function getPersonaliCookie(cname) {\r\n    var name = cname + \"=\";\r\n    var ca = document.cookie.split(';');\r\n    for(var i = 0; i < ca.length; i++) {\r\n        var c = ca[i];\r\n        while (c.charAt(0) == ' ') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length, c.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n  \r\n  var products = dataLayer[0].cartProducts;\r\n  var sku = getPersonaliCookie('p_item_id');\r\n  for(index in products) {\r\n    if(products.hasOwnProperty(index)) {\r\n      var currentSku = products[index].productId\r\n      if(sku == currentSku) {      \r\n        var p_item = getPersonaliCookie('p_item');\r\n        if(p_item) {\r\n          $(\".content-top-primary-section\").prepend(\"<div class='alert alert-success'>Внимание! Итоговая цена товара с учетом скидки появится в момент выбора способа оплаты.</div>\");\r\n          $(\".alert-success\").css('font-weight','bold');\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>",name:"html"}]))}),triggers([{name:"Apply Coupon - AjaxComplete"}]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{value:"<script>\r\n  function getPersonaliCookie(cname) {\r\n    var name = cname + \"=\";\r\n    var ca = document.cookie.split(';');\r\n    for(var i = 0; i <ca.length; i++) {\r\n        var c = ca[i];\r\n        while (c.charAt(0)==' ') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length,c.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n  \r\n  function deletePersonaliCookie( name ) {\r\n  document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';\r\n}\r\n  $( document ).ajaxComplete(function(event, xhr, settings) {\r\n    var products = dataLayer[0].checkoutProducts;\r\n    var sku = getPersonaliCookie('p_item_id');\r\n    for(index in products) {\r\n    if(products.hasOwnProperty(index)) {\r\n      var currentSku = products[index].productId\r\n      if(sku == currentSku) {\r\n        var coupon = getPersonaliCookie('p_item');\r\n        var errorText = $(\".text-error\").text();\r\n        if($('#promocode').length > 0) {\r\n          var promoCode = $('#promo-code').val();\r\n          if($('#promocode').length > 0 && coupon && errorText == '') {\r\n            $('#promo-code').val(coupon);\r\n            $('a[data-form-action=\"promocode\"]').click();\r\n          }\r\n      }\r\n      \r\n      if($('#PROMOCODE').attr('checked') == 'checked' && coupon) {\r\n        $('label[for=\"PROMOCODE\"]').hide();\r\n        $('.nc-add-promocode').hide();\r\n        $('.nc-discount-label').css(\"color\",\"red\");\r\n        $('.nc-discount-label').append('<div class=\"nc-discount-label\" style=\"color: red;font-size:16px\"><strong>Cкидка применится после нажатия кнопки «Продолжить»</strong></div>');        \r\n        var isNewPriceApplied = false;\r\n        $( \".nc-items-in-basket tr td\" ).each(function() {\r\n			if($(this).text() == 'Скидка') {\r\n				isNewPriceApplied = true;\r\n			}\r\n		});\r\n			if(!isNewPriceApplied) {\r\n              	$(\".priceMessage\").remove();\r\n				$('.nc-items-in-basket').append('<tr class=\"priceMessage\"><td colspan=\"2\" style=\"color:red;font-weight:bold;font-size:14px\">Cкидка применится после нажатия кнопки «Продолжить»</td></tr>');\r\n			}\r\n        if($('#checkout-payment-card').attr('checked') == 'checked') {\r\n        	$('.nc-discount-label').first().hide();\r\n        }\r\n      }\r\n      \r\n     if(!$('#PROMOCODE').attr('checked') && coupon && errorText == '') {\r\n         $('label[for=\"PROMOCODE\"]').hide();\r\n         $('.nc-add-promocode').hide();\r\n         $('.nc-discount-label').hide();\r\n        $('#PROMOCODE').click();\r\n      } \r\n    }\r\n  }\r\n}\r\n  });\r\n  \r\n  var sku = getPersonaliCookie('p_item_id');\r\n  var products = dataLayer[0].checkoutProducts;\r\n\r\n  for(index in products) {\r\n    if(products.hasOwnProperty(index)) {\r\n      var currentSku = products[index].productId\r\n      if(sku == currentSku) {\r\n      var coupon = getPersonaliCookie('p_item');\r\n        var errorText = $(\".text-error\").text();\r\n       if($('#promocode').length > 0) {\r\n         	var promoCode = $('#promo-code').val();\r\n            if($('#promocode').length > 0 && coupon && errorText == '') {\r\n              $('#promo-code').val(coupon);\r\n              $('a[data-form-action=\"promocode\"]').click();\r\n            }\r\n          }\r\n      \r\n      if($('#PROMOCODE').attr('checked') == 'checked' && coupon) {\r\n          $('label[for=\"PROMOCODE\"]').hide();\r\n          $('.nc-add-promocode').hide();\r\n          $('.nc-discount-label').css(\"color\",\"red\");\r\n          $('.nc-discount-label').append('<div class=\"nc-discount-label\" style=\"color: red;font-size:16px\"><strong>Cкидка применится после нажатия кнопки «Продолжить»</strong></div>');\r\n        var isNewPriceApplied = false;\r\n        $( \".nc-items-in-basket tr td\" ).each(function() {\r\n			if($(this).text() == 'Скидка') {\r\n				isNewPriceApplied = true;\r\n			}\r\n		});\r\n			if(!isNewPriceApplied) {\r\n              	$(\".priceMessage\").remove();\r\n				$('.nc-items-in-basket').append('<tr class=\"priceMessage\"><td colspan=\"2\" style=\"color:red;font-weight:bold;font-size:14px\">Cкидка применится после нажатия кнопки «Продолжить»</td></tr>');\r\n			}\r\n          if($('#checkout-payment-card').attr('checked') == 'checked') {\r\n        	$('.nc-discount-label').first().hide();\r\n        	}\r\n        }\r\n          \r\n         if(!$('#PROMOCODE').attr('checked') && coupon && errorText == '') {\r\n           $('label[for=\"PROMOCODE\"]').hide();\r\n           $('.nc-add-promocode').hide();\r\n           $('.nc-discount-label').hide();\r\n          $('#PROMOCODE').click();\r\n        } \r\n      }\r\n    }\r\n  }\r\n</script>",name:"html"}]))}),triggers([{name:"All Pages"}]).bind(function(){require("@personali/canvas-sitemap").init(values([{name:"tracking_id",value:"UA-77115293-1"},{name:"context",value:"Product Page"},{name:"report_page_view",value:"1"},{name:"variable-1-name",value:"dimension1"},{name:"variable-1-value",value:"@product_id"},{name:"variable-2-name",value:"dimension2"},{name:"variable-2-value",value:"@category_id"},{name:"variable-3-name",value:""},{name:"variable-3-value",value:""},{name:"element-1-name",value:"Add To Cart"},{name:"element-1-selector-type",value:"_id"},{name:"element-1-selector-path",value:"js-form-submit-id"},{name:"element-2-name",value:"Mini Cart"},{name:"element-2-selector-type",value:"_id"},{name:"element-2-selector-path",value:"js-mini-basket"},{name:"element-3-name",value:"Social Tab"},{name:"element-3-selector-type",value:"_class"},{name:"element-3-selector-path",value:"footer-feedback"},{name:"sitemap-custom-code",value:""}]))});
},{"./lib/triggers":5,"./lib/values":7,"./lib/variables":8,"@personali/canvas-custom-sketch":1,"@personali/canvas-make-an-offer2":2,"@personali/canvas-sitemap":3}],5:[function(require,module,exports){
var PageViewQueue=require("./triggers/page-view");module.exports=function(e){return function(r){var n={};for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];n[i.name]=i}return function(r){var a=[];return a.bind=function(a){var i=new PageViewQueue(a);for(var u in r)if(r.hasOwnProperty(u)){var t=n[r[u].name];switch(t.type){case"page-view":i.push(e(t.config))}}i.execute()},a}}};

},{"./triggers/page-view":6}],6:[function(require,module,exports){
function assert(e,t,r){switch(t){case"regular-expression":return e.match(r);case"starts-with":return e.startsWith(r);case"ends-with":return e.endsWith(r);case"contains":return e.indexOf(r)>-1;case"equals":return e==r}}function test(e){switch(e.get("fires-on")){case"url-match":return assert(window.location.pathname,e.get("url-match->condition"),e.get("url-match->expected"));case"variable":return assert(e.get("variable->variable"),e.get("variable->condition"),e.get("variable->expected"));case"all-pages":return!0}return!1}var docReady=require("@personali/doc-ready");module.exports=function(e){var t=[];this.push=function(e){t.push(e)},this.execute=function(){docReady(function(){for(var r=null;r=t.pop();)if(test(r)){e();break}})}};

},{"@personali/doc-ready":9}],7:[function(require,module,exports){
module.exports=function(r){return function(e){var n={};for(var t in e)if(e.hasOwnProperty(t)){var u=e[t];n[u.name]=u}var a={};return a.get=function(e){var t=n[e];return t?"string"==typeof t.value&&"@"==t.value.charAt(0)?r.get(t.value.substr(1)):t.value:null},a}};

},{}],8:[function(require,module,exports){
function getCookie(e){for(var a=e+"=",r=document.cookie.split(";"),t=0;t<r.length;t++){for(var n=r[t];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(a))return n.substring(a.length,n.length)}return""}var getUrlParam=function(e){var a=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==a?null:a[1]||0},globalJsVar=function(values){try{return eval(values.get("var-name"))}catch(e){return null}},dataLayerVar=function(values){var dataLayer=document.getElementById("canvas-script").getAttribute("dl")||"dataLayer";if(!window[dataLayer])return null;for(var variableName=values.get("var-name"),variableVal=null,i=window[dataLayer].length;i-- >0;){var obj=window[dataLayer][i],dotParts="";try{variableName.indexOf(".")>=0?(dotParts=variableName.split(".",2),variableVal=eval("window[dataLayer][i][dotParts[0]]."+dotParts[1])):variableVal=window[dataLayer][i][variableName]}catch(e){}if(variableVal)return variableVal}return null},domElementVar=function(e){var a;switch(e.get("selector-type")){case"_id":a=document.querySelector("#"+e.get("selector-path"));break;case"_class":a=document.querySelector("."+e.get("selector-path"));break;case"_path":a=document.querySelector(e.get("selector-path"))}return a?e.get("attribute")?a.getAttribute(e.get("attribute")):a.innerText:null},cookieVar=function(e){return getCookie(e.get("cookie-name"))},urlParamVar=function(e){return getUrlParam(e.get("parameter"))},jsFunctionVar=function(values){try{var callback=eval("("+values.get("function")+")");return"function"==typeof callback?callback(values.get("parameter")):null}catch(e){return null}};module.exports=function(e){var a={};for(var r in e)if(e.hasOwnProperty(r)){var t=e[r];a[t.name]=t}var n={};return n.get=function(e){var r=require("./values")(n),t=a[e];switch(t.type){case"global-js":return globalJsVar(r(t.config));case"data-layer":return dataLayerVar(r(t.config));case"dom-element":return domElementVar(r(t.config));case"js-function":return jsFunctionVar(r(t.config));case"cookie":return cookieVar(r(t.config));case"url-parameter":return urlParamVar(r(t.config));case"constant":return r(t.config).get("value")}},n};

},{"./values":7}],9:[function(require,module,exports){
function docReady(e){var t=!1,d=!0,n=window.document,a=n.documentElement,o=n.addEventListener?"addEventListener":"attachEvent",c=n.addEventListener?"removeEventListener":"detachEvent",l=n.addEventListener?"":"on",r=function(d){"readystatechange"==d.type&&"complete"!=n.readyState||(("load"==d.type?window:n)[c](l+d.type,r,!1),!t&&(t=!0)&&e.call(window,d.type||d))},i=function(){try{a.doScroll("left")}catch(e){return void setTimeout(i,50)}r("poll")};if("complete"==n.readyState)e.call(window,"lazy");else{if(n.createEventObject&&a.doScroll){try{d=!window.frameElement}catch(y){}d&&i()}n[o](l+"DOMdocReady",r,!1),n[o](l+"readystatechange",r,!1),window[o](l+"load",r,!1)}}module.exports=docReady;

},{}]},{},[4]);
