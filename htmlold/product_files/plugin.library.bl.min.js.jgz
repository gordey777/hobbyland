var Netotiate=Netotiate||{};Netotiate.nq=Netotiate.$=function(){var a=this;return a=function(b){var c={};switch(typeof b){case"string":c.dom=document.querySelectorAll(b);break;case"object":c.dom=[b];break;default:c.dom={}}return c.nquery="1",c.eq=function(b){return this.length()>b?a(this.dom[b]):void 0},c.length=function(){return this.dom.length||0},c.find=function(a){if(this.length()>0){try{return c.dom=this.dom[0].querySelectorAll(a),c}catch(b){}return c}return c},c.hide=function(a){if(this.length())for(var b=0;b<this.dom.length;b++)this.dom[b].style.display="none","function"==typeof a&&a(this.dom[b])},c.show=function(a){if(this.length())for(var b=0;b<this.dom.length;b++)this.dom[b].style.display="","function"==typeof a&&a(this.dom[b])},c.fadeOut=function(a){var b=1,c=2,d=function(d){var e=d.style,f=isNaN(parseFloat(e.opacity))?1:parseFloat(e.opacity);f=100*f,e.display="block",function g(){f-=c,e.opacity=f/100,f>0?setTimeout(g,b):(e.display="none","function"==typeof a&&a())}()};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e])},c.fadeIn=function(a){var b=1,c=2,d=function(d,e){var f=d.style,g=0;f.opacity=0,f.display="block",function h(){g+=c,f.opacity=g/100,100*e>g?setTimeout(h,b):"function"==typeof a&&a()}()};if(this.length())for(var e=0;e<this.dom.length;e++){var f=""==this.dom[e].style.opacity||0==this.dom[e].style.opacity?1:this.dom[e].style.opacity;d(this.dom[e],f)}},c.slideDown=function(b,c){var d=function(d){var e=a(d).getCss("height"),f=e.replace("px",""),g=parseInt(a(d).getCss("height").replace("px","")),h=0,i=1,j=1;b&&(j=b/g),d.style.display="inline-block",d.style.height="0px";var k=function(){return h+=i,d.style.height=h+"px",g>h?setTimeout(function(){k()},j):(d.style.height=f+"px","function"==typeof c&&c(d),!1)};k()};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e])},c.slideUp=function(b,c){var d=function(d){var e=a(d).getCss("height"),f=e,g=parseInt(a(d).getCss("height").replace("px","")),h=1,i=1;b&&(i=b/g),d.style.height=e;var j=function(){return g-=h,d.style.height=g+"px",g>0?setTimeout(function(){j()},i):(d.style.display="none",d.style.height=f,"function"==typeof c&&c(),!1)};j()};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e])},c.animate_callback=function(){return!1},c.speedEvent=!1,c.speed=function(){return this.speedEvent=!0,c},c.animate=function(b,c,d){var e=function(a){return isNaN(parseFloat(a))?0:parseFloat(a)},f=this;if("function"==typeof d&&(this.animate_callback=d),a.animation_running)return!1;a.animation_running=!0,a.animation_queue_counter=a.count(b)*this.length();var g=10;f._animate=function(b,c,d,f){var h=this,i=e(a(b).getCss(c));if("string"==typeof d&&(d=1*d.replace("px","")),Math.round(i)==Math.round(d)||Math.floor(i)==Math.floor(d))return a.animate_dequeue(h),!1;this.speedEvent;var j=Math.abs(d-i);f>j&&(f=j);var k={},l=d>=i?1:-1;return i+=l*f,k[c]=i+"px",a(b).setCss(k),setTimeout(function(){h._animate(b,c,d,f)},g)},f.each(function(d,h){a.each(b,function(b,d){var i=50;if(c){var j=e(a(h).getCss(b)),k="string"==typeof d?1*d.replace("px",""):d;i=Math.abs(j-k)/(c/g)}f._animate(h,b,d,i)})})},c.scrollTo=function(a,b){if(!(0>b)){var d=10,e=c.dom[0],f=e.scrollTop,g=a-f,h=g/(b/d),i=function(a,b){if(!(e.scrollTop>=a)){var c=e.scrollTop;e.scrollTop+=b,e.scrollTop!=c&&setTimeout(function(){i(a,b)},d)}};i(a,h)}},c.html=function(a){if(!a)return el.innerHTML;for(var b=function(b){b.innerHTML=a},d=0;d<this.length();d++)b(this.dom[d]);return c},c.each=function(a){for(var b=0;b<this.length()&&"break"!=a(b,c.dom[b]);b++);},c.removeClass=function(b){var c=function(c){if(b){var d=c.className.split(" "),e=Array();class_name_array=b.split(",");for(var f=0;f<d.length;f++){for(var g=!1,h=0;h<class_name_array.length;h++)class_name_array[h]==d[f]&&(g=!0);g||e.push(d[f])}c.className=a.trim(e.join(" "))}else c.className=""};if(this.length())for(var d=0;d<this.dom.length;d++)c(this.dom[d])},c.addClass=function(b){var c=function(c){classNameArray=c.className.split(" "),class_name_array=b.split(",");for(var d=0;d<class_name_array.length;d++)classNameArray.push(class_name_array[d]);c.className=a.trim(classNameArray.join(" "))};if(this.length())for(var d=0;d<this.dom.length;d++)c(this.dom[d])},c.hasClass=function(a){var b=function(b){for(var c=b.className.split(" "),d=0;d<c.length;d++)if(c[d]==a)return!0;return!1};return this.length()?b(this.dom[0]):!1},c.getCss=function(b){return this.length()&&(el=this.dom[0]),void 0!=a.styles(el)[b]?a.styles(el)[b]:void 0!=el[b]?el[b]+"":""},c.setCss=function(a){var b=function(b){for(var c in a)try{b.style[c]=a[c]}catch(d){console.log(d)}};if(this.length())for(var d=0;d<this.dom.length;d++)b(this.dom[d]);return c},c.offset=function(){if(0!=this.length()){var a=c.dom[0],b=ot=0;if(a.offsetParent)do b+=a.offsetLeft,ot+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:ot}}},c.width=function(){return this.length()?(el=this.dom[0],el==document?Math.max(el.body.scrollWidth,el.documentElement.scrollWidth,el.body.offsetWidth,el.documentElement.offsetWidth,el.body.clientWidth,el.documentElement.clientWidth):el.offsetWidth):""},c.height=function(){return this.length()?(el=this.dom[0],el==document?Math.max(el.body.scrollHeight,el.documentElement.scrollHeight,el.body.offsetHeight,el.documentElement.offsetHeight,el.body.clientHeight,el.documentElement.clientHeight):el.offsetHeight):""},c.scrollTop=function(a){return this.length()?(a&&(this.dom[0].scrollTop=a),this.dom[0].scrollTop):""},c.scrollLeft=function(a){return this.length()?(a&&(this.dom[0].scrollLeft=a),this.dom[0].scrollLeft):""},c.getAttr=function(a){return this.length()?(el=this.dom[0],el.getAttribute(a)):""},c.setAttr=function(a,b){var d=function(c){c.setAttribute(a,b)};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e]);return c},c.is=function(a){var b=function(){return!1};switch(a){case":visible":b=function(a){"hidden"==a.style.visibility||"none"==a.style.display};break;default:return!1}return this.length()?(el=this.dom[0],b(el)):!1},c.getRaw=function(){return this.length()?this.dom[0]:{}},c.parent=function(){return this.length()?a(this.dom[0].parentNode):{}},c.append=function(b){return b.nquery&&(b=b.getRaw()),this.length()&&this.dom[0].appendChild(b),a(b)},c.appendTo=function(b){return b.nquery||(b=a(b)),b.append(this)},c.remove=function(){var a=function(a){document.body.removeChild(a)};this.each(function(b,c){a(c)}),c.dom=[]},c.replaceWith=function(a){a.nquery&&(a=a.getRaw()),this.length()&&this.dom[0].parentNode&&this.dom[0].parentNode.replaceChild(a,this.dom[0])},c.after=function(b){if(this.length()){var c=this.dom[0].nextElementSibling;return this.dom[0].parentNode.insertBefore(b,c),a(b)}},c.next=function(b){if(this.length()){var c=this.dom[0],d=a(c.nextElementSibling);if(b){var e=!1,f=a(b);return f.each(function(a,b){return b.previousElementSibling===c?(e=!0,"break"):void 0}),e?d:{}}return d}return{}},c.position=function(){return this.length()?(el=this.dom[0],{top:el.offsetTop,left:el.offsetLeft}):{top:null,left:null}},c.bind=function(b,d){var e=function(c){"object"!=typeof c._nq_events&&(c._nq_events={}),"object"!=typeof c._nq_events[b]&&(c._nq_events[b]=[]);var e=function(b){var c=[b];"object"==typeof b.detail&&(c=a.extend([b],b.detail)),d.apply(this,c)};c.addEventListener?c.addEventListener(b,e,!1):c.attachEvent("on"+b,e);var f=function(a,b){d(a,b)};c._nq_events[b].push({o:e,f:f})};if(this.length())for(var f=0;f<this.dom.length;f++)e(this.dom[f]);return c},c.trigger=function(a,b){var c=function(c){for(var d=0;d<c._nq_events[a].length;d++){var e=c._nq_events[a][d];e.f(c,b)}},d=function(d){if("object"!=typeof d._nq_events)return!1;if("object"!=typeof d._nq_events[a])return!1;var e,f=!1;if(b){if(window.CustomEvent&&"function"==typeof CustomEvent)e=new CustomEvent(a,{detail:b});else if(document.createEvent)e=document.createEvent("CustomEvent"),e.initCustomEvent(a,!0,!0,b);else if(document.createEventObject)try{var e=document.createEventObject();d.fireEvent("on"+a,e),f=!0}catch(g){c(d),f=!0}f||(d.dispatchEvent?d.dispatchEvent(e):window.dispatchEvent(e))}else if(document.createEvent)e=document.createEvent("HTMLEvents"),e.initEvent(a,!0,!1),d.dispatchEvent?d.dispatchEvent(e):window.dispatchEvent(e);else if(document.createEventObject)try{var h=document.createEventObject();d.fireEvent("on"+a,h),f=!0}catch(g){c(d)}};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e])},c.unbind=function(a){var b=function(b){if("object"!=typeof b._nq_events)return!1;if("object"!=typeof b._nq_events[a])return!1;for(var c=0;c<b._nq_events[a].length;c++){var d=b._nq_events[a][c].o;b.removeEventListener?b.removeEventListener(a,d):b.detachEvent&&b.detachEvent("on"+a,d)}b._nq_events[a]=[]};if(this.length())for(var d=0;d<this.dom.length;d++)b(this.dom[d]);return c},c.bind=function(b,d){var e=function(c){"object"!=typeof c._nq_events&&(c._nq_events=[]);var e="func_"+a.getKeys(c._nq_events).length,f=function(b){var c=[b];"object"==typeof b.detail&&(c=a.extend([b],b.detail)),d.apply(this,c)},g=function(e){var f=[e];f=a.extend([e],c[b+"_detail"]),d.apply(this,f)};c[b]=0,c._nq_events[e]=f,c.addEventListener?c.addEventListener(b,f,!1):(c.attachEvent("on"+b,f),c.attachEvent("onpropertychange",function(a){a.propertyName==b&&g(a)}))};if(this.length())for(var f=0;f<this.dom.length;f++)e(this.dom[f]);return c},c.trigger=function(a,b){var d=function(c){c[a+"_detail"]={};try{if(b){if(window.CustomEvent){if("function"==typeof CustomEvent){var d=new CustomEvent(a,{detail:b});c.dispatchEvent?c.dispatchEvent(d):window.dispatchEvent(d)}else if(document.createEvent){var d=document.createEvent("CustomEvent");d.initCustomEvent(a,!0,!0,b),c.dispatchEvent?c.dispatchEvent(d):window.dispatchEvent(d)}else if(document.createEventObject)try{var e=document.createEventObject();c.fireEvent("on"+a,e)}catch(f){c[a+"_detail"]=b,c[a]++}}else if(document.createEvent){var d=document.createEvent("CustomEvent");d.initCustomEvent(a,!0,!0,b),c.dispatchEvent?c.dispatchEvent(d):window.dispatchEvent(d)}else if(document.createEventObject)try{var e=document.createEventObject();c.fireEvent("on"+a,e)}catch(f){c[a+"_detail"]=b,c[a]++}}else if(document.createEvent){var d=document.createEvent("HTMLEvents");d.initEvent(a,!0,!1),c.dispatchEvent?c.dispatchEvent(d):window.dispatchEvent(d)}else if(document.createEventObject)try{var e=document.createEventObject();c.fireEvent("on"+a,e)}catch(f){c[a+"_detail"]=b,c[a]++}}catch(f){console.log(f)}};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e]);return c},c.unbind=function(a,b){var d=function(c){if("object"!=typeof c._nq_events)return!1;if(b)return c.removeEventListener?c.removeEventListener(a,b):c.detachEvent&&c.detachEvent("on"+a,b),!0;for(func_name in c._nq_events)c._nq_events.hasOwnProperty(func_name)&&(c.removeEventListener?c.removeEventListener(a,c._nq_events[func_name]):c.detachEvent&&c.detachEvent("on"+a,c._nq_events[func_name]))};if(this.length())for(var e=0;e<this.dom.length;e++)d(this.dom[e]);return c},c.loadData=function(b,d){return a.ajax({url:b,cache:!1,contentType:"text/plain",dataType:"html",success:function(a){c.html(a),"function"==typeof d&&d()}}),c},c.load=function(a){var b=function(b){b.addEventListener?b.addEventListener("load",a,!1):b.attachEvent("onload",a)};if(this.length())for(var d=0;d<this.dom.length;d++)b(this.dom[d]);return c},c.ready=function(b){a.readyAdd(b)},c},a.bindOnFinish=function(b,c){var d=function(a,b){var c;return function(){c&&clearTimeout(c),c=setTimeout(b,a)}},e=d(200,function(){a(window).trigger(b+"_end")});a(window).bind(b+"_end",c),a(window).bind(b,e)},a.unbindOnFinishEvent=function(a){Netotiate.nq(window).unbind(a)},a.create=function(b){return a(document.createElement(b))},a.count=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&++b;return b},a.each=function(a,b){if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&void 0!=c&&b(c,a[c])},a.inArray=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},a.grep=function(a,b){for(var c=new Array,d=0;d<a.length;d++){var e=a[d];b(e,d)&&c.push(e)}return c},a.extend=function(b,c,d){if(d&&("boolean"==typeof b||1==b||0==b?(b=c,c=d):(b=a.extend(b,c),c=d)),a.isArray(b)&&a.isArray(c)){for(var e=0;e<c.length;e++){for(var f=!1,g=0;g<b.length;g++)b[g]==c[e]&&(f=!0);f||b.push(c[e])}return b}var h={};for(var i in b)h[i]=b[i];for(var i in c)h[i]=c[i];return b=h},a.isArray=function(a){return a.push?!0:!1},a.styles=function(a){if(void 0==a.ownerDocument)return{};var b,c,d=a.ownerDocument.defaultView?a.ownerDocument.defaultView.getComputedStyle(a,null):a.currentStyle,e={};if(d&&d.length&&d[0]&&d[d[0]])for(c=d.length;c--;)b=d[c],"string"==typeof d[b]&&(e[b]=d[b]);else for(b in d)"string"==typeof d[b]&&(e[b]=d[b]);return e},a.support={cors:!0},a.fn={},a.ajax=function(b){var c=!1,d={type:"GET",url:"",data:"",timeout:0,async:!0,contentType:"application/json; charset=utf-8",success:function(){return!1},error:function(){return!1}};for(var e in b)e in b&&(d[e]=b[e]);var f=new XMLHttpRequest;f.open(d.type,d.url,!0),f.setRequestHeader("Content-Type",d.contentType),d.dataType=a.trim(d.dataType||"*");var g={xml:"application/xml,text/xml",html:"text/html",text:"text/plain",json:"application/json,text/javascript","*":"*/*",script:"text/javascript,application/javascript,application/ecmascript,application/x-ecmascript"};allTypes=["*/"]+["*"],f.setRequestHeader("Accept",d.dataType&&g[d.dataType]?g[d.dataType]+("*"!==d.dataType?", "+allTypes+"; q=0.01":""):g["*"]);var h=function(a){if(d.contentType.indexOf("json")>-1){try{var b=window.JSON.parse(a)}catch(c){b=""}return b}return d.contentType.indexOf("xml")>-1?a:a};return f.onreadystatechange=function(){4==f.readyState&&(200==f.status?c?d.error():d.success(h(f.responseText)):d.error())},d.timeout>0&&(b.timeout=1e3*b.timeout,setTimeout(function(){f.readyState<4&&(c=!0),b.success=function(){}},d.timeout)),f.send(d.data),!0},a.jsonp=function(a){var b=document.createElement("script");b.type="text/javascript",b.src=a,document.body.appendChild(b)},a.make_qs=function(b){var c=[];for(var d in b)void 0!=b[d]&&c.push(a.str_replace(" ","+",d+"="+encodeURIComponent(b[d])));return c.join("&")},a.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);return null==b?null:b[1]||0},a.str_replace=function(b,c,d){return d=d.replace(b,c),d.indexOf(b)>-1?a.str_replace(b,c,d):d},a.getKeys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},a.trimLeft=function(a){if("string"==typeof a)for(;a.length>0&&" "==a[0];)a=a.substring(1);return a},a.trimRight=function(a){if("string"==typeof a)for(;a.length>0&&" "==a[a.length-1];)a=a.substring(0,[a.length-1]);return a},a.trim=function(b){return b=a.trimLeft(b),b=a.trimRight(b)},a.windowScroll=function(a,b){if(!(0>b)){var c=10,d=0,e=a,f=e/(b/c),g=function(a,b){if(!(d>=a)){var e=d;d+=b,window.scrollTo(0,d),d!=e&&setTimeout(function(){g(a,b)},c)}};g(a,f)}},a.animation_queue_counter=0,a.animation_running=!1,a.animate_dequeue=function(b){a.animation_queue_counter--,0==a.animation_queue_counter&&(b.animate_callback(),a.animation_running=!1)},a.WindowOnload=function(a){if("complete"==document.readyState)return a.call(),!1;var b=function(b){b.addEventListener?b.addEventListener("load",a,!1):b.attachEvent("onload",a)};b(window)},a.readyList=[],a.isReady=!1,a._readyWait=1,a.readyAdd=function(b){a.isReady?b.call():(this.readyList.push(b),a.ready())},a.ready=function(){if("complete"===document.readyState)setTimeout(_ready);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),window.addEventListener("load",_ready,!1);else{document.attachEvent("onreadystatechange",DOMContentLoaded),window.attachEvent("onload",_ready);var b=!1;try{b=null==window.frameElement&&document.documentElement}catch(c){}b&&b.doScroll&&!function d(){if(!a.isReady){try{b.doScroll("left")}catch(c){return setTimeout(d,50)}_ready()}}()}},_ready=function(b){if(!a.isReady){if(b===!0?--a._readyWait:a.isReady)return;if(!document.body)return setTimeout(_ready);if(a.isReady=!0,b!==!0&&--a._readyWait>0)return;for(func in a.readyList)a.readyList.hasOwnProperty(func)&&a.readyList[func].call();a.readyList=[]}},DOMContentLoaded=function(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1),_ready()):"complete"===document.readyState&&(document.detachEvent("onreadystatechange",DOMContentLoaded),_ready())},a}();var Personali={};Personali.Initiators=function(){var a={},b={};return a.initiators={},a.ELIGIBLE="eliglble",a.INELIGIBLE="ineliglble",b.add=function(b,c){a.initiators[b]=c},b.setEligible=function(b){a.initiators[b].setEligibleState(a.ELIGIBLE)},b.setInEligible=function(b){a.initiators[b].setEligibleState(a.INELIGIBLE)},b.getEligibles=function(){var b=[];for(var c in a.initiators)a.initiators.hasOwnProperty(c)&&a.initiators[c].getEligibleState()==a.ELIGIBLE&&b.push(a.initiators[c]);return b},b.getInEligibles=function(){var b=[];for(var c in a.initiators)a.initiators.hasOwnProperty(c)&&a.initiators[c].getEligibleState()==a.INELIGIBLE&&b.push(a.initiators[c]);return b},b}();var Personali=Personali||{};Personali.UserFacts=function(){var a=this;a.data={};var b={},c=function(a){if(""!=a){for(var b="",c=a.split("_"),d=0;d<c.length;d++){var e=c[d];e=e[0].toUpperCase()+e.substring(1),b+=e}return b=b[0].toLowerCase()+b.substring(1)}return a};return b.insert=function(b,c,d){b in a.data||(a.data[b]={}),a.data[b][c]=d},b.get=function(b,c){return a.data[b][c]},b.initData=function(b,c){b in a.data||(a.data[b]={}),a.data[b]=c},b.getNormelized=function(){var b={};for(var d in a.data){var e=c(d);if(b[e]={},"object"==typeof a.data[d])for(var f in a.data[d]){var g=c(f);b[e][g]=a.data[d][f]}else b[e]=a.data[d]}return b},b.getRaw=function(){return a.data},b}(),Netotiate=Netotiate||{},Netotiate.Visitor={},Netotiate.Visitor._key="netotiate_vid",Netotiate.Visitor.lifetimeTTLDays=1825,Netotiate.Visitor.uniqueId=function(){var a="",b=function(a,b){return a=parseInt(a,10).toString(16),b<a.length?a.slice(a.length-b):b>a.length?Array(1+(b-a.length)).join("0")+a:a},c=Math.floor(123456789*Math.random())+1;return a+=b(parseInt((new Date).getTime()/1e3,10),8),a+=b(c,5)},Netotiate.Visitor.setretailer_visitorId=function(){var a=(Netotiate.Visitor._key+"=",Netotiate.Visitor.uniqueId()),b=new Date;b.setTime(b.getTime()+24*Netotiate.Visitor.lifetimeTTLDays*60*60*1e3);var c="expires="+b.toUTCString();return document.cookie=Netotiate.Visitor._key+"="+a+"; "+c+";path=/;domain=."+Netotiate.Visitor.getMasterDomain()+";",a},Netotiate.Visitor.getretailer_visitorId=function(){for(var a="",b=Netotiate.Visitor._key+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=Netotiate.$.trim(c[d]);0==e.indexOf(b)&&(a=e.substring(b.length,e.length))}return""==a?Netotiate.Visitor.setretailer_visitorId():a},Netotiate.Visitor.getMasterDomain=function(){for(var a=0,b=document.domain,c=b.split("."),d="_tst"+(new Date).getTime();a<c.length-1&&-1==document.cookie.indexOf(d+"="+d);)b=c.slice(-1-++a).join("."),document.cookie=d+"="+d+";domain="+b+";";return document.cookie=d+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+b+";",b};var NetotiateWindow=function(a){var b={};return b.construct=function(){return a.postMessage=a.postMessage||function(a,b,c){pm({target:a,type:b,data:c})},a.bind=a.bind||function(a,b){pm.bind(a,b)},a.createClient=function(b){var c={};c.server={};var d={};return d.events={},d.events.broadcast=function(b,d,e){a.postMessage(c.server,"netotiate_window_server.dispatch",{type:b,message:d}),a.postMessage(window,"netotiate_window.client.event.raised",{type:b,message:d}),a.bind(b+".result",function(a){"function"==typeof e&&e(a.message)})},d.events.subscribe=function(b,d){a.bind(b,function(e){var f=d(e.message);f&&a.postMessage(c.server,b+".window."+e.wid+".result",f)})},c.server=b||window.opener||window.parent,d},a},b.construct()}(NetotiateWindow||{}),NetotiateWindow=function(a){var b={};return b.construct=function(){return a.postMessage=a.postMessage||function(a,b,c){pm({target:a,type:b,data:c})},a.bind=a.bind||function(b,c){a.pm.bind(b,c)},a.createServer=function(){var b={},c={},d={};return b.windows=[],c.construct=function(){return b.windows[0]=window,c.bindDispatch(),d},c.dispatch=function(d,e){for(wid in b.windows)if(b.windows.hasOwnProperty(wid)){var f=b.windows[wid];a.postMessage(f,d,{message:e,wid:wid}),a.bind(d+".window."+wid+".result",function(a){c.dispatch(d+".result",a)})}},c.bindDispatch=function(){a.bind("netotiate_window_server.dispatch",function(a){c.dispatch(a.type,a.message)})},d.registerAllWindows=function(){for(var a=document.getElementsByClassName("netotiate-window-client"),c=b.windows.length,d=c;d<c+a.length;d++)b.windows[d]=a[d].contentWindow},d.registerWindow=function(a){var c=b.windows.length;if("string"==typeof a){var d=document.getElementById(a);b.windows[c]=d.contentWindow}else b.windows[c]=a},c.construct()},a},b.construct()}(NetotiateWindow||{}),Netotiate=Netotiate||{};Netotiate.Plugin=Netotiate.Plugin||{},Netotiate.Plugin.Validator={},Netotiate.Plugin.Validator.isAuthorizedRetailer=function(a){for(var b=0;b<Netotiate.Plugin.authorizedRetailers.length;b++)if(a==Netotiate.Plugin.authorizedRetailers[b].id)return!0;return!1},Netotiate.Plugin.Validator.isNumber=function(a){return!isNaN(a)},Netotiate.Plugin.Validator.isBoolean=function(a){return void 0!==a&&null!==a&&(0==a||1==a)},Netotiate.Plugin.Validator.isJsonObject=function(a){try{return"object"==typeof Netotiate.Plugin.JSON.parse(a)?!0:!1}catch(b){return!1}},Netotiate.Plugin.Validator.isAlphaNumeric=function(a){return null!=a&&a.match("^[a-zA-Z0-9]+$")},Netotiate.Plugin.Validator.isPositiveNumber=function(a){return Netotiate.Plugin.Validator.isNumber(a)&&a>0},Netotiate.Plugin.Validator.isMonetary=function(a){var b=""+a;return b=parseFloat(b.replace(/[^0-9\.]+/g,"")),Netotiate.Plugin.Validator.isNumber(b)&&b>0},Netotiate.Plugin.Validator.isUrl=function(a){return Netotiate.Plugin.Validator.NetotiateElement.isExist(a)&&(null!==a.match(/^((ht|f)tps?:)?\/\/[a-z0-9-\.]+\.[a-z]{2,4}\/?([^<>\#%"\{\}\\|\\\^\[\]`]+)?$/)||null!==decodeURIComponent(a).match(/^((ht|f)tps?:)?\/\/[a-z0-9-\.]+\.[a-z]{2,4}\/?([^\s<>\#%"\{\}\\|\\\^\[\]`]+)?$/))},Netotiate.Plugin.Validator.isValidNumber=function(a){return!isNaN(parseInt(a))},Netotiate.Plugin.Validator.isNonEmptyString=function(a){return"string"==typeof a&&a.length>0},Netotiate.Plugin.Validator.NetotiateElement={},Netotiate.Plugin.Validator.NetotiateElement.isExist=function(a){return void 0!==a&&null!=a&&""!=a},Netotiate.Plugin.Validator.NetotiateElement.isEmail=function(a){var b=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;return 0===a.length||b.test(a)?!0:!1},Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams=function(a){var b=Netotiate.$.extend(!0,{},a),c=!0;return null===b||void 0===b?(Netotiate.Plugin.Logger.error("wrong object given, could not read parameters. object given for validation is: ["+b+"]"),!1):(Netotiate.$.each(b,function(a,d){Netotiate.Plugin.Validator.NetotiateElement.isExist(b)||(c=!1,Netotiate.Plugin.Logger.warn(a+" is missing, input: "+d))}),Netotiate.Plugin.Validator.isNonEmptyString(b.sku)||(c=!1,Netotiate.Plugin.Logger.warn("sku is not a non-empty string, input: "+b.sku)),Netotiate.Plugin.Validator.isMonetary(b.productPrice)||(c=!1,Netotiate.Plugin.Logger.warn("productPrice is not a valid positive number, input: "+b.productPrice)),Netotiate.Plugin.Validator.isNonEmptyString(b.productTitle)||(c=!1,Netotiate.Plugin.Logger.warn("productTitle is not a non-empty string, input: "+b.productTitle)),c)},Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams=function(parameters){var paramsToValidate=Netotiate.$.extend(!0,{},parameters),isValid=!0,isExist=Netotiate.Plugin.Validator.NetotiateElement.isExist;if(null===paramsToValidate||void 0===paramsToValidate){try{var stringParams=Netotiate.Plugin.JSON.stringify(paramsToValidate)}catch(e){stringParams=paramsToValidate}return Netotiate.Plugin.Logger.warn("Could not read parameters. object given for validation is: ["+stringParams+"]"),!1}if(isExist(paramsToValidate.cartUrl)&&(Netotiate.Plugin.Validator.isUrl(paramsToValidate.cartUrl)||(isValid=!1,Netotiate.Plugin.Logger.warn("cartUrl is not a valid URL, input: "+paramsToValidate.cartUrl))),isExist(paramsToValidate.productBrand)&&(Netotiate.Plugin.Validator.isNonEmptyString(paramsToValidate.productBrand)||(isValid=!1,Netotiate.Plugin.Logger.warn("productBrand is not a non-empty string, input: "+paramsToValidate.productBrand))),isExist(paramsToValidate.cartParams)&&(Netotiate.Plugin.Validator.isJsonObject(paramsToValidate.cartParams)||(isValid=!1,Netotiate.Plugin.Logger.warn("cartParams is not a valid JSON object, input: "+paramsToValidate.cartParams))),isExist(paramsToValidate.productImgUrl)&&(Netotiate.Plugin.Validator.isUrl(paramsToValidate.productImgUrl)||(isValid=!1,Netotiate.Plugin.Logger.warn("productImgUrl is not a valid URL, input: "+paramsToValidate.productImgUrl))),isExist(paramsToValidate.productDesc)&&(Netotiate.Plugin.Validator.isNonEmptyString(paramsToValidate.productDesc)||(isValid=!1,Netotiate.Plugin.Logger.warn("productDesc is not a non-empty string, input: "+paramsToValidate.productDesc))),isExist(paramsToValidate.productShipping)&&(Netotiate.Plugin.Validator.isMonetary(paramsToValidate.productShipping)||Netotiate.Plugin.Validator.isNumber(paramsToValidate.productShipping)||(isValid=!1,Netotiate.Plugin.Logger.warn("productShipping is not a valid number, input: "+paramsToValidate.productShipping))),isExist(paramsToValidate.productAmp)&&(Netotiate.Plugin.Validator.isNonEmptyString(paramsToValidate.productAmp)||(isValid=!1,Netotiate.Plugin.Logger.warn("productAmp is not a non-empty string, input: "+paramsToValidate.productAmp))),isExist(paramsToValidate.productTax)&&(Netotiate.Plugin.Validator.isMonetary(paramsToValidate.productTax)||Netotiate.Plugin.Validator.isNumber(paramsToValidate.productTax)||(isValid=!1,Netotiate.Plugin.Logger.warn("productTax is not a valid number, input: "+paramsToValidate.productTax))),isExist(paramsToValidate.freeShipping)&&(Netotiate.Plugin.Validator.isBoolean(paramsToValidate.freeShipping)||(isValid=!1,Netotiate.Plugin.Logger.warn("freeShipping is not a valid boolean (0 or 1), input: "+paramsToValidate.freeShipping))),isExist(paramsToValidate.categoryId)&&(Netotiate.Plugin.Validator.isNonEmptyString(paramsToValidate.categoryId)||(isValid=!1,Netotiate.Plugin.Logger.warn("categoryId is not a valid non-empty string, input: "+paramsToValidate.categoryId))),isExist(paramsToValidate.quantity)&&(Netotiate.Plugin.Validator.isValidNumber(paramsToValidate.quantity)||(isValid=!1,Netotiate.Plugin.Logger.warn("quantity is not a valid number , input: "+paramsToValidate.quantity))),isExist(paramsToValidate.email)&&(Netotiate.Plugin.Validator.NetotiateElement.isEmail(paramsToValidate.email)||(isValid=!1,Netotiate.Plugin.Logger.warn("email is not a valid email, input: "+paramsToValidate.email))),isExist(paramsToValidate.waitFor)){var isArray=!1;try{isArray=eval(paramsToValidate.waitFor)instanceof Array,isArray&&Netotiate.Plugin.Validator.NetotiateElement.isExist(Netotiate.Plugin.displayConfig.tab)&&(Netotiate.Plugin.Logger.warn("waitFor is currently not supported for tab display, input: "+paramsToValidate.waitFor),isValid=!1)}catch(e){isArray=!1}isArray||(isValid=!1,Netotiate.Plugin.Logger.warn("waitFor is not a valid JS Array, input: "+paramsToValidate.waitFor))}return isValid};var Netotiate=Netotiate||{};Netotiate.Plugin=Netotiate.Plugin||{},Netotiate.Plugin.Mouse={},Netotiate.Plugin.Mouse.diffY=0,Netotiate.Plugin.Mouse.lastY=0,Netotiate.Plugin.Mouse.nextY=0,Netotiate.Plugin.Mouse.diffX=0,Netotiate.Plugin.Mouse.lastX=0,Netotiate.Plugin.Mouse.nextX=0,Netotiate.Plugin.hookOnMouseLeave=function(a){Netotiate.ArenaElementSet.length<1||(this.hook=function(){Netotiate.nq("body").bind("mousemove",function(b){if(Netotiate.Plugin.Impressions.isEligible){var c=b.clientY,d=b.clientX;if(Netotiate.Plugin.Mouse.diffY=Netotiate.Plugin.Mouse.diffY*(1/3)+(c-Netotiate.Plugin.Mouse.lastY)*(2/3),Netotiate.Plugin.Mouse.diffX=Netotiate.Plugin.Mouse.diffX*(1/3)+(d-Netotiate.Plugin.Mouse.lastX)*(2/3),Netotiate.Plugin.Mouse.nextX=d+Netotiate.Plugin.Mouse.diffX,Netotiate.Plugin.Mouse.nextY=c+Netotiate.Plugin.Mouse.diffY,Netotiate.Plugin.Mouse.lastX=d,Netotiate.Plugin.Mouse.lastY=c,Netotiate.Plugin.Mouse.nextY<0&&Netotiate.Plugin.Mouse.nextX>100){if(Netotiate.Plugin.Mouse.diffY=0,Netotiate.Plugin.Mouse.lastY=0,Netotiate.Plugin.Mouse.diffX=0,Netotiate.Plugin.Mouse.lastX=0,"prompt"==a||Netotiate.ArenaElementSet.length>1)return Netotiate.Plugin.showIncentive(),!1;if(1==Netotiate.ArenaElementSet.length){{(function(){Netotiate.Plugin.lastInitiator="onexit",Netotiate.Events.publish("netotiate.plugin.arena.show",{initiator:Netotiate.Plugin.lastInitiator}),"disabled"!=Netotiate.ArenaElementSet[0].getStatus()&&NetotiateWindow.client.events.broadcast("netotiate.plugin.trigger_on_exit.prompt",{affiliateId:Netotiate.Plugin.affiliateId,sg:Netotiate.Plugin.SampleGroup.name,sku:Netotiate.ArenaElementSet[0].params.sku,cid:Netotiate.ArenaElementSet[0].params.categoryId,price:Netotiate.ArenaElementSet[0].params.productPrice})})()}return!1}Netotiate.Plugin.unHookOnMouseLeave()}}})},this.hook())},Netotiate.Plugin.unHookOnMouseLeave=function(){this.unHook=function(){Netotiate.nq("body").unbind("mousemove")},this.unHook()};var Netotiate=Netotiate||{};Netotiate.Plugin=Netotiate.Plugin||{},Netotiate.Plugin.Logger={},Netotiate.Plugin.Logger.log=function(a,b){"undefined"!=typeof console&&""!==a&&Netotiate.Plugin.debug&&((void 0===b||null===b||""===b)&&(b="DEBUG"),console.log("["+b.toUpperCase()+"] : "+a))},Netotiate.Plugin.Logger.warn=function(a){Netotiate.Plugin.Logger.log(a,"WARN")},Netotiate.Plugin.Logger.debug=function(a){Netotiate.Plugin.Logger.log(a,"DEBUG")},Netotiate.Plugin.Logger.error=function(a){Netotiate.Plugin.Logger.log(a,"ERROR")};var Netotiate=Netotiate||{};Netotiate.Plugin=Netotiate.Plugin||{},Netotiate.Plugin.Hub={},Netotiate.Plugin.callBacks={},Netotiate.Plugin.displayConfig={},Netotiate.Plugin.ABtests={},Netotiate.Plugin.lastInitiator="na",Netotiate.Plugin.SampleGroup={},Netotiate.Plugin.SampleGroup.name="",Netotiate.Plugin.SampleGroup.ttl="",Netotiate.Plugin.frequencyBtnDisabled=!1,Netotiate.Plugin.SampleGroup.contains=function(a){return Netotiate.Plugin.SampleGroup.name.indexOf(a)>-1},Netotiate.Plugin.SampleGroup.load=function(a){if(0!=a.length){var b=a[0],c=b.additionalData;"show"==b.actionType&&Netotiate.Plugin.Validator.NetotiateElement.isExist(c.group)&&(Netotiate.Plugin.SampleGroup.name=c.group,Netotiate.Plugin.Validator.NetotiateElement.isExist(c.days)&&(Netotiate.Plugin.SampleGroup.ttl=c.days))}},Netotiate.Plugin.SampleGroup.report=function(){""!=Netotiate.Plugin.SampleGroup.name&&(json_data={ttl:parseInt(Netotiate.Plugin.SampleGroup.ttl),gn:Netotiate.Plugin.SampleGroup.name,affiliateId:Netotiate.Plugin.affiliateId},NetotiateWindow.client.events.broadcast("netotiate.plugin.store_sg",json_data))},Netotiate.Plugin.hookOnClose=function(){this.hook=function(){Netotiate.nq(window).bind("beforeunload",function(){NetotiateWindow.client.events.broadcast("netotiate.plugin.page_exit",{
affiliateId:Netotiate.Plugin.affiliateId})})},this.hook()},Netotiate.Plugin.bindReportTag=function(a,b){pm.bind(a,function(a){return Netotiate.Plugin.triggerReportTag(b,a)})},Netotiate.Plugin.triggerReportTag=function(a,b){var c={event_name:"",general:{sample_group:""}};c.event_name=a,c.general.sample_group=Netotiate.Plugin.SampleGroup.name;try{var d=null;void 0!=b.confirm_id&&(d=function(){pm({target:Netotiate.Plugin.Arena,type:b.confirm_id,data:{}})},delete b.confirm_id),b=Netotiate.nq.extend(c,b),Netotiate.Events.trigger(a,b,null,d)}catch(e){return!1}},Netotiate.Plugin.dialogWidth=628,Netotiate.Plugin.dialogHeight=440,Netotiate.Plugin.autoScrollOff=function(){Netotiate.nq.unbindOnFinishEvent("resize"),Netotiate.nq.unbindOnFinishEvent("scroll")},Netotiate.Plugin.autoScrollOn=function(){var a=function(){var a=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,b=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;Netotiate.nq("#netotiate_iframe").speed().animate({top:b+(window.innerHeight||document.documentElement.clientHeight)/2-Netotiate.Plugin.dialogHeight/2+"px",left:a+(window.innerWidth||document.documentElement.clientWidth)/2-Netotiate.Plugin.dialogWidth/2+"px"},300)};Netotiate.nq.bindOnFinish("resize",a),Netotiate.nq.bindOnFinish("scroll",a)},Netotiate.Plugin.autoScrollOff=function(){Netotiate.nq.unbindOnFinishEvent("resize"),Netotiate.nq.unbindOnFinishEvent("scroll")},Netotiate.Plugin.scrollToFirstButtonAndClose=function(){function a(){Netotiate.nq.windowScroll(Netotiate.nq(".netotiate-button-iframe").offset().top-200,1e3)}Netotiate.Plugin.hide(a)},Netotiate.API={},Netotiate.API.GenericResponse=function(a){return a&&a.header&&"undefined"!=a.header&&a.header.code&&"undefined"!=a.header.code&&"success"==a.header.code?a:null},Netotiate.Plugin.options=Netotiate.Plugin.options||{},Netotiate.Plugin.ver="7.3.0-9",Netotiate.Plugin.cacheIdentifier="7.3.0-9",Netotiate.Plugin.Env={},Netotiate.Plugin.Env.apiBaseUrl="//connect.personali.com",Netotiate.Plugin.Env.pluginBaseUrl="//plugin.personali.com",Netotiate.Plugin.Env.pluginSecureUrl="https://plugin.personali.com",Netotiate.Plugin.Env.reportBaseUrl="//report.personali.com",Netotiate.Plugin.Env.staticCdnBaseUrl="//static.personali.com",Netotiate.Plugin.authKey=null,Netotiate.Plugin.merchantLogoUrl="",Netotiate.Plugin.merchantPhone="",Netotiate.Plugin.getCurrentUrl=function(){return window.location.href},Netotiate.Plugin.isRetarget=function(){return Netotiate.Plugin.getCurrentUrl().indexOf("_ntr=1")>-1?1:0},Netotiate.Plugin.Actions={},Netotiate.Plugin.Actions.getFacts=function(){var a=[],b=Netotiate.Plugin.isRetarget();return Netotiate.nq.each(Netotiate.ArenaElementSet,function(c,d){var e={};e.ownerId=d.getUniqueId(),Netotiate.ArenaElementSet[c].params.ownerId=e.ownerId,e.retarget=b,e.affiliateId=Netotiate.Plugin.affiliateId,e.platform=Netotiate.Plugin.device+"Web",e.dailyTriggerExit=Netotiate.Plugin.options.dailyTriggerExit,e.facts={},d.params.timestamp&&(e.timestamp=d.params.timestamp),d.params.checksum&&(e.checksum=d.params.checksum),d.params.productPrice&&(e.facts.productPrice=d.params.productPrice),d.params.productBrand&&(e.facts.brand=d.params.productBrand),d.params.sku&&(e.facts.sku=d.params.sku),d.params.categoryId&&(e.facts.category=d.params.categoryId),Netotiate.Plugin.SampleGroup.name&&(e.facts.group=Netotiate.Plugin.SampleGroup.name),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.params.productAmp)&&(e.facts.productAmp=d.params.productAmp),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.params.flex1)&&(e.facts.flex1=d.params.flex1),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.params.flex2)&&(e.facts.flex2=d.params.flex2),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.params.flex3)&&(e.facts.flex3=d.params.flex3),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.params.flex4)&&(e.facts.flex4=d.params.flex4),a.push(e)}),a},Netotiate.Plugin.Actions.tasks=new Array,Netotiate.Plugin.Actions.isEligibleTask=function(a){return"show"===a.actionType&&"true"===a.additionalData.eligible?!0:!1},Netotiate.Plugin.Actions.doTask=function(a,b,c){var d=a.additionalData,e=a.rules,f=a.actionType,g=!1;delay="number"==typeof c?c:d.delayTime;var h=function(){return Netotiate.Plugin.Validator.NetotiateElement.isExist(Netotiate.Plugin.displayConfig.button)?void b.show():void(Netotiate.Plugin.Validator.NetotiateElement.isExist(Netotiate.Plugin.displayConfig.tab)&&("open"===Netotiate.Plugin.displayConfig.tab.defaultState?setTimeout(Netotiate.SideWidget.action.open,1e3):Netotiate.SideWidget.action.show()))};"show"==f&&(Netotiate.Plugin.Validator.NetotiateElement.isExist(d.high)&&(b.params.barHigh=d.high),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.max)&&(b.params.barMin=d.max),Netotiate.Plugin.Validator.NetotiateElement.isExist(d.show)&&(null!=d.eligible&&"true"==d.eligible&&(Netotiate.Plugin.Impressions.isEligible=!0),"true"==d.show&&(Netotiate.Plugin.Impressions.isVisible=!0,g=!0,Netotiate.Plugin.Validator.NetotiateElement.isExist(d.delayTime)?setTimeout(h,1e3*delay):h(delay)))),Netotiate.Plugin.Logger.log(g&&e?"Decision for displaying the element with SKU "+b.params.sku+" was based on the following display rules: "+e.join(", "):"Netotiating was disabled for element with SKU : "+b.params.sku)},Netotiate.Plugin.affiliateId=null,Netotiate.Plugin.affiliateName="",Netotiate.Plugin.iframeReady=!1,Netotiate.Plugin.debug=!1,Netotiate.Plugin.initializing=!1,Netotiate.Plugin.isAuthenticated=null,Netotiate.Plugin.Arena=null,Netotiate.Plugin.distribution="",Netotiate.Plugin.groupIdentifier="",Netotiate.Plugin.controlGroup="",Netotiate.Plugin.ruleRevisionId="",Netotiate.Plugin.Visitor={},Netotiate.Plugin.Visitor.store=function(){var a={vid:Netotiate.Visitor.getretailer_visitorId()};NetotiateWindow.client.events.broadcast("netotiate.plugin.visitor_id.store",a)},Netotiate.Plugin.Impressions={},Netotiate.Plugin.Impressions.collectPageImpressions=function(){var a=!1,b={};Netotiate.nq.each(Netotiate.ArenaElementSet,function(d,e){flexes={};for(var f=void 0==e.params.productBrand?"":e.params.productBrand,g=1;4>=g;g++)void 0!=e.params["flex"+g]&&(flexes["flex"+g]=e.params["flex"+g]);c={manufacturer_name:f,flexes:flexes,initiator:Netotiate.Plugin.lastInitiator,category:Netotiate.Plugin.options.categoryId,price:100*e.params.productPrice,original_price:100*e.params.productPrice},b[e.params.sku]=c,a=!0});var c={affiliateId:Netotiate.Plugin.affiliateId,product_data:b,distribution:Netotiate.Plugin.distribution,group_identifier:Netotiate.Plugin.groupIdentifier,is_control_group:Netotiate.Plugin.controlGroup,rule_revision_id:Netotiate.Plugin.ruleRevisionId,device_type:Netotiate.Plugin.device+"Web"};NetotiateWindow.client.events.broadcast("netotiate.plugin.impressions.store",c),a&&NetotiateWindow.client.events.broadcast("netotiate.plugin.impressions.collect",{impressions:Netotiate.ArenaElementSet.length,affiliateId:Netotiate.Plugin.affiliateId})},Netotiate.Plugin.Impressions.isVisible=!1,Netotiate.Plugin.Impressions.isEligible=!1,Netotiate.Plugin.Impressions.isReported=!1,Netotiate.Plugin.Storage={},Netotiate.Plugin.Storage.update=function(a,b,c,d){pm({target:Netotiate.Plugin.Arena,type:"storage_update",data:{db:a,key:b,data:d,ttl:c}})},Netotiate.Plugin.Impressions.report=function(){var a="";if(Netotiate.nq.each(Netotiate.ArenaElementSet,function(b,c){0==b&&(a=void 0==c.params.productBrand?"":c.params.productBrand)}),!Netotiate.Plugin.Impressions.isReported){var b=Netotiate.Plugin.Impressions.isEligible?Personali.Initiators.getEligibles()[0].params.sku:Personali.Initiators.getInEligibles()[0].params.sku;NetotiateWindow.client.events.broadcast("netotiate.plugin.impressions.view",{affiliateId:Netotiate.Plugin.affiliateId,cid:Netotiate.Plugin.options.categoryId,sku:b,manufacturer_name:a,eligibility:Netotiate.Plugin.Impressions.isEligible?"True":"False",impression:Netotiate.Plugin.Impressions.isVisible?"True":"False",distribution:Netotiate.Plugin.distribution,group_identifier:Netotiate.Plugin.groupIdentifier,rule_revision_id:Netotiate.Plugin.ruleRevisionId,price:Netotiate.Plugin.Impressions.isEligible?100*Personali.Initiators.getEligibles()[0].params.productPrice:100*Personali.Initiators.getInEligibles()[0].params.productPrice,sample_group:Netotiate.Plugin.SampleGroup.name,originalPrice:Netotiate.Plugin.Impressions.isEligible?100*Personali.Initiators.getEligibles()[0].params.productPrice:100*Personali.Initiators.getInEligibles()[0].params.productPrice}),Netotiate.Plugin.Impressions.isReported=!0}},Netotiate.Plugin.onArenaReadyState=function(){NetotiateWindow.server.registerWindow("netotiate_iframe")},Netotiate.Plugin.Hub.onReadyState=function(){NetotiateWindow.server.registerWindow("netotiate-hub"),Netotiate.Plugin.Visitor.store(),Netotiate.Plugin.hookOnClose();var a=function(){try{var a=null;if("mvt"in Netotiate.Plugin.Actions.tasks[0]&&AB.initAll(Netotiate.Plugin.Actions.tasks[0].mvt),AB.action("connect_end"),Netotiate.nq.each(Netotiate.Plugin.Actions.tasks,function(b,c){a=Netotiate.ArenaElement.findBId(c.ownerId),a&&!Netotiate.Plugin.Actions.isEligibleTask(c)?(Personali.Initiators.setInEligible(c.ownerId),Netotiate.ArenaElementSet=Netotiate.ArenaElement.deleteById(c.ownerId)):(Personali.Initiators.setEligible(c.ownerId),Netotiate.ArenaElement.modifyById(c.ownerId,c))}),!Netotiate.Plugin.validateNetotiableElementsSetup())return void Netotiate.Plugin.Logger.error("Netotiate plugin fail to execute to invalid parameters.");if("segmentId"in Netotiate.Plugin.Actions.tasks[0].additionalData&&Personali.UserFacts.initData("segment_Id",Netotiate.Plugin.Actions.tasks[0].additionalData.segmentId),Netotiate.Plugin.options.categoryId=a?a.params.categoryId:"",Netotiate.Plugin.options.context=window.location.href,Netotiate.Plugin.options.lc=Netotiate.Plugin.locale,Netotiate.Plugin.options.merchantName=Netotiate.Plugin.affiliateName,Netotiate.Plugin.options.merchantLogoUrl=Netotiate.Plugin.merchantLogoUrl,Netotiate.Plugin.options.merchantPhone=Netotiate.Plugin.merchantPhone,Netotiate.Plugin.options.merchantId=Netotiate.Plugin.merchantId,Netotiate.Plugin.displayConfig&&(Netotiate.Plugin.options.displayConfig=Netotiate.Plugin.displayConfig),Netotiate.Plugin.SampleGroup.load(Netotiate.Plugin.Actions.tasks),Netotiate.Plugin.options.sampleGroup=Netotiate.Plugin.SampleGroup.name,Netotiate.nq.each(Netotiate.ArenaElementSet,function(a,b){var c=Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams(b.params),d=Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams(b.params);c&&d&&Netotiate.Plugin.displayConfig.button&&b.create()}),Netotiate.Plugin.displayConfig.tab)Netotiate.Plugin.loadWidget();else{if(Netotiate.Plugin.drawElements(),Netotiate.Plugin.bindExternalEvents(),Netotiate.Plugin.loadCustomCode(Netotiate.Plugin.options.affiliateId),null!=window.onNetotiateReadyState&&"function"==typeof window.onNetotiateReadyState&&window.onNetotiateReadyState(),Netotiate.Plugin.triggerReportTag("netotiate.plugin.impression",{}),Netotiate.Plugin.Actions.tasks[0]&&"true"==Netotiate.Plugin.Actions.tasks[0].additionalData.triggerOnExit){var b=Netotiate.Plugin.SampleGroup.name.indexOf("arena_help")>-1?"prompt":"arena";Netotiate.Plugin.hookOnMouseLeave(b)}Netotiate.Plugin.Actions.tasks[0]&&Netotiate.Plugin.Actions.tasks[0].additionalData.autoTrigger&&setTimeout(function(){"na"==Netotiate.Plugin.lastInitiator&&(Netotiate.Plugin.lastInitiator="auto_trigger",NetotiateWindow.client.events.broadcast("netotiate.plugin.auto_trigger.prompt",{affiliateId:Netotiate.Plugin.affiliateId,sg:Netotiate.Plugin.SampleGroup.name,sku:Netotiate.ArenaElementSet[0].params.sku,cid:Netotiate.ArenaElementSet[0].params.categoryId}),Netotiate.Events.publish("netotiate.plugin.arena.show",{initiator:Netotiate.Plugin.lastInitiator}))},1e3*Netotiate.Plugin.Actions.tasks[0].additionalData.autoTrigger);var c=Netotiate.Plugin.displayConfig.arena?"true"===Netotiate.Plugin.displayConfig.arena.lazyLoad:!1;c||Netotiate.nq.WindowOnload(Netotiate.Plugin.initializeIframe)}}catch(d){return Netotiate.Plugin.Logger.error("Netotiate plugin initializing failed, could not parse parameters due to exception: "+d.message),!1}Netotiate.Plugin.Impressions.collectPageImpressions(),Netotiate.Plugin.Impressions.report(),Netotiate.Plugin.SampleGroup.report()};NetotiateWindow.client.events.subscribe("netotiate.hub.data.collected",function(b){Netotiate.Plugin.options.dailyTriggerExit=b.personalCounters.daily_trigger_exit,Personali.UserFacts.initData("personal_counters",b.personalCounters),Netotiate.Plugin.connect(Netotiate.Plugin.options.affiliateId,Netotiate.Plugin.ver,Netotiate.Plugin.authKey,Netotiate.Plugin.JSON.stringify(Netotiate.Plugin.Actions.getFacts()),Netotiate.Plugin.debug?1:0,a)}),NetotiateWindow.client.events.broadcast("netotiate.plugin.connect.start",null)},Netotiate.ArenaElementSet=[],Netotiate.ArenaInitialized=!1,Netotiate.ArenaElement=function(type,domElement,rawParams){this.getUniqueId=function(){if(null===this.id){var a="neto-btn-"+Math.floor(99999*Math.random());this.id=a}return this.id},this.create=function(){var a=(Netotiate.nq(this.domElement).parent(),Netotiate.nq(this.domElement),this.getUniqueId()),b="height:"+Netotiate.Plugin.displayConfig.button.height+";width:"+Netotiate.Plugin.displayConfig.button.width+";",c=Netotiate.nq.create("iframe").setAttr("scrolling","no").setAttr("allowTransparency","true").setAttr("frameborder","0").setAttr("id",a).setAttr("style",b);c.addClass("netotiate-button-iframe");var d=this;c.load(function(){d.getStatus()});var e={};e.affiliateId=Netotiate.Plugin.affiliateId,e.r=Netotiate.Plugin.cacheIdentifier,e.ck=Netotiate.Plugin.displayConfig.button.cssKey,e.tk=Netotiate.Plugin.displayConfig.button.termKey,e.lc=Netotiate.Plugin.locale,e.tc=Netotiate.Plugin.termset,e.affiliateName=Netotiate.Plugin.affiliateName.replace(/\W/g,"").toLowerCase();var f=Netotiate.Plugin.Env.pluginBaseUrl+"/index/button/?"+Netotiate.nq.make_qs(e)+"#"+this.id;c.setAttr("src",f),c.hide(),c=c.getRaw(),Netotiate.nq(this.domElement).replaceWith(c),this.domElement=c},this.show=function(){if(!(Netotiate.nq(this.domElement).getCss("display").indexOf("block")>-1||Netotiate.Plugin.frequencyBtnDisabled)){var a={product:{sku:this.params.sku,original_price:this.params.productPrice}},b=function(b){Netotiate.nq(b).setCss({display:"inline-block"}),Netotiate.Plugin.triggerReportTag("netotiate.events.button_show",a),Netotiate.Plugin.triggerReportTag("netotiate.plugin.initiator.show",a)};Netotiate.nq(this.domElement).slideDown(1e3,b),this.reportImpressions()}},this.runtimeValidation=function(){var isValid=!0,currentParameters=this.params;if(Netotiate.Plugin.Validator.NetotiateElement.isExist(currentParameters.waitFor))try{var waitFor=eval(currentParameters.waitFor);if(!(waitFor instanceof Array))return!1;Netotiate.nq.each(waitFor,function(a,b){return Netotiate.Plugin.Validator.NetotiateElement.isExist(currentParameters[b])?void 0:(isValid=!1,!1)})}catch(e){return!1}return pm({target:this.domElement.contentWindow,type:"set_"+(isValid?"enabled":"disabled")}),isValid},this.action=function(){if(this.runtimeValidation()){Netotiate.ArenaInitialized=!1;var a={product:{sku:this.params.sku,original_price:this.params.productPrice}};return Netotiate.Plugin.triggerReportTag("netotiate.events.arena.show",a),Netotiate.Plugin.showArena(Netotiate.Plugin.lastInitiator,this.params),!0}return!1},this.getStatus=function(){var a="",b=Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams(this.params),c=Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams(this.params);return b&&c&&(a="enabled"),this.runtimeValidation()||(a="disabled"),a},this.isImpressionsReported=!1,this.reportImpressions=function(){if(Netotiate.ArenaElement.isButtonImpressionsReported===!0)return!1;Netotiate.ArenaElement.isButtonImpressionsReported=!0;var a=this.domElement.offsetTop<=(window.innerHeight||document.documentElement.clientHeight)?"true":"false";Netotiate.Plugin.displayConfig.button&&Netotiate.ArenaElement.getTotalLoadedButtons()>0&&NetotiateWindow.client.events.broadcast("netotiate.plugin.button.view",{sku:Personali.Initiators.getEligibles()[0].params.sku,affiliateId:Netotiate.Plugin.affiliateId,cid:Netotiate.ArenaElementSet[0].getCategoryId(),distribution:Netotiate.Plugin.distribution,group_identifier:Netotiate.Plugin.groupIdentifier,rule_revision_id:Netotiate.Plugin.ruleRevisionId,seen:a})},this.getCategoryId=function(){return this.params.categoryId},this.getSku=function(){return this.params.sku},this.getDomElement=function(){return this.domElement},this.getEligibleState=function(){return this.eligible},this.setEligibleState=function(a){this.eligible=a},this.id=null,this.eligible="potential",this.type=type,this.domElement=domElement,this.params={};for(var key in rawParams)this.params[key]=rawParams[key]+"";this.params.categoryId=this.params.categoryId?this.params.categoryId:"",this.params.quantity=this.params.quantity?this.params.quantity:1,this.getUniqueId()},Netotiate.ArenaElement.isButtonImpressionsReported=!1,Netotiate.ArenaElement.findByExternalId=function(a){var b;return Netotiate.nq.each(Netotiate.ArenaElementSet,function(c,d){return d.params.externalId==a?(b=d,!1):void 0}),b},Netotiate.ArenaElement.findBId=function(a){var b;return Netotiate.nq.each(Netotiate.ArenaElementSet,function(c,d){return d.id==a?(b=d,!1):void 0}),b},Netotiate.ArenaElement.deleteById=function(a){return Netotiate.nq.grep(Netotiate.ArenaElementSet,function(b){return b.id==a?!1:!0})},Netotiate.ArenaElement.modifyById=function(a,b){Netotiate.nq.grep(Netotiate.ArenaElementSet,function(c){if(c.id==a){var d=b.additionalData&&b.additionalData.priceInitiator;c.params.e_sku=c.params.sku,c.params.sku=b.additionalData.sku||c.params.sku,c.params.e_productPrice=c.params.productPrice,c.params.productPrice=c.params&&c.params[d]||b.additionalData.productPrice||c.params.productPrice,c.params.mvt=b.mvt||{},c.params.controlGroup=Netotiate.Plugin.controlGroup}})},Netotiate.ArenaElement.getTotalLoadedButtons=function(){return Netotiate.ArenaElementSet.length},Netotiate.Plugin.loadWidget=function(){widgetLibrary=document.createElement("script"),widgetLibrary.src=Netotiate.Plugin.Env.staticCdnBaseUrl+"/"+Netotiate.Plugin.cacheIdentifier+"/scripts/plugin/plugin.library.widget.min.js.jgz?cb="+Netotiate.Plugin.cacheIdentifier,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(widgetLibrary)},Netotiate.Plugin.drawElements=function(a){1==Netotiate.ArenaElement.getTotalLoadedButtons()&&Netotiate.ArenaElementSet[0].runtimeValidation()&&Netotiate.Plugin.Validator.NetotiateElement.isExist(Netotiate.Plugin.displayConfig.tab)&&(Netotiate.Plugin.Logger.log("Netotiate plugin initializing started"),Netotiate.SideWidget.initializeIframe()),Netotiate.nq.each(Netotiate.Plugin.Actions.tasks,function(b,c){var d=Netotiate.ArenaElement.findBId(c.ownerId);d&&Netotiate.Plugin.Actions.doTask(c,d,a)})},Netotiate.Plugin.init=function(a){function b(a){Netotiate.Plugin.setupConfiguration(a)&&(Netotiate.Plugin.options=a,NetotiateWindow.client=NetotiateWindow.createClient(window),NetotiateWindow.server=NetotiateWindow.createServer(),Netotiate.Plugin.collectNetotiableElements(),Netotiate.ArenaElement.getTotalLoadedButtons()&&(Netotiate.Plugin.Hub.bindInternalEvents(),Netotiate.Plugin.Hub.inject()))}Netotiate.nq.readyAdd(function(){try{b(a)}catch(c){Netotiate.Plugin.reportOnCrash(c)}})},Netotiate.Events={},Netotiate.Events.publish=Netotiate.Events.trigger=function(a,b,c,d){var e=Array();e.push("object"==typeof b?b:{}),c instanceof Array&&e.push(c),Netotiate.nq("body").trigger(a,e),"function"==typeof d&&d()},Netotiate.Events.subscribe=Netotiate.Events.bind=function(a,b){Netotiate.nq("body").bind(a,b)},Netotiate.Plugin.bindExternalEvents=function(){try{"function"==typeof $("body").bind&&$("body").bind("netotiate.plugin.options.update",function(a,b){Netotiate.nq("body").trigger("netotiate.plugin.options.update",b)})}catch(a){}Netotiate.nq("body").bind("netotiate.plugin.arena.show",function(a,b){Netotiate.ArenaElementSet[0].runtimeValidation()&&Netotiate.Plugin.showArena(b.initiator,Netotiate.ArenaElementSet[0].params)}),Netotiate.Plugin.Validator.NetotiateElement.isExist(Netotiate.Plugin.displayConfig.tab)?Netotiate.nq("body").bind("netotiate.plugin.options.update",function(a,b){var c=!1;Netotiate.SideWidget.isVisible&&Netotiate.SideWidget.isOpen&&(c=!0);var d=Netotiate.ArenaElementSet[0].params,e=Netotiate.nq.extend(d,b);Netotiate.ArenaElementSet[0].params=e;var f=Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams(Netotiate.ArenaElementSet[0].params),g=Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams(Netotiate.ArenaElementSet[0].params);(f===!1||g===!1)&&(Netotiate.Plugin.Logger.error("Netotiate plugin - dynamic parameters received did not pass validation. Disabling the plugin functionlity"),Netotiate.ArenaElementSet[0].params=d,Netotiate.ArenaElementSet[0].params.productPrice="N/A"),pm({target:Netotiate.SideWidget.Widget,type:"initialize_arena",data:Netotiate.ArenaElementSet[0].params}),c&&setTimeout(Netotiate.SideWidget.action.open,1e3),Netotiate.ArenaElementSet[0].getStatus()}):(Netotiate.nq("body").bind("netotiate.plugin.options.update",function(a,b,c){b.sku&&(b.e_sku=b.sku),b.productPrice&&(b.e_productPrice=b.productPrice);var d=new Array;c instanceof Array?c.length>=1&&Netotiate.nq.each(c,function(a,b){var c=Netotiate.ArenaElement.findByExternalId(b);c&&d.push(c)}):("undefined"==c||null==c)&&Netotiate.nq.each(Netotiate.ArenaElementSet,function(a,b){d.push(b)}),d instanceof Array&&d.length>=1&&Netotiate.nq.each(d,function(a,c){if(c){var d=Netotiate.nq.extend({},c.params),e=Netotiate.nq.extend(c.params,b);c.params=e;var f=Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams(c.params),g=Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams(c.params);(f===!1||g===!1)&&(Netotiate.Plugin.Logger.error("Netotiate plugin - dynamic parameters received for buttonExternalId: "+e.externalId+" did not pass validation. Update will be reverted"),c.params=d),c.getStatus()}})}),pm.bind("netotiate_button_click",function(a){Netotiate.Plugin.lastInitiator="button";var b=Netotiate.ArenaElement.findBId(a);NetotiateWindow.client.events.broadcast("netotiate.plugin.button.click",{affiliateId:Netotiate.Plugin.affiliateId,sku:b.params.sku,cid:b.getCategoryId(),initiator:Netotiate.Plugin.lastInitiator});var c={status:b.getStatus(),product:{sku:b.params.sku,original_price:b.params.productPrice},initiator:{status:b.getStatus()}};b.params.hasOwnProperty("externalId")&&(c.product.externalId=b.params.externalId),Netotiate.Plugin.triggerReportTag("netotiate.plugin.initiator.onclick",c),b&&b.action()})),pm.bind("netotiate_site_redirect",function(a){var b=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return null!=a&&""!=a&&b.test(a)?void(window.location.href=a):!1}),pm.bind("netotiate_arena_scroll",function(a){switch(a.eventType){case"start":Netotiate.Plugin.autoScrollOn();break;case"stop":Netotiate.Plugin.autoScrollOff()}}),pm.bind("netotiate_plugin_events_publish",function(a){a.eventType&&Netotiate.Events.publish(a.eventType,a.options)}),pm.bind("arena_pm_button",function(a){Netotiate.nq.each(Netotiate.ArenaElementSet,function(b,c){return a.button==c.getSku()?void pm({target:c.getDomElement()[0].contentWindow,type:a.type,data:a.data}):void 0})}),pm.bind("netotiate_arena_scroll_to_first_button",function(){Netotiate.Plugin.scrollToFirstButtonAndClose()}),NetotiateWindow.client.events.subscribe("netotiate_arena_execute_function",function(a){var b="try{"+a.func+"}catch(e){};";Netotiate.nq.create("script").html(b).appendTo("body")})},Netotiate.Plugin.validateNetotiableElementsSetup=function(){var a=!0;return Netotiate.nq.each(Netotiate.ArenaElementSet,function(b,c){var d=Netotiate.Plugin.Validator.NetotiateElement.validateMandatoryParams(c.params),e=Netotiate.Plugin.Validator.NetotiateElement.validateOptionalParams(c.params);a=a&&d&&e}),a},Netotiate.Plugin.collectNetotiableElements=function(){Netotiate.nq("body *[onClick*='Netotiate.Plugin'][onclick*='Netotiate.Plugin']").each(function(a,b){try{var c=null!=b&&null!=b.attributes?b.attributes.onclick.value:null;if(void 0!=c&&null!=c){c=c.toString().replace(/[\n]/g,"").replace(/[\r]/g,"").replace(/[\']/g,'"').replace(/\\t/g,"").replace(/\\n/g,"").replace(/\t/g,"");var d="button",e=c.match(/Netotiate.Plugin.draw\(\s*(\{.+\})\);/m);if(null!=e&&void 0!=e[1]){var f=Netotiate.Plugin.JSON.parse(e[1]),g=new Netotiate.ArenaElement(d,b,f);Personali.Initiators.add(g.getUniqueId(),g),Netotiate.ArenaElementSet.push(g)}}}catch(h){Netotiate.Plugin.Logger.warn("failed to collect netotiate draw element: "+h),Netotiate.Plugin.reportOnCrash(h)}})},Netotiate.Plugin.initializeIframe=function(a){return Netotiate.Plugin.prepareContainer(),Netotiate.Plugin.iframeReady?"function"==typeof a?a():!1:void window.setTimeout(function(){Netotiate.Plugin.initializeIframe(a)},50)},Netotiate.Plugin.loadCustomCode=function(){var a=Netotiate.Plugin.affiliateName.replace(/\W/g,"").toLowerCase(),b=Netotiate.Plugin.Env.staticCdnBaseUrl+"/"+Netotiate.Plugin.cacheIdentifier+"/scripts/plugin/custom/"+a+"/code.min.js.jgz?cb="+Netotiate.Plugin.cacheIdentifier;try{Netotiate.nq.jsonp(b)}catch(c){}},Netotiate.Plugin.connect=function(a,b,c,d,e,f){var g=Netotiate.Plugin.Logger.error;if(null===a||void 0===a)return g("Could not authenticate the plugin, missing affiliateId in parameters sent, aborting"),void(Netotiate.Plugin.isAuthenticated=!1);if(null===b||void 0===b)return g("Could not authenticate the plugin, missing version in parameters sent, aborting"),void(Netotiate.Plugin.isAuthenticated=!1);if(null===c||void 0===c)return g("Could not authenticate the plugin, missing authenticationKey in parameters sent, aborting"),void(Netotiate.Plugin.isAuthenticated=!1);if(null===Netotiate.Plugin.isAuthenticated){Netotiate.Plugin.isAuthenticated="authenticating";var h=function(){g("Could not authenticate the plugin for affiliate ID: "+a+", aborting")},i=function(a){var b=Netotiate.API.GenericResponse(a);return b?(Netotiate.Plugin.distribution=Netotiate.ArenaElementSet[0].params.distribution=void 0!=b.body.actions[0].additionalData.distribution?b.body.actions[0].additionalData.distribution:"",Netotiate.Plugin.groupIdentifier=Netotiate.ArenaElementSet[0].params.groupIdentifier=void 0!=b.body.actions[0].additionalData.groupIdentifier?b.body.actions[0].additionalData.groupIdentifier:"",Netotiate.Plugin.controlGroup=Netotiate.ArenaElementSet[0].params.controlGroup=void 0!=b.body.actions[0].additionalData.controlGroup?b.body.actions[0].additionalData.controlGroup:"",Netotiate.Plugin.ruleRevisionId=Netotiate.ArenaElementSet[0].params.ruleRevisionId=void 0!=b.body.actions[0].additionalData.ruleRevisionId?b.body.actions[0].additionalData.ruleRevisionId:"",Netotiate.Plugin.affiliateName=b.body.Publisher.retailerName,Netotiate.Plugin.Actions.tasks=b.body.actions,Netotiate.Plugin.displayConfig=Netotiate.Plugin.JSON.parse(b.body.Publisher.displayConfig),Netotiate.Plugin.merchantPhone=b.body.Publisher.phone,Netotiate.Plugin.merchantLogoUrl=b.body.Publisher.retailerLogoUrl,Netotiate.Plugin.merchantId=b.body.Publisher.retailerId,Netotiate.Plugin.locale=b.body.Publisher.locale,Netotiate.Plugin.termset=b.body.actions[0].additionalData.termSetId||"",Netotiate.Plugin.Logger.log("Netotiate plugin authentication successfull"),void f()):void h()},j=Netotiate.Plugin.JSON.stringify({affiliateId:a,version:b,affiliateKey:c,debug:e,factItems:d,userFacts:Netotiate.Plugin.JSON.stringify(Personali.UserFacts.getNormelized()),retailerVisitor:Netotiate.Visitor.getretailer_visitorId()});Netotiate.nq.support.cors=!0;var k=function(){if(window.XDomainRequest){var f=new XDomainRequest;f.open("POST",Netotiate.Plugin.Env.apiBaseUrl+"/api/display/connect/v2"),f.onload=function(){if(null!=f.responseText&&""!=f.responseText){var a=Netotiate.Plugin.JSON.parse(f.responseText);i(a)}else h()},f.onprogress=function(){},f.timeout=5e3,f.onerror=function(){h()},j={affiliateId:a,version:b,affiliateKey:c,debug:e,factItems:d,userFacts:Netotiate.Plugin.JSON.stringify(Personali.UserFacts.getNormelized()),retailerVisitor:Netotiate.Visitor.getretailer_visitorId()};var g="";Netotiate.nq.each(j,function(a,b){g+=encodeURIComponent(a)+"="+encodeURIComponent(b)+"&"}),f.send(g)}},l=function(){Netotiate.nq.ajax({type:"POST",url:Netotiate.Plugin.Env.apiBaseUrl+"/api/display/connect",data:j,cache:!1,dataType:"json",contentType:"application/json; charset=utf-8",crossDomain:!0,success:i,error:Netotiate.Plugin.connectErrorHandler})},m=new XMLHttpRequest;"withCredentials"in m?l():k()}},Netotiate.Plugin.setupConfiguration=function(a){var b=!0;return(a.debug||"#NETO_DEBUG"==window.location.hash)&&(Netotiate.Plugin.debug=a.debug=!0),a.affiliateId&&(Netotiate.Plugin.Validator.isNumber(a.affiliateId)?Netotiate.Plugin.affiliateId=a.affiliateId:(b=!1,Netotiate.Plugin.Logger.error("affiliateId supplied in INIT method is not a valid number, input: "+a.affiliateId+" - aborting"))),a.authenticationKey&&(Netotiate.Plugin.Validator.isNonEmptyString(a.authenticationKey)?Netotiate.Plugin.authKey=a.authenticationKey:(b=!1,Netotiate.Plugin.Logger.error("authenticationKey supplied in INIT method is not a valid number, input: "+a.authenticationKey+" - aborting"))),a.baseUrl=Netotiate.Plugin.Env.pluginBaseUrl,b},Netotiate.Plugin.Hub.bindInternalEvents=function(){NetotiateWindow.client.events.subscribe("netotiate.hub.ready_state",function(){Netotiate.Plugin.Hub.onReadyState()})},Netotiate.Plugin.Hub.inject=function(){var a=Netotiate.nq("#netotiate-hub-container");if(a.length()>0)return void Netotiate.Plugin.Hub.onReadyState();a=Netotiate.nq.create("div").setAttr("id","netotiate-hub-container").appendTo("body"),a.setAttr("class",""),a.setAttr("style","");var b=Netotiate.Plugin.Env.pluginSecureUrl+"/index/hub/?affiliateId="+Netotiate.Plugin.options.affiliateId+"&r="+Netotiate.Plugin.cacheIdentifier,c=Netotiate.nq.create("iframe");c.setAttr("id","netotiate-hub"),c.setAttr("src",b),c.setAttr("width","1px"),c.setAttr("height","1px"),c.setAttr("overflow","hidden"),c.setAttr("frameborder","0"),c.addClass("netotiate-window-client"),c.appendTo(a)},Netotiate.Plugin.prepareContainer=function(){if(!Netotiate.Plugin.iframeReady&&!Netotiate.Plugin.initializing){Netotiate.Plugin.initializing=!0;var a=Netotiate.nq("#netotiate_plugin");if(0===a.length()){var b=Netotiate.nq.create("div");b.setAttr("id","netotiate_plugin"),a=b.appendTo("body");var c=a.position().top+"px";b.setAttr("style","position:relative;z-index:99999;margin-top:-"+c)}else if(Netotiate.nq("#netotiate_iframe").length()>0)return Netotiate.Plugin.Arena=Netotiate.nq("#netotiate_iframe").eq(0).getRaw().contentWindow,Netotiate.Plugin.iframeReady=!0,void Netotiate.Plugin.onArenaReadyState();if(a.removeClass(),a.setAttr("style",""),a.length()>0){a.hide();var d={};d.affiliateId=Netotiate.Plugin.options.affiliateId,d.r=Netotiate.Plugin.cacheIdentifier,d.logoUrl=Netotiate.Plugin.merchantLogoUrl,d.affiliateName=Netotiate.Plugin.affiliateName.replace(/\W/g,"").toLowerCase(),d.lc=Netotiate.Plugin.locale,d.fc=Netotiate.Plugin.displayConfig.fc||"",d.tc=Netotiate.Plugin.termset;var e=Netotiate.Plugin.Env.pluginBaseUrl+"/index/arena/?"+Netotiate.nq.make_qs(d),f=Netotiate.nq.create("iframe");f.setAttr("scrolling","no"),f.setAttr("allowTransparency","true"),f.setAttr("frameborder","0"),f.setAttr("id","netotiate_iframe"),f.setAttr("name","netotiate_iframe"),f.setAttr("src",e),f.addClass("netotiate-window-client"),f.appendTo("#netotiate_plugin"),pm.bind("arena_close",function(){Netotiate.Plugin.hide()}),pm.bind("arena_show",function(){Netotiate.Plugin.showArena(Netotiate.Plugin.lastInitiator)}),pm.bind("arena_initialized",function(){Netotiate.ArenaInitialized=!0}),Netotiate.Plugin.bindReportTag("offer_accepted","netotiate.events.arena.offer_accepted"),
Netotiate.Plugin.bindReportTag("offer_countered","netotiate.events.arena.offer_countered"),Netotiate.Plugin.bindReportTag("checkout_completed","netotiate.events.arena.checkout_completed"),Netotiate.nq("#netotiate_iframe").load(function(){Netotiate.Plugin.iframeReady=!0;var a="width:628px;height:440px;visibility:visible;overflow:hidden;z-index:10000";Netotiate.nq("#netotiate_iframe").setAttr("style",a);var b=document.getElementById("netotiate_iframe").contentWindow;Netotiate.Plugin.Arena=b,pm({target:b,type:"setup",data:Netotiate.Plugin.options}),Netotiate.Plugin.onArenaReadyState()})}else Netotiate.Plugin.Logger.error("div element with id [netotiate_plugin] is missing in the body tag, aborting.")}},Netotiate.Plugin.doOverlay=function(){{var a=Netotiate.nq("body").find("#arena-overlay").length()>0,b=Netotiate.nq("body"),c=Netotiate.nq.create("span").setAttr("id","arena-overlay");Netotiate.nq("#netotiate_plugin")}if(!a){c.setCss({width:"0",height:"0","line-height":"0"}),b.append(c),c.hide();var d={background:"#000000",position:"absolute",display:"inline",top:"0",left:"0",bottom:"0","z-index":"99998",width:Netotiate.nq(document).width()+"px",height:Netotiate.nq(document).height()+"px",opacity:"0.4",filter:"alpha(opacity=40)"};c.setCss(d).show(),c.bind("click",function(){return!1})}},Netotiate.Plugin.removeOverlay=function(a){var b=Netotiate.nq("#arena-overlay");b.hide(function(){b.remove(),"function"==typeof a&&a()})},Netotiate.Plugin.isActive=function(){return Netotiate.nq("#netotiate_plugin").is(":visible")},Netotiate.Plugin.show=function(){Netotiate.Plugin.unHookOnMouseLeave(),Netotiate.Plugin.doOverlay(),Netotiate.nq("#netotiate_plugin").show(),Netotiate.nq("#netotiate_iframe").show();var a=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,b=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;Netotiate.nq("#netotiate_iframe").setCss({top:a+(window.innerHeight||document.documentElement.clientHeight)/2-Netotiate.Plugin.dialogHeight/2+"px",left:b+(window.innerWidth||document.documentElement.clientWidth)/2-Netotiate.Plugin.dialogWidth/2+"px",position:"absolute","z-index":"99999"})},Netotiate.Plugin.hideLoadingScreen=function(){window.setTimeout(function(){Netotiate.nq("#personali_loading").length()&&Netotiate.nq("#personali_loading").remove()},850)},Netotiate.Plugin.showLoadingScreen=function(){if(!Netotiate.nq("#personali_loading").length()){var a=Netotiate.nq.create("div"),b=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,c=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;a.setCss({"-webkit-box-shadow":"0 0 26px 0 #404040","-moz-box-shadow":"0 0 26px 0 #404040","box-shadow":"0 0 26px 0 #404040",padding:"11px 0 20px",height:"374px",background:"#F4F5F5",position:"absolute",margin:"20px",width:"592px",visibility:"visible",overflow:"hidden","z-index":"100000",background:"url(//static.personali.com/images/loading_gray_65.gif)","background-color":"white","background-repeat":"no-repeat","background-position":"center center",top:b+(window.innerHeight||document.documentElement.clientHeight)/2-Netotiate.Plugin.dialogHeight/2+"px",left:c+(window.innerWidth||document.documentElement.clientWidth)/2-Netotiate.Plugin.dialogWidth/2+"px"}),a.setAttr("id","personali_loading"),a.appendTo("body")}},Netotiate.Plugin.showArena=function(a,b){if(!Netotiate.Plugin.iframeReady){Netotiate.Plugin.showLoadingScreen();var c=function(){Netotiate.Plugin.showArena(a,b)};return void window.setTimeout(Netotiate.Plugin.initializeIframe(c,50))}b.device_type=Netotiate.Plugin.device+"Web",b.user_facts=Netotiate.Plugin.JSON.stringify(Personali.UserFacts.getNormelized()),b.initiator=Netotiate.Plugin.lastInitiator,pm({target:Netotiate.Plugin.Arena,type:"initialize_arena",data:b}),pm({target:Netotiate.Plugin.Arena,type:"show_arena",data:{initiator:a}}),Netotiate.Plugin.show(),Netotiate.Plugin.hideLoadingScreen(),Netotiate.Plugin.autoScrollOn()},Netotiate.Plugin.showIncentive=function(){if(!Netotiate.Plugin.iframeReady){Netotiate.Plugin.showLoadingScreen();var a=function(){Netotiate.Plugin.showIncentive()};return void window.setTimeout(Netotiate.Plugin.initializeIframe(a,50))}pm({target:Netotiate.Plugin.Arena,type:"initialize_arena",data:Netotiate.ArenaElementSet[0].params}),pm({target:Netotiate.Plugin.Arena,type:"show_incentive"}),Netotiate.Plugin.show(),Netotiate.Plugin.drawElements(0),Netotiate.Plugin.hideLoadingScreen(),Netotiate.Plugin.autoScrollOn()},Netotiate.Plugin.hide=function(a){Netotiate.nq("#netotiate_iframe").hide(function(){Netotiate.nq("#netotiate_plugin").hide(),Netotiate.Plugin.removeOverlay(a)})},Netotiate.Plugin.reportOnCrash=function(a){var b=document.createElement("img");b.src=Netotiate.Plugin.Env.reportBaseUrl+"/reporting/image?e=PluginCrash&a=report&d="+encodeURIComponent(Netotiate.Plugin.getCurrentUrl()).substring(0,255)+"&d2="+encodeURIComponent(a).substring(0,255)+"&affiliateId="+Netotiate.Plugin.affiliateId,document.getElementsByTagName("body")[0].appendChild(b)},function(a){function b(){Netotiate.nq.readyAdd(function(){c(),"function"==typeof window.netotiateInitScript?window.netotiateInitScript():Netotiate.Plugin.Logger.error("Method - netotiateInitScript missing in containing page body tag, aborting")},a)}function c(){!function(a,b,c){if(!("console"in a)){var d=a.console={};d.log=d.warn=d.error=d.debug=function(){}}b.pm=a.pm=function(a){e.send(a)},b.pm.bind=a.pm.bind=function(a,b,c,d){e.bind(a,b,c,d)},b.pm.unbind=a.pm.unbind=function(a,b){e.unbind(a,b)},b.pm.origin=a.pm.origin=null,b.pm.poll=a.pm.poll=200;var e={send:function(a){var d=b.extend({},e.defaults,a),f=d.target;if(d.target&&d.type){var g={data:d.data,type:d.type};d.success&&(g.callback=e._callback(d.success)),d.error&&(g.errback=e._callback(d.error)),"postMessage"in f&&f.postMessage!=c&&!d.hash?(e._bind(),f.postMessage(Netotiate.Plugin.JSON.stringify(g),d.origin||"*")):(e.hash._bind(),e.hash.send(d,g))}},bind:function(c,d,f,g){"postMessage"in a&&!g?e._bind():e.hash._bind();var h=e.data("listeners.postmessage");h||(h={},e.data("listeners.postmessage",h));var i=h[c];i||(i=[],h[c]=i),i.push({fn:d,origin:f||b.pm.origin})},unbind:function(a,b){var c=e.data("listeners.postmessage");if(c)if(a)if(b){var d=c[a];if(d){for(var f=[],g=0,h=d.length;h>g;g++){var i=d[g];i.fn!==b&&f.push(i)}c[a]=f}}else delete c[a];else c={}},data:function(a,b){return b===c?e._data[a]:(e._data[a]=b,b)},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],b=0;32>b;b++)a[b]=e._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var b=e.data("callbacks.postmessage");b||(b={},e.data("callbacks.postmessage",b));var c=e._random();return b[c]=a,c},_bind:function(){e.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",e._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",e._dispatch),e.data("listening.postmessage",1))},_dispatch:function(a){try{var b=Netotiate.Plugin.JSON.parse(a.data)}catch(c){return}if(b.type){var d=e.data("callbacks.postmessage")||{},f=d[b.type];if(f)f(b.data);else for(var g=e.data("listeners.postmessage")||{},h=g[b.type]||[],i=0,j=h.length;j>i;i++){var k=h[i];if(k.origin&&a.origin!==k.origin){if(b.errback){var l={message:"postmessage origin mismatch",origin:[a.origin,k.origin]};e.send({target:a.source,data:l,type:b.errback})}}else try{var m=k.fn(b.data);b.callback&&e.send({target:a.source,data:m,type:b.callback})}catch(c){b.errback&&e.send({target:a.source,data:c,type:b.errback})}}}}};e.hash={send:function(b,c){var d=b.target,f=b.url;if(!f)return void console.warn("postmessage target window url is required");f=e.hash._url(f);var g,h=e.hash._url(a.location.href);if(a==d.parent)g="parent";else try{for(var i=0,j=parent.frames.length;j>i;i++){var k=parent.frames[i];if(k==a){g=i;break}}}catch(l){g=a.name}if(null==g)return void console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list");var m={"x-requested-with":"postmessage",source:{name:g,url:h},postmessage:c},n="#x-postmessage-id="+e._random();d.location=f+n+encodeURIComponent(Netotiate.Plugin.JSON.stringify(m))},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){e.data("polling.postmessage")||(setInterval(function(){var b=""+a.location.hash,c=e.hash._regex.exec(b);if(c){var d=c[1];e.hash._last!==d&&(e.hash._last=d,e.hash._dispatch(b.substring(e.hash._regex_len)))}},b.pm.poll||200),e.data("polling.postmessage",1))},_dispatch:function(b){if(b){try{if(b=Netotiate.Plugin.JSON.parse(decodeURIComponent(b)),!("postmessage"===b["x-requested-with"]&&b.source&&null!=b.source.name&&b.source.url&&b.postmessage))return}catch(c){return}var d=b.postmessage,f=e.data("callbacks.postmessage")||{},g=f[d.type];if(g)g(d.data);else{var h;h="parent"===b.source.name?a.parent:a.frames[b.source.name];for(var i=e.data("listeners.postmessage")||{},j=i[d.type]||[],k=0,l=j.length;l>k;k++){var m=j[k];if(m.origin){var n=/https?\:\/\/[^\/]*/.exec(b.source.url)[0];if(n!==m.origin){if(console.warn("postmessage message origin mismatch",n,m.origin),d.errback){var o={message:"postmessage origin mismatch",origin:[n,m.origin]};e.send({target:h,data:o,type:d.errback,hash:!0,url:b.source.url})}continue}}try{var p=m.fn(d.data);d.callback&&e.send({target:h,data:p,type:d.callback,hash:!0,url:b.source.url})}catch(c){d.errback&&e.send({target:h,data:c,type:d.errback,hash:!0,url:b.source.url})}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}},e.defaults={target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}}(this,"undefined"==typeof Netotiate.nq?null:Netotiate.nq),Netotiate.nq.stringify=function(a){var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a.replace(/\"/g,'\\"')+'"'),String(a);var c,d,e=[],f=a&&a.constructor==Array;for(c in a)d=a[c],b=typeof d,"undefined"!=b&&a.hasOwnProperty(c)&&("string"==b?d='"'+d.replace(/\"/g,'\\"')+'"':"object"==b&&null!==d&&(d=Netotiate.nq.stringify(d)),e.push((f?"":'"'+c+'":')+String(d)));return(f?"[":"{")+String(e)+(f?"]":"}")},"JSON"in Netotiate.Plugin&&Netotiate.Plugin.JSON||(Netotiate.Plugin.JSON={},Netotiate.Plugin.JSON.parse=window.JSON.parse,Netotiate.Plugin.JSON.stringify=Netotiate.nq.stringify)}try{b()}catch(d){Netotiate.Plugin.reportOnCrash(d)}}(Netotiate);var AB=function(){var a={},b=function(b){return a[b]||(a[b]=new c(b)),a[b]};b.initAll=function(a){for(var c in a)c in a&&b(c).init(a[c])};var c=function(a){this._name=a,this._condition=null,this._conditionFunc=function(){return!1},this._on={},this._settings={},this.init=function(a){a&&(this._settings=a);try{this.activateOn(1==this.getConditionFunc())}catch(b){}return this},this.activateOn=function(a){return this._condition=a,this},this.setConditionFunc=function(a){return this._conditionFunc=a,this},this.getConditionFunc=function(){return this._conditionFunc()},this.isActivated=function(){return"function"==typeof this._condition?this._condition():this._condition},this.on=function(a,b){hooks_array=a.split(",");for(var c=0;c<hooks_array.length;c++)this._on[hooks_array[c]]=b;return this},this.action=function(a,b){return this.isActivated()&&"function"==typeof this._on[a]&&this._on[a](b),this},this.set=function(a,b){return this._settings[a]=b,this},this.get=function(a){return this._settings[a]||""}};return b.action=function(b,c){for(testId in a)a[testId].action(b,c)},b}();AB("auto trigger").setConditionFunc(function(){return"off"!=AB("auto trigger").get("view type")&&""!=AB("auto trigger").get("view type")}),AB("auto trigger").on("connect_end",function(){if(""!=AB("auto trigger").get("view type")){var a=20,b=""!=AB("auto trigger").get("time to trigger")?AB("auto trigger").get("time to trigger"):a,c=function(){var a=function(){Netotiate.Plugin.showIncentive()};return Netotiate.Plugin.initializeIframe(a),!1},d=function(){return"na"==Netotiate.Plugin.lastInitiator&&(Netotiate.Plugin.lastInitiator="auto_trigger",NetotiateWindow.client.events.broadcast("netotiate.plugin.auto_trigger.prompt",{affiliateId:Netotiate.Plugin.affiliateId,sg:Netotiate.Plugin.SampleGroup.name,sku:Netotiate.ArenaElementSet[0].params.sku,cid:Netotiate.ArenaElementSet[0].params.categoryId}),Netotiate.Events.publish("netotiate.plugin.arena.show")),!1};"prompt"==AB("auto trigger").get("view type")?setTimeout(c,1e3*b):"arena"==AB("auto trigger").get("view type")&&setTimeout(d,1e3*b)}}),AB("button display randomization").setConditionFunc(function(){return"default"!=AB("button display randomization").get("frequency value")&&""!=AB("button display randomization").get("frequency value")}),AB("button display randomization").on("connect_end",function(){if(""!=AB("button display randomization").get("frequency value")){var a=parseInt(AB("button display randomization").get("frequency value").replace("%","")),b=parseInt(100*Math.random());Netotiate.Plugin.frequencyBtnDisabled=b>=a}}),AB("terms setID").setConditionFunc(function(){return"default"!=AB("terms setID").get("terms set selection")&&""!=AB("terms setID").get("terms set selection")}),AB("terms setID").on("connect_end",function(){""!=AB("terms setID").get("terms set selection")&&(Netotiate.Plugin.termset=AB("terms setID").get("terms set selection"))}),AB("exit intent").setConditionFunc(function(){return"disabled"!=AB("exit intent").get("view type")&&""!=AB("exit intent").get("view type")}),AB("exit intent").on("connect_end",function(){""!=AB("exit intent").get("view type")&&Netotiate.Plugin.hookOnMouseLeave(AB("exit intent").get("view type"))});